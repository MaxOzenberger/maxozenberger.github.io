import{a5 as d,a6 as _,a7 as K,a8 as Fi,bF as Q,N as jo,kW as Ho,k as Uo,J as I,a as h,eh as ko,fK as It,t as m,kb as Bo,j7 as Wo,kS as Rr,kX as Tr,Y as Ie,jo as pa,jY as ca,k6 as Yo,ak as bi,b2 as us,am as Qe,ah as et,kY as Dr,n as M,aM as Xo,jL as xe,K as Ze,kZ as ua,_ as Ni,p as X,ha as N,f0 as pt,hb as le,ab as Re,h4 as _a,hi as ve,h5 as U,iV as Pr,h9 as He,hc as Z,iR as $r,ai as j,jm as Ei,h as tn,g5 as an,hp as ga,hn as ai,hN as Fe,hF as Ue,b3 as re,kd as Zo,jp as Cr,k_ as ma,j as L,jR as jt,iS as Te,L as fa,he as qo,k2 as Ai,k$ as _s,jT as gs,l0 as va,hr as si,l1 as Is,j_ as sn,l2 as Oe,l3 as nn,l4 as rn,l5 as on,jv as te,iW as Lr,l6 as ts,l7 as Qo,l8 as Jo,kc as Ht,iG as Ko,fC as el,fi as Gr,a0 as at,ac as _e,l9 as Ir,hd as tl,hl as il,i0 as Vr,la as al,lb as sl,jO as nl,lc as Ut,fy as ye,ld as ln,H as Y,le as ms,aq as cn,ae as ei,lf as ie,lg as fs,lh as rl,kR as ya,ic as ol,hA as hn,fq as dn,li as pn,iM as zr,f4 as ll,lj as vs,lk as cl,ll as O,lm as hl,hk as Je,ln as dl,lo as pl,lp as ul,lq as ys,lr as _l,hh as gl,ls as J,lt as Fr,lu as ml,kU as fl,dY as Nr,jK as jr,h6 as ba,G as li,lv as Vs,iT as Hr,lw as Ma,lx as vl,ly as Ur,lz as yl,f as kr,af as ni,a3 as Br,dS as bl,jH as wt,lA as Ml,lB as Wr,jJ as Sl,eg as zs,h8 as Yr,iL as wl,e$ as Fs,lC as xl,E as gt,lD as un,lE as Ol,lF as _n,cM as bs,aQ as El,e4 as Al,jG as Xr,lG as Rl,lH as Tl,e_ as Sa,B as Dl,lI as gn,lJ as Pl,hR as Ri,lK as $l,fv as Cl,jQ as Ll,f1 as mn,lL as fn,lM as vn,ec as Gl,lN as yn,kE as Il,iK as Ji,lO as Vl}from"./index.3255d2a5.js";import{d as zl,e as Fl,x as Nl,v as wa,b as dt,y as xa,j as Ti,c as ji,t as Va,f as jl,m as Hl,l as Ul,a as Di,h as is,D as kl}from"./automaticLengthMeasurementUtils.06e82903.js";import{r as Pi,t as Zr}from"./vec4f32.c3d64d30.js";import{a as qr,y as Qr,b as Jr,p as Kr,g as eo}from"./Octree.449e609a.js";import{l as Dt,v as $i,h as Oa,m as Bl,b as Ea,M as Wl,B as Yl}from"./lineSegment.1a0fd96e.js";import{R as Xl,p as Ms,d as Hi,h as as,c as w,f as oe,t as Ss,i as Zl,g as bn,j as ql,o as Mn}from"./sphere.67ec4acb.js";import{e as Ql,C as za,a as wi,E as Sn,l as Ns,x as js,z as tt,h as Fa,f as Ne,c as Aa,o as Jl,$ as Kl,d as Na,b as ci,g as ec,i as tc,j as ze,r as ws,k as ic,m as wn,p as ac,n as sc,q as Mi,s as nc,t as ss,u as rc,v as oc,w as Hs,A as lc,y as Ra,O as to,B as cc,D as hc,F as xs,G as io}from"./NativeLineMaterial.6f545af4.js";import{e as kt,G as ao,a as dc,n as pc,o as de,b as lt,f as Os,c as Lt,d as Ui,g as xn,h as ki,i as Bi,t as Wi,r as uc,j as H,k as _c,l as gc,m as Mt,E as Us,A as mc,p as Ae,P as fc,q as vc,s as R,v as so,u as yc,w as B,x as no,y as ro,z as oo,B as ks,C as bc,D as lo,F as Mc,H as co,I as Sc,J as On,K as wc,L as ho,S as xc,M as Oc,N as En,O as Ec,Q as Ac,R as Rc,T as Tc,U as Dc}from"./VertexColor.glsl.e3d82815.js";import{o as Pc}from"./glUtil.9de5d1d0.js";import{T as po}from"./InterleavedLayout.a42ad5fa.js";import{n as Ta}from"./triangulationUtils.2ec0b7a6.js";import{O as A}from"./VertexAttribute.34e3daf1.js";import{e as be,t as $c,o as Cc}from"./mat4f64.9070f685.js";import{o as T,W as Yi,a as Bs,_ as Xi,n as Lc,b as it,c as Gc,A as uo,h as _o,d as go,E as mo,e as Ic,l as Vc,f as zc,S as Fc,g as Nc}from"./OrderIndependentTransparency.43c6e481.js";import{R as qe,E as fo,F as jc,I as ha}from"./enums.3c1fa5b5.js";import{E as Hc}from"./VertexArrayObject.ad007c8f.js";import{p as hi,_ as Ft,x as ri,Y as Zi,J as Uc}from"./plane.a0a08b54.js";import{s as Es}from"./Attribute.98e6fe67.js";import{r as kc,a as Da,V as ja,A as An,P as Bc,E as ct,i as Wc,e as Rn}from"./SnappingContext.023005d4.js";import{n as ae}from"./basicInterfaces.f8f3b23b.js";import{i as Yc}from"./BufferView.32a50625.js";import{s as Xc}from"./Util.3efb1a6b.js";import{H as Zc,k as qc,B as Qc,c as Jc,o as Kc,U as Ws,E as eh,M as th,x as je,C as xi,g as ih,b as di,D as Jt,p as Ha,R as ah,q as sh,m as Pa,X as Tn,Z as nh,d as Dn,A as rh,G as oh,S as Ki,Y as Pn}from"./editPlaneUtils.dd1c9a66.js";import{M as $n,k as lh,f as ch}from"./hydratedFeatures.b4cbc12d.js";import{e as hh}from"./mat3f64.9180efcb.js";import{W as ea,Z as ui}from"./boundedPlane.91a64206.js";import{j as dh}from"./GraphicManipulator.5182c2a7.js";import{r as Ci,p as Ua,a as Ys,l as ph,c as uh,n as _h}from"./TranslateTooltipInfos.33287c88.js";import{g as gh,l as mh}from"./axisAngleDegrees.fa497b47.js";import{g as _i}from"./persistable.bfebf5ba.js";import{Q as Cn}from"./quat.eb7bbc3a.js";import"./triangle.1c8f4155.js";import"./Indices.27b9c798.js";import"./spatialReferenceEllipsoidUtils.7f3e3256.js";import{i as fh,p as vh}from"./ExtentTooltipInfos.e2302c0a.js";let yh=i=>({vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),vo=(i,e,t)=>{for(let a=0,s=e.length;a<s;a++){let n=e[a];Array.isArray(n)?vo(i,n,t):n!=null&&n!==!1&&(typeof n=="string"&&(n=yh(n)),t.push(n))}};function bh(i,e,t){if(Array.isArray(e))t=e,e=void 0;else if(e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector"))||t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,s;return t&&t.length===1&&typeof t[0]=="string"?a=t[0]:t&&(s=[],vo(i,t,s),s.length===0&&(s=void 0)),{vnodeSelector:i,properties:e,children:s,text:a===""?void 0:a,domNode:null}}const Ln={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let se=class extends Fi{get position(){return[this.x,this.y]}set position(i){this._set("x",i[0]),this._set("y",i[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const i=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${i}`}get _padding(){return .5*this.fontSize}get _borderRadius(){return this._padding}constructor(i){super(i),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new Q([0,0,0,.6]),this.textColor=new Q([255,255,255]),this._textShadowSize=1}render(){return bh("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(i){if(!this.visible)return;const e=i.font.replace(/^(.*?)px/,"");i.font=`${this.fontSize}px ${e}`;const t=this._padding,a=this._borderRadius,s=i.measureText(this.text).width,n=this.fontSize,r=Mh[this.anchor];i.textAlign="center",i.textBaseline="middle";const o=s+2*t,l=n+2*t,c=this.x+r.x*o,p=this.y+r.y*l;this._roundedRect(i,c,p,o,l,a),i.fillStyle=this.backgroundColor.toCss(!0),i.fill();const u=this.x+(r.x+.5)*o,g=this.y+(r.y+.5)*l;this._renderTextShadow(i,this.text,u,g),i.fillStyle=this.textColor.toCss(!0),i.fillText(this.text,u,g)}_renderTextShadow(i,e,t,a){i.lineJoin="miter",i.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/As.length})`;const s=this._textShadowSize;for(const[n,r]of As)i.fillText(e,t+s*n,a+s*r)}_roundedRect(i,e,t,a,s,n){i.beginPath(),i.moveTo(e,t+n),i.arcTo(e,t,e+n,t,n),i.lineTo(e+a-n,t),i.arcTo(e+a,t,e+a,t+n,n),i.lineTo(e+a,t+s-n),i.arcTo(e+a,t+s,e+a-n,t+s,n),i.lineTo(e+n,t+s),i.arcTo(e,t+s,e,t+s-n,n),i.closePath()}_cssClasses(){const i={"esri-text-overlay-item":!0};for(const e in Ln)i[Ln[e]]=this.anchor===e;return i}};d([_()],se.prototype,"x",void 0),d([_()],se.prototype,"y",void 0),d([_()],se.prototype,"position",null),d([_()],se.prototype,"text",void 0),d([_()],se.prototype,"fontSize",void 0),d([_()],se.prototype,"anchor",void 0),d([_()],se.prototype,"visible",void 0),d([_()],se.prototype,"backgroundColor",void 0),d([_()],se.prototype,"textColor",void 0),d([_()],se.prototype,"_textShadowSize",void 0),d([_()],se.prototype,"_textShadowColor",null),d([_()],se.prototype,"_textShadow",null),d([_()],se.prototype,"_padding",null),d([_()],se.prototype,"_borderRadius",null),se=d([K("esri.views.overlay.TextOverlayItem")],se);const Mh={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},As=[];for(let e=0;e<360;e+=360/16)As.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const Sh=se,wh=3025,xh={default:15,far:25};let We=class extends Fi{constructor(i){super(i),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const i=jo(async t=>{const a=await Ho("esri/core/t9n/Units");Uo(t),this._messagesUnits=a}),e=()=>us(this.context,t=>t.editGeometryOperations);this.addHandles([I(()=>[h(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(t=>ko(e,t,()=>this._update())),It(()=>i.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return m(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(i=>i.label.text)}}get _edgeDistancePixels(){return xh[this.edgeDistance]}_update(){this._nextLabelIndex=0;const i=this.context;if(m(i))return void this._destroyUnusedLabels();const{components:e,geometry:t,coordinateHelper:a}=i.editGeometryOperations.data;if(!t)return void this._destroyUnusedLabels();const s=e.length;for(let n=0;n<s;++n){const r=[];if(e[n].iterateVertices(g=>{r.push(a.toXYZ(g.pos))}),n===0&&h(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const o=r[0],l=r[r.length-1];t.type==="polygon"&&r.length>2&&!Bo(o,l)&&r.push(o);const c=s===1&&!Wo(r,!1,!1);let p=Oh,u=Eh;this.toScreenPointArray(i,o,p);for(let g=1;g<r.length;++g){const b=r[g-1],y=r[g];this.toScreenPointArray(i,y,u),this._addLabel(i,b,p,y,u,c),[p,u]=[u,p]}}this._destroyUnusedLabels()}_addLabel(i,e,t,a,s,n){const{label:r}=this._getOrCreateLabel(i);if(!this.visible||Rr(t,s)<wh)return void(r.visible=!1);const o=h(i.graphicState)?i.graphicState.isDraped?"on-the-ground":"absolute-height":Tr(i.editGeometryOperations.data.geometry,i.elevationInfo),{spatialReference:l}=i.editGeometryOperations.data,c=zl(e,a,l,o),p=this._messagesUnits,u=Fl(i.view);r.text=h(p)&&h(c)?Nl(p,c,u):"",r.visible=!0;const g=s[0]-t[0],b=s[1]-t[1];n?Ie(Pe,-b,g):Ie(Pe,b,-g),pa(Pe,Pe),ca(Pe,Pe,this._edgeDistancePixels),Yo(gi,t,s,.5),bi(gi,gi,Pe),r.position=[gi[0],gi[1]],Math.abs(Pe[0])>Math.abs(Pe[1])?r.anchor=Pe[0]>0?"left":"right":r.anchor=-Pe[1]<0?"top":"bottom"}_getOrCreateLabel(i){var a;if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const e=new Sh({fontSize:10,anchor:"center"});(a=i.view.overlay)==null||a.items.add(e);const t={label:e};return this._labelInfos.push(t),this._nextLabelIndex=this._labelInfos.length,t}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:i}){us(this.context,e=>{var t;return(t=e.view.overlay)==null?void 0:t.items.remove(i)}),i.destroy()}};d([_()],We.prototype,"context",void 0),d([_()],We.prototype,"stagedVertex",void 0),d([_()],We.prototype,"visible",void 0),d([_()],We.prototype,"edgeDistance",void 0),d([_()],We.prototype,"updating",null),d([_()],We.prototype,"_messagesUnits",void 0),d([_()],We.prototype,"_edgeDistancePixels",null),We=d([K("esri.views.interactive")],We);const Pe=Qe(),gi=Qe(),Oh=et(),Eh=et();let $a=class extends We{getCameraOrExtent({view:i}){return i.state.camera}toScreenPointArray({view:i,elevationInfo:e,editGeometryOperations:t},a,s=et()){const{spatialReference:n}=t.data.coordinateHelper;return Dr(a,n,e,i,Gn),i.state.camera.projectToScreen(Gn,s),s}};$a=d([K("esri.views.3d.interactive.SegmentLabels3D")],$a);const Gn=M();class Ah{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=wi.Outline}destroy(){this._destroyResources()}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var a;this._renderGroup=e;const t=(a=xe(this._resources))==null?void 0:a.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?m(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?m(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var s;this._destroyResources();const e=this._resourceFactory.createResources(),t=new $t({view:this._resourceFactory.view,renderGroup:this._renderGroup}),a=(s=this._resourceFactory.view.basemapTerrain)==null?void 0:s.overlayManager;this._resources={layerView:new $t({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},a&&(this._resources.drapeSourceRenderer=a.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){var t;if(m(this._resources))return;this._ensureRenderGeometriesRemoved();const e=(t=this._resourceFactory.view.basemapTerrain)==null?void 0:t.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){m(this._resources)||m(this._resources.drapeSourceRenderer)||!this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,Sn.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){m(this._resources)||m(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,Sn.UPDATE),this._resources.geometriesAdded=!0)}}let $t=class extends Xo(Fi){constructor(i){super(i),this.drapeSourceType=Ql.Features,this.updatePolicy=za.SYNC,this.renderGroup=wi.Outline}};d([_({constructOnly:!0})],$t.prototype,"view",void 0),d([_({readOnly:!0})],$t.prototype,"drapeSourceType",void 0),d([_()],$t.prototype,"renderGroup",void 0),$t=d([K("DrapedVisualElementLayerView")],$t);class Xs{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=I(()=>this.view.ready,t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const a in e)a in this?a==="attached"?t=e[a]:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}class yo{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return h(this._resources)?this._resources.object:null}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(m(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(a=>{a.type!==kt.Mesh&&a.type!==kt.Line&&a.type!==kt.Point||e.remove(a)}),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach(a=>{a.type!==kt.Mesh&&a.type!==kt.Line&&a.type!==kt.Point||e.add(a)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,a=t._stage;if(!a)return;const s=new Ns({pickable:!1,updatePolicy:za.SYNC});a.add(s);const n=new js({castShadow:!1}),r=e.createResources(n,s);r.forEach(c=>{a.add(c),c instanceof ao&&a.loadImmediate(c)}),a.add(n),s.add(n);const o=e.cameraChanged,l=o?I(()=>t.state.camera,c=>o(c),Ze):null;this._resources={layer:s,object:n,external:r,cameraHandle:l},this._syncVisible()}_destroyResources(){var t;if(m(this._resources))return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this._resources.external.forEach(a=>e.remove(a))),this._resources.object.dispose(),(t=this._resources.cameraHandle)==null||t.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){m(this._resources)||(this._resources.object.visible=this._visible)}}class ka extends Xs{constructor({view:e,isDraped:t}){super(e),this._isDraped=!1,this.object3dResources=new yo(this.createObject3DResourceFactory(e)),this.drapedResources=new Ah(this.createDrapedResourceFactory(e)),this.isDraped=t!=null?t:!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}function bo(i,e){i.extensions.add("GL_OES_standard_derivatives");const t=i.fragment;t.include(dc),i.include(pc),t.uniforms.add([new de("globalAlpha",a=>a.globalAlpha),new lt("glowColor",a=>a.glowColor),new de("glowWidth",(a,s)=>a.glowWidth*s.camera.pixelRatio),new de("glowFalloff",a=>a.glowFalloff),new lt("innerColor",a=>a.innerColor),new de("innerWidth",(a,s)=>a.innerWidth*s.camera.pixelRatio),new Os("depthMap",(a,s)=>s.linearDepthTexture),new Lt("nearFar",(a,s)=>s.camera.nearFar),new Os("frameColor",(a,s)=>s.mainColorTexture)]),t.code.add(T`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),t.code.add(T`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),t.code.add(T`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),t.code.add(T`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),e.contrastControlEnabled?(t.uniforms.add(new de("globalAlphaContrastBoost",a=>h(a.globalAlphaContrastBoost)?a.globalAlphaContrastBoost:1)),t.code.add(T`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):t.code.add(T`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}function Rh(i){const e=new Ui;e.include(bo,i);const{vertex:t,fragment:a}=e;return t.uniforms.add([new xn("modelView",(s,n)=>ua(Dh,n.camera.viewMatrix,s.origin)),new xn("proj",(s,n)=>n.camera.projectionMatrix),new de("glowWidth",(s,n)=>s.glowWidth*n.camera.pixelRatio),new Lt("pixelToNDC",(s,n)=>Ie(Th,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))]),e.attributes.add(A.START,"vec3"),e.attributes.add(A.END,"vec3"),e.attributes.add(A.UP,"vec3"),e.attributes.add(A.EXTRUDE,"vec2"),e.varyings.add("uv","vec2"),e.varyings.add("vViewStart","vec3"),e.varyings.add("vViewEnd","vec3"),e.varyings.add("vViewPlane","vec4"),t.code.add(T`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),a.uniforms.add(new de("perScreenPixelRatio",(s,n)=>n.camera.perScreenPixelRatio)),a.code.add(T`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),e}const Th=Qe(),Dh=be(),Ph=Object.freeze(Object.defineProperty({__proto__:null,build:Rh},Symbol.toStringTag,{value:"Module"}));class Ba extends ki{initializeProgram(e){return new Bi(e.rctx,Ba.shader.get().build(this.configuration),Mo)}initializePipeline(){return Yi({blending:Bs(qe.ONE,qe.ONE_MINUS_SRC_ALPHA),colorWrite:Xi})}}Ba.shader=new Wi(Ph,()=>Ni(()=>import("./LaserlinePath.glsl.3a6710cb.js"),["assets/LaserlinePath.glsl.3a6710cb.js","assets/index.3255d2a5.js","assets/index.e51050de.css","assets/mat4f64.9070f685.js","assets/OrderIndependentTransparency.43c6e481.js","assets/enums.3c1fa5b5.js","assets/basicInterfaces.f8f3b23b.js","assets/VertexColor.glsl.e3d82815.js","assets/requestImageUtils.828b299e.js","assets/Texture.d66dc1cb.js","assets/VertexArrayObject.ad007c8f.js","assets/Util.3efb1a6b.js","assets/triangle.1c8f4155.js","assets/sphere.67ec4acb.js","assets/mat3f64.9180efcb.js","assets/quatf64.1dc83f1c.js","assets/lineSegment.1a0fd96e.js","assets/Indices.27b9c798.js","assets/VertexAttribute.34e3daf1.js","assets/doublePrecisionUtils.d6c628ce.js","assets/quat.eb7bbc3a.js","assets/vec3f32.4d8dc001.js","assets/BufferView.32a50625.js","assets/VertexElementDescriptor.5da9dfe9.js","assets/automaticLengthMeasurementUtils.06e82903.js","assets/spatialReferenceEllipsoidUtils.7f3e3256.js","assets/vec4f32.c3d64d30.js","assets/Octree.449e609a.js","assets/plane.a0a08b54.js","assets/NativeLineMaterial.6f545af4.js","assets/Attribute.98e6fe67.js","assets/triangulationUtils.2ec0b7a6.js","assets/earcut.a219bf29.js","assets/deduplicate.97d7ef01.js","assets/hydratedFeatures.b4cbc12d.js","assets/InterleavedLayout.a42ad5fa.js","assets/types.bf551170.js","assets/NestedMap.2ac03b78.js","assets/floatRGBA.7b501bd7.js","assets/boundedPlane.91a64206.js","assets/glUtil.9de5d1d0.js","assets/SnappingContext.023005d4.js","assets/PointSnappingHint.08747e02.js","assets/editPlaneUtils.dd1c9a66.js","assets/GraphicManipulator.5182c2a7.js","assets/TranslateTooltipInfos.33287c88.js","assets/axisAngleDegrees.fa497b47.js","assets/persistable.bfebf5ba.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.8c0303d1.js","assets/ExtentTooltipInfos.e2302c0a.js"]));const Mo=new Map([[A.START,0],[A.END,1],[A.UP,2],[A.EXTRUDE,3]]);class In{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=M(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=Ta(3*e.length);let a=0;for(const s of e)t[a++]=s[0],t[a++]=s[1],t[a++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const t=this._buffers[0],a=3*Math.floor(t.length/3/2);X(this._origin,t[a+0],t[a+1],t[a+2])}else X(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);h(t)&&(e.bindVAO(t),e.drawArrays(fo.TRIANGLES,0,this._count))}dispose(){h(this._vao)&&this._vao.dispose()}_ensureVAO(e){return m(this._buffers)?null:(m(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const a=this._createDataBuffer(t);return this._dirty=!1,new uc(e,Mo,{data:Pc(zn)},{data:Hc.createVertex(e,jc.STATIC_DRAW,a)})}_ensureVertexData(e,t){var s;if(!this._dirty)return;const a=this._createDataBuffer(t);(s=e.vertexBuffers.data)==null||s.setData(a),this._dirty=!1}_numberOfRenderVertices(e){return 3*(2*(e.length/3-1))}_createDataBuffer(e){const t=e.reduce((o,l)=>o+this._numberOfRenderVertices(l),0);this._count=t;const a=zn.createBuffer(t),s=this._origin;let n=0,r=0;for(const o of e){for(let l=0;l<o.length;l+=3){const c=X(Vn,o[l+0],o[l+1],o[l+2]);l===0?r=this._renderCoordsHelper.getAltitude(c):this._renderCoordsHelper.setAltitude(c,r);const p=this._renderCoordsHelper.worldUpAtPosition(c,$h),u=n+2*l,g=N(Vn,c,s);if(l<o.length-3){a.up.setVec(u,p),a.up.setVec(u+3,p),a.up.setVec(u+5,p);for(let b=0;b<6;b++)a.start.setVec(u+b,g);a.extrude.setValues(u+0,0,-1),a.extrude.setValues(u+1,1,-1),a.extrude.setValues(u+2,1,1),a.extrude.setValues(u+3,0,-1),a.extrude.setValues(u+4,1,1),a.extrude.setValues(u+5,0,1)}if(l>0){a.up.setVec(u-2,p),a.up.setVec(u-4,p),a.up.setVec(u-5,p);for(let b=-6;b<0;b++)a.end.setVec(u+b,g)}}n+=this._numberOfRenderVertices(o)}return a.buffer}}const $h=M(),Vn=M(),zn=po().vec3f(A.START).vec3f(A.END).vec3f(A.UP).vec2f(A.EXTRUDE);class Zs extends _c{constructor(){super(...arguments),this.contrastControlEnabled=!1}}d([H()],Zs.prototype,"contrastControlEnabled",void 0);const So=pt(6);function Ch(i){const e=new Ui;e.extensions.add("GL_OES_standard_derivatives"),e.include(gc),e.include(bo,i);const t=e.fragment;if(i.lineVerticalPlaneEnabled||i.heightManifoldEnabled)if(t.uniforms.add(new de("maxPixelDistance",(a,s)=>i.heightManifoldEnabled?2*s.camera.computeScreenPixelSizeAt(a.heightManifoldTarget):2*s.camera.computeScreenPixelSizeAt(a.lineVerticalPlaneSegment.origin))),t.code.add(T`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),i.spherical){const a=(n,r,o)=>ve(n,r.heightManifoldTarget,o.camera.viewMatrix),s=(n,r)=>ve(n,[0,0,0],r.camera.viewMatrix);t.uniforms.add([new Mt("heightManifoldOrigin",(n,r)=>(a(Xe,n,r),s(qt,r),N(qt,qt,Xe),le(we,qt),we[3]=Re(qt),we)),new lt("globalOrigin",(n,r)=>s(Xe,r)),new de("cosSphericalAngleThreshold",(n,r)=>1-Math.max(2,_a(r.camera.eye,n.heightManifoldTarget)*r.camera.perRenderPixelRatio)/Re(n.heightManifoldTarget))]),t.code.add(T`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else t.code.add(T`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(i.pointDistanceEnabled&&(t.uniforms.add(new de("maxPixelDistance",(a,s)=>2*s.camera.computeScreenPixelSizeAt(a.pointDistanceTarget))),t.code.add(T`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),i.intersectsLineEnabled&&(t.uniforms.add(new de("perScreenPixelRatio",(a,s)=>s.camera.perScreenPixelRatio)),t.code.add(T`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(i.lineVerticalPlaneEnabled||i.intersectsLineEnabled)&&t.code.add(T`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.code.add(T`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),i.heightManifoldEnabled){t.uniforms.add([new Lt("angleCutoff",s=>ta(s)),new Mt("heightPlane",(s,n)=>wo(s.heightManifoldTarget,s.renderCoordsHelper.worldUpAtPosition(s.heightManifoldTarget,Xe),n.camera.viewMatrix))]);const a=i.spherical?T`normalize(globalOrigin - pos)`:T`heightPlane.xyz`;t.code.add(T`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${a})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return i.pointDistanceEnabled&&(t.uniforms.add([new Lt("angleCutoff",a=>ta(a)),new Mt("pointDistanceSphere",(a,s)=>Lh(a,s))]),t.code.add(T`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),i.lineVerticalPlaneEnabled&&(t.uniforms.add([new Lt("angleCutoff",a=>ta(a)),new Mt("lineVerticalPlane",(a,s)=>Gh(a,s)),new lt("lineVerticalStart",(a,s)=>Ih(a,s)),new lt("lineVerticalEnd",(a,s)=>Vh(a,s))]),t.code.add(T`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),i.intersectsLineEnabled&&(t.uniforms.add([new Lt("angleCutoff",a=>ta(a)),new lt("intersectsLineStart",(a,s)=>ve(Xe,a.lineStartWorld,s.camera.viewMatrix)),new lt("intersectsLineEnd",(a,s)=>ve(Xe,a.lineEndWorld,s.camera.viewMatrix)),new lt("intersectsLineDirection",(a,s)=>(U(we,a.intersectsLineSegment.vector),we[3]=0,le(Xe,Pr(we,we,s.camera.viewMatrix)))),new de("intersectsLineRadius",a=>a.intersectsLineRadius)]),t.code.add(T`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),t.code.add(T`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),e}function ta(i){return Ie(zh,Math.cos(i.angleCutoff),Math.cos(Math.max(0,i.angleCutoff-pt(2))))}function Lh(i,e){return ve(ns,i.pointDistanceOrigin,e.camera.viewMatrix),ns[3]=_a(i.pointDistanceOrigin,i.pointDistanceTarget),ns}function Gh(i,e){const t=Dt(i.lineVerticalPlaneSegment,.5,Xe),a=i.renderCoordsHelper.worldUpAtPosition(t,Fh),s=le(qt,i.lineVerticalPlaneSegment.vector),n=He(we,a,s);return le(n,n),wo(i.lineVerticalPlaneSegment.origin,n,e.camera.viewMatrix)}function Ih(i,e){const t=U(Xe,i.lineVerticalPlaneSegment.origin);return i.renderCoordsHelper.setAltitude(t,0),ve(t,t,e.camera.viewMatrix)}function Vh(i,e){const t=Z(Xe,i.lineVerticalPlaneSegment.origin,i.lineVerticalPlaneSegment.vector);return i.renderCoordsHelper.setAltitude(t,0),ve(t,t,e.camera.viewMatrix)}function wo(i,e,t){return ve(Fn,i,t),U(we,e),we[3]=0,Pr(we,we,t),Ft(Fn,we,Nh)}const zh=Qe(),Xe=M(),we=$r(),Fh=M(),qt=M(),Fn=M(),Nh=hi(),ns=Xl(),jh=Object.freeze(Object.defineProperty({__proto__:null,build:Ch,defaultAngleCutoff:So},Symbol.toStringTag,{value:"Module"}));class Hh extends Lc{constructor(){super(...arguments),this.innerColor=j(1,1,1),this.innerWidth=1,this.glowColor=j(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=pt(6),this.pointDistanceOrigin=M(),this.pointDistanceTarget=M(),this.lineVerticalPlaneSegment=$i(),this.intersectsLineSegment=$i(),this.intersectsLineRadius=3,this.heightManifoldTarget=M(),this.lineStartWorld=M(),this.lineEndWorld=M()}}class Wa extends ki{initializeProgram(e){return new Bi(e.rctx,Wa.shader.get().build(this.configuration),Us)}initializePipeline(){return Yi({blending:Bs(qe.ONE,qe.ONE_MINUS_SRC_ALPHA),colorWrite:Xi})}}Wa.shader=new Wi(jh,()=>Ni(()=>import("./Laserlines.glsl.199bf16a.js"),["assets/Laserlines.glsl.199bf16a.js","assets/index.3255d2a5.js","assets/index.e51050de.css","assets/lineSegment.1a0fd96e.js","assets/sphere.67ec4acb.js","assets/mat3f64.9180efcb.js","assets/mat4f64.9070f685.js","assets/quatf64.1dc83f1c.js","assets/plane.a0a08b54.js","assets/OrderIndependentTransparency.43c6e481.js","assets/enums.3c1fa5b5.js","assets/basicInterfaces.f8f3b23b.js","assets/VertexColor.glsl.e3d82815.js","assets/requestImageUtils.828b299e.js","assets/Texture.d66dc1cb.js","assets/VertexArrayObject.ad007c8f.js","assets/Util.3efb1a6b.js","assets/triangle.1c8f4155.js","assets/Indices.27b9c798.js","assets/VertexAttribute.34e3daf1.js","assets/doublePrecisionUtils.d6c628ce.js","assets/quat.eb7bbc3a.js","assets/vec3f32.4d8dc001.js","assets/BufferView.32a50625.js","assets/VertexElementDescriptor.5da9dfe9.js","assets/automaticLengthMeasurementUtils.06e82903.js","assets/spatialReferenceEllipsoidUtils.7f3e3256.js","assets/vec4f32.c3d64d30.js","assets/Octree.449e609a.js","assets/NativeLineMaterial.6f545af4.js","assets/Attribute.98e6fe67.js","assets/triangulationUtils.2ec0b7a6.js","assets/earcut.a219bf29.js","assets/deduplicate.97d7ef01.js","assets/hydratedFeatures.b4cbc12d.js","assets/InterleavedLayout.a42ad5fa.js","assets/types.bf551170.js","assets/NestedMap.2ac03b78.js","assets/floatRGBA.7b501bd7.js","assets/boundedPlane.91a64206.js","assets/glUtil.9de5d1d0.js","assets/SnappingContext.023005d4.js","assets/PointSnappingHint.08747e02.js","assets/editPlaneUtils.dd1c9a66.js","assets/GraphicManipulator.5182c2a7.js","assets/TranslateTooltipInfos.33287c88.js","assets/axisAngleDegrees.fa497b47.js","assets/persistable.bfebf5ba.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.8c0303d1.js","assets/ExtentTooltipInfos.e2302c0a.js"]));class Qt extends Zs{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}d([H()],Qt.prototype,"heightManifoldEnabled",void 0),d([H()],Qt.prototype,"pointDistanceEnabled",void 0),d([H()],Qt.prototype,"lineVerticalPlaneEnabled",void 0),d([H()],Qt.prototype,"intersectsLineEnabled",void 0),d([H()],Qt.prototype,"spherical",void 0);class Uh{constructor(e,t={contrastControlEnabled:!1}){this._config=t,this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=Ei.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._passParameters=mc(e,new Hh)}get renderSlots(){return[this._config.contrastControlEnabled?Ae.LASERLINES_CONTRAST_CONTROL:Ae.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){U(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){U(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){U(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Oa(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){Oa(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,h(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){m(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new In(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){m(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new In(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){fc(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=vc(t),this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new Qt;const a=new Zs;a.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(Ba,a)}uninitializeRenderContext(){this._quadVAO=tn(this._quadVAO),this._technique=an(this._technique),this._pathVerticalPlaneData=tn(this._pathVerticalPlaneData),this._pathTechnique=an(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===Ei.Global,this._technique=this._techniqueRepository.releaseAndAcquire(Wa,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const a=e.rctx;this._updatePassParameters(e),a.bindTechnique(t,this._passParameters,e.bindParameters),a.bindVAO(this._quadVAO),a.drawArrays(fo.TRIANGLE_STRIP,0,4)}_renderPath(e){if(m(this._pathVerticalPlaneData)||m(this._pathTechnique))return;const t=e.rctx,a=this._pathTechnique;t.bindTechnique(a,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if(Qr(Ms(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),mi),mi.c0=-Number.MAX_VALUE,!Jr(t.frustum,mi))return;Kr(mi,this._passParameters.lineStartWorld),eo(mi,this._passParameters.lineEndWorld)}else U(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),Z(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}}const mi=qr();class Li extends Xs{constructor(e){super(e.view),this._angleCutoff=So,this._style={},this._heightManifoldTarget=M(),this._heightManifoldEnabled=!1,this._intersectsLine=$i(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){h(e)?(U(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(m(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,kh);this.intersectsLine=Bl(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){h(e)?(Oa(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=h(e)?Oa(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=h(e)?{origin:ga(e.origin),target:e.target?ga(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||h(this._pointDistanceLine)||h(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){h(this._renderer)||(this._renderer=new Uh({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))}_syncStyle(){m(this._renderer)||(this._renderer.setParameters(this._style),this._style.intersectsLineRadius!=null&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){m(this._renderer)||this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){m(this._renderer)||(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){m(this._renderer)||(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){m(this._renderer)||(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){m(this._renderer)||(this._renderer.pathVerticalPlaneEnabled=h(this._pathVerticalPlaneBuffers)&&this.visible,h(this._pathVerticalPlaneBuffers)&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){m(this._renderer)||(this._renderer.lineVerticalPlaneEnabled=h(this._lineVerticalPlaneSegment)&&this.visible,h(this._lineVerticalPlaneSegment)&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(m(this._renderer))return;const e=this._pointDistanceLine,t=h(e);this._renderer.pointDistanceEnabled=t&&e.target!=null&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){h(this._renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const kh=M();class Ya extends ka{constructor(e){super(e),this._ray=Hi(),this._isWorldDown=!1,this._start=M(),this._end=j(1,0,0),this._width=1,this._color=Pi(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Pi(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Se.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=R.OccludeAndTransparent,this._fadedExtensions=Hn,this._laserline=new Li({view:this.view}),this.applyProps(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,a)=>this._recreateObject3DGeometry(t,a),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,U(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),N(this._end,e,this._end),as(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,ai(this._start,e)||(U(this._start,e),as(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,ai(this._end,e)||(U(this._end,e),as(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Fe(e,this._color)||(Ue(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Fe(e,this._innerColor)||(Ue(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=h(e)!==h(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(m(e)||m(this._stippleOffColor)||!Fe(e,this._stippleOffColor))&&(this._stippleOffColor=h(e)?Zr(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&h(this._laserlineStyle)&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,h(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===R.OccludeAndTransparentStencil?R.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=re(e,Hn),this.recreateGeometry()}_updateMaterial(){var t,a;const{materialParameters:e}=this;(t=xe(this.object3dResources.resources))==null||t.material.setParameters(e),(a=xe(this.drapedResources.resources))==null||a.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new tt(this.materialParameters),a=new Array;return this._createObject3DGeometry(t,e,a),{material:t,geometries:a,forEach:s=>{s(t),a.forEach(s)}}}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,a){const s=this._createGeometry(e);a.push(s),t.addGeometry(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new tt(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);this._updateVerticesDraped(t);const a=new Fa(t,{boundingInfo:t.boundingInfo});return a.computeBoundingSphere(a.transformation,a.boundingSphere),a}_createGeometry(e){const t=this.extensionType===Se.FADED,a=t?[M(),M(),M(),M()]:[M(),M()];return Ne(e,a,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=xe(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===Se.FADED?this._updateLineSegmentFinite(Nn):this._updateLineSegmentInfinite(this._extensionType,Nn)}_updateLineSegmentFinite(e){return Ea(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const a=this.view.state.camera;switch(Qr(this._ray,mt),e){case Se.LINE:mt.c0=-Number.MAX_VALUE;break;case Se.RAY:case Se.GROUND_RAY:{const r=this._ray.origin,o=re(this.view.elevationProvider.getElevation(r[0],r[1],r[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),l=this.view.renderCoordsHelper.getAltitude(r);this._isWorldDown&&l<o&&Zo(mt.ray.direction,mt.ray.direction),this._extensionType===Se.GROUND_RAY&&o!=null&&(mt.c1=Math.abs(l-o));break}}if(!Jr(a.frustum,mt))return this._updateLineSegmentFinite(t);const s=Kr(mt,Ot),n=eo(mt,Bh);return Ea(s,n,t)}_updateVertexAttributesObject3D(e,t){var n;const a=(n=e.geometries[0].getMutableAttribute(A.POSITION))==null?void 0:n.data;if(!a)return;let s=0;for(const r of this._lineVertices(t))a[s++]=r[0],a[s++]=r[1],a[s++]=r[2];e.geometryVertexAttrsUpdated(e.geometries[0])}_updateVertexAttributesDraped(e,t){var n;const a=(n=e.getMutableAttribute(A.POSITION))==null?void 0:n.data;if(!a)return;let s=0;for(const r of this._lineVertices(t))a[s++]=r[0],a[s++]=r[1],a[s++]=Aa;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===Se.FADED?(yield Dt(e,-this.fadedExtensions.start,Ot),yield Dt(e,0,Ot),yield Dt(e,1,Ot),yield Dt(e,1+this.fadedExtensions.end,Ot)):(yield Dt(e,0,Ot),yield Dt(e,1,Ot))}}const mt=qr(),Ot=M(),Bh=M(),Nn=$i();var Se;(function(i){i[i.LINE=0]="LINE",i[i.RAY=1]="RAY",i[i.GROUND_RAY=2]="GROUND_RAY",i[i.FADED=3]="FADED"})(Se||(Se={}));const jn=1/3,Hn={start:jn,end:jn};class Wh extends ka{constructor(e){super(e),this._location=M(),this._direction=j(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Pi(1,0,1,1),this._renderOccluded=R.OccludeAndTransparent,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),recreateGeometry:(t,a)=>this._recreateObject3DGeometry(t,a),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){ai(this._location,e)||(U(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){ai(this._direction,e)||(U(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){le(this._direction,N(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Fe(e,this._color)||(Ue(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new tt(this.materialParameters),a=new Array;return this._createObject3DGeometry(t,e,a),{material:t,geometries:a,forEach:s=>{s(t),a.forEach(s)}}}_destroyObject3DResources(e){e.geometries.length=0,e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,a){const[s,n]=this._createGeometries(e);t.addGeometry(s),t.addGeometry(n),a.push(s),a.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new tt(this.materialParameters),t=I(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);this._updateVerticesDraped(t);const a=t.map(s=>new Fa(s,{boundingInfo:s.boundingInfo}));for(const s of a)s.computeBoundingSphere(s.transformation,s.boundingSphere);return a}_createGeometries(e){return[Ne(e,[M(),M()]),Ne(e,[M(),M()])]}_updateMaterial(){var t,a;const{materialParameters:e}=this;(t=xe(this.object3dResources.resources))==null||t.material.setParameters(e),(a=xe(this.drapedResources.resources))==null||a.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=xe(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,aa),Z(Be,this.location,this.direction),t.projectToScreen(Be,Bt),pa(Bt,Cr(Bt,Bt,aa)),this._updateVertexAttributesObject3D(t,e,0,aa,Bt,1),this._updateVertexAttributesObject3D(t,e,1,aa,Bt,-1)}_updateVertexAttributesObject3D(e,t,a,s,n,r){var u;const o=t.geometries[a],l=(u=o.getMutableAttribute(A.POSITION))==null?void 0:u.data;if(!l)return;const{start:c,end:p}=this._computeStartEnd(n,s,r,this.offset,this.width,this.length);e.unprojectFromScreen(ma(c),Be),l[0]=Be[0],l[1]=Be[1],l[2]=Be[2],e.unprojectFromScreen(ma(p),Be),l[3]=Be[0],l[4]=Be[1],l[5]=Be[2],t.geometryVertexAttrsUpdated(o)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:a}}}=this,{location:s,width:n,length:r,offset:o}=this,l=Yh;l.spatialReference=L(t.renderer.spatialReference),l.x=s[0],l.y=s[1];const c=t.overlayPixelSizeInMapUnits(l)*a,p=n*c,u=r*c,g=o*c;this._updateVertexAttributesDraped(e[0],p,u,g,-1),this._updateVertexAttributesDraped(e[1],p,u,g,1)}_updateVertexAttributesDraped(e,t,a,s,n){var u;const r=(u=e.getMutableAttribute(A.POSITION))==null?void 0:u.data;if(!r)return;const{location:o,direction:l}=this,{start:c,end:p}=this._computeStartEnd(l,o,n,s,t,a);r[0]=c[0],r[1]=c[1],r[2]=Aa,r[3]=p[0],r[4]=p[1],r[5]=Aa,e.invalidateBoundingInfo()}_computeStartEnd(e,t,a,s,n,r){const o=ca(Un,Ie(Un,e[1]*a,e[0]*-a),s+n/2),l=bi(ia,bi(ia,bi(ia,t,ca(ia,e,r/2)),o),o);return{start:l,end:bi(kn,l,ca(kn,e,-r))}}}const Be=M(),Un=Qe(),ia=Qe(),kn=Qe(),aa=et(),Bt=et(),Yh=jt(0,0,void 0,null);class Rs{constructor(e){var a;this.view=null,this._geometry=null,this._size=3,this._color=Te(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Te(1,1,1,1),this._elevationInfo=null,this._resources=new yo({view:e.view,createResources:s=>this._createResources(s),destroyResources:s=>this._destroyResources(s),recreateGeometry:(s,n)=>{s.geometry=this._recreateGeometry(n,s.material)}});let t=!0;for(const s in e)s in this?s==="attached"?t=(a=e[s])!=null?a:!1:this[s]=e[s]:console.error("Cannot set unknown property",s);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?h(this._resources)&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){Fe(e,this._color)||(Ue(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,h(this._resources)&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Fe(e,this._outlineColor)||(Ue(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;m(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if(m(e)||m(t))return;const a=e.geometry;if(m(a))return;const s=a.getMutableAttribute(A.SIZE).data,n=this._geometrySize;s[0]=n,s[1]=n,t.geometryVertexAttrsUpdated(t.geometries[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Xh,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/Si}_recreateGeometry(e,t){const a=this._createRenderGeometry(t);return h(a)&&e.addGeometry(a),a}_createResources(e){const t=Jl(this._primitive,this._preferredTextureSize),a=new Kl(this._materialParameters(t.id)),s=this._recreateGeometry(e,a);return{material:a,texture:t,geometry:s,forEach(n){n(t),n(a),h(this.geometry)&&n(this.geometry)}}}_destroyResources(e){e.geometry=null,e.material.dispose(),e.texture.dispose()}get _preferredTextureSize(){return fa(qo(2*this._geometrySize),16,128)}calculateMapBounds(e){if(m(this._resources.resources)||m(this._resources.resources.geometry))return!1;const t=this._resources.resources.geometry.vertexAttributes.get(A.POSITION);return Ai(t.data,this.view.renderCoordsHelper.spatialReference,Bn,this.view.spatialReference),_s(e,Bn),!0}_createRenderGeometry(e){const t=this.geometry;if(m(t))return null;const{renderCoordsHelper:a,elevationProvider:s}=this.view,n=Na(t,s,ci.fromElevationInfo(this.elevationInfo),a),r=X(w.get(),t.x,t.y,n),o=w.get();Ai(r,t.spatialReference,o,a.spatialReference);const l=this._geometrySize;return ec(e,null,o,null,[l,l],[0,0,0,1])}}const Si=tc,Xh=[Si/2,Si/2,1-Si/2,1-Si/2],Bn=M();class Zh extends ka{constructor(e){super(e),this._maxSize=0,this._position=M(),this._up=M(),this._right=M(),this._renderOccluded=R.OccludeAndTransparent,this._color=Te(1,0,0,1),this._outlineColor=Te(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=R.Opaque,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Ue(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Ue(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:a}){this._maxSize=Math.min(_a(t,e),_a(t,a))/3,le(this._up,N(this._up,e,t)),le(this._right,N(this._right,a,t)),U(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new ze(this._quadMaterialParameters),a=this._outlineSize===0?void 0:new tt(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,a),{quadMaterial:t,outlineMaterial:a,forEach:s=>{s(t),a&&s(a)}}}_destroyObject3DResources(e){var t;e.quadMaterial.dispose(),(t=e.outlineMaterial)==null||t.dispose()}_createObject3DGeometries(e,t,a){if(ai(this._up,gs)&&ai(this._right,gs))return;const s=this._createGeometries(t,a);for(const n of s)e.addGeometry(n);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new ze(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new tt(this._outlineMaterialParameters),a=this._createGeometries(e,t).map(s=>new Fa(s,{boundingInfo:s.boundingInfo}));return this._setTransformDraped(a),{quadMaterial:e,outlineMaterial:t,geometries:a,pixelRatioHandle:I(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_destroyDrapedResources(e){var t;e.pixelRatioHandle.remove(),e.geometries=[],(t=e.outlineMaterial)==null||t.dispose(),e.quadMaterial.dispose()}_createGeometries(e,t){const{up:a,right:s,corner:n}=this._getVertices(),r=this._quadGeometryData(a,s,n,e);return t?[r,Ne(t,[a,n,s])]:[r]}_getVertices(){let e=this._up,t=this._right;const a=Z(w.get(),e,t);return this.isDraped&&(e=U(w.get(),e),t=U(w.get(),t),e[2]=0,t[2]=0,a[2]=0),{up:e,right:t,corner:a}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=xe(this.object3dResources.object)){if(!e)return;const t=this.view.state.camera,a=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,a);va(ft,this._position),si(ft,ft,[s,s,s]),e.transformation=ft}_setTransformDraped(e){if(e.length===0)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:a}}}=this,{_position:s,_size:n}=this,r=U(w.get(),s);r[2]=Aa;const o=qh;o.spatialReference=L(t.renderer.spatialReference),o.x=r[0],o.y=r[1];const l=n*(t.overlayPixelSizeInMapUnits(o)*a),c=Math.min(this._maxSize,l);va(ft,r),si(ft,ft,[c,c,1]);for(const p of e)p.updateTransformation(u=>{Is(u,ft)})}_quadGeometryData(e,t,a,s){return new so(s,[[A.POSITION,new Es([0,0,0,...t,...e,...a],3,!0)]],[[A.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){var e,t;(e=xe(this.object3dResources.resources))==null||e.quadMaterial.setParameters(this._quadMaterialParameters),(t=xe(this.drapedResources.resources))==null||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){var e,t,a,s;(t=(e=xe(this.object3dResources.resources))==null?void 0:e.outlineMaterial)==null||t.setParameters(this._outlineMaterialParameters),(s=(a=xe(this.drapedResources.resources))==null?void 0:a.outlineMaterial)==null||s.setParameters(this._outlineMaterialParameters)}}const ft=be(),qh=jt(0,0,void 0,null);class Gi extends kc{sortUniqueHints(e){return e.sort((t,a)=>(a instanceof sn?a.length:0)-(t instanceof sn?t.length:0))}visualizeIntersectionPoint(e,t){const{spatialReference:a,view:s}=t;return Oe(new Rs({view:s,primitive:"circle",geometry:nn(e.intersectionPoint,a),elevationInfo:e.isDraped?rn:on,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Q.toUnitRGBA(te.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:a,spatialReference:s}=t,n=this._alignPoint(e.point,e.domain,t);return Oe(new Rs({view:a,primitive:"circle",geometry:nn(n,s),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Q.toUnitRGBA(te.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:a,spatialReference:s}=t,n=this._alignPoint(e.lineStart,e.domain,t),r=this._alignPoint(e.lineEnd,e.domain,t);return Oe(this._createLineSegmentHint(e.type,n,r,s,this._hintElevationInfo(e,t),a,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:a,spatialReference:s}=t,{isDraped:n}=e,r=this._hintElevationInfo(e,t),o=this._alignPoint(e.lineStart,e.domain,t),l=this._alignPoint(e.lineEnd,e.domain,t),c=Et(o,s,r,a,n),p=Et(l,s,r,a,n),u=Lr(p,c,p,.5),g=new Wh({view:a,attached:!1,offset:te.parallelLineHintOffset,length:te.parallelLineHintLength,width:te.parallelLineHintWidth,color:Q.toUnitRGBA(te.orange),location:u,renderOccluded:n?R.OccludeAndTransparent:R.Opaque,isDraped:n,renderGroup:wi.SnappingHint});return g.setDirectionFromPoints(c,u),g.attached=!0,Oe(g)}visualizeRightAngleQuad(e,t){const{view:a,spatialReference:s}=t,n=this._hintElevationInfo(e,t),{isDraped:r}=e,o=this._alignPoint(e.previousVertex,e.domain,t),l=this._alignPoint(e.centerVertex,e.domain,t),c=this._alignPoint(e.nextVertex,e.domain,t),p=Et(o,s,n,a,r),u=Et(l,s,n,a,r),g=Et(c,s,n,a,r);return Oe(new Zh({view:a,attached:!0,color:r?Q.toUnitRGBA(te.orangeTransparent):Q.toUnitRGBA(te.orange),renderOccluded:r?R.OccludeAndTransparent:R.Transparent,outlineRenderOccluded:r?R.OccludeAndTransparent:R.Opaque,outlineColor:Q.toUnitRGBA(te.orange),outlineSize:te.rightAngleHintOutlineSize,size:te.rightAngleHintSize,isDraped:r,geometry:{previous:p,center:u,next:g},renderGroup:wi.SnappingHint}))}_createLineSegmentHint(e,t,a,s,n,r,o=!1,l=!0,c=!0){const p=Et(t,s,n,r,o),u=Et(a,s,n,r,o),g=new Ya({view:r,extensionType:Se.FADED,start:p,end:u,isDraped:o,color:Q.toUnitRGBA(te.orange),renderOccluded:o?R.OccludeAndTransparent:R.Opaque,renderGroup:wi.SnappingHint});switch(e){case ts.TARGET:g.width=te.lineHintWidthTarget,g.fadedExtensions={start:0,end:te.lineHintFadedExtensions};break;case ts.REFERENCE_EXTENSION:g.width=te.lineHintWidthReference,g.fadedExtensions={start:0,end:0};break;case ts.REFERENCE:g.width=te.lineHintWidthReference,g.fadedExtensions={start:l?te.lineHintFadedExtensions:0,end:c?te.lineHintFadedExtensions:0}}return g.attached=!0,g}_alignPoint(e,t,a){const s=this._getSelfSnappingZ(t,a);return m(s)?e:Qo(e[0],e[1],s)}_hintElevationInfo(e,t){return h(this._getSelfSnappingZ(e.domain,t))?L(t.selfSnappingZ).elevationInfo:e.isDraped?rn:on}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===Jo.SELF&&h(t)?t.value:null}}function Et(i,e,t,a,s,n=M()){if(s){const r=a.basemapTerrain.overlayManager.renderer.spatialReference;Ai(i,e,n,r)}else Dr(i,e,t,a,n);return n}const P={main:new Q([255,127,0]),selected:new Q([255,255,255]),staged:new Q([12,207,255]),outline:new Q([0,0,0,.5]),selectedOutline:new Q([255,255,255])},ti=.3;function Ii(i,e){const t=i.clone();return t.a*=e,t}function Qh(i,e){const t=i.clone(),a=Ko(t);a.s*=e;const s=el(a);return t.r=s.r,t.g=s.g,t.b=s.b,t}function De(i,e){if(e)for(const t in e)i[t]=e[t]}class Jh{constructor(e){this.color=P.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=R.Opaque,De(this,e)}}class rs{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=P.main,this.outlineColor=P.outline,this.renderOccluded=R.Opaque,this.hoverOutlineColor=P.selectedOutline,De(this,e)}apply(e,t){const a=this[e];t.setParameters({color:St(a),transparent:e!=="color"||a.a<1,renderOccluded:this.renderOccluded})}}class Kh{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ii(P.main,.5),this.hoverColor=P.main,this.renderOccluded=R.Transparent,this.minSquaredEdgeLength=900,De(this,e)}apply(e,t){const a=this[e];t.setParameters({color:St(a),transparent:a.a<1,renderOccluded:this.renderOccluded})}}class ed{constructor(e){this.vertex=new rs({color:P.main,outlineColor:P.outline}),this.edge=new rs({color:Qh(Ii(P.main,2/3),.5),outlineColor:Ii(P.outline,.5),size:8,collisionPadding:8}),this.selected=new rs({color:P.selected,outlineColor:P.outline}),this.edgeOffset=new Kh,De(this,e)}}class Ts{constructor(e){this.color=P.selected,this.width=1.5,this.stipplePattern=ws(5),this.stippleOffColor=P.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=P.selected,this.renderOccluded=R.OccludeAndTransparent,De(this,e)}apply(e){e.color=St(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=St(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=St(this.innerColor),e.renderOccluded=this.renderOccluded}}class td{constructor(e){this.color=P.selected,this.size=4,this.outlineSize=1,this.outlineColor=P.outline,this.shape="square",De(this,e)}apply(e){e.color=St(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=St(this.outlineColor),e.primitive=this.shape}}class Ca{constructor(e){this.innerColor=P.selected,this.innerWidth=1,this.glowColor=P.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ti,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=P.main,De(this,e)}apply(e,t=1){const a={glowColor:Q.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:Q.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=a:e.laserlineStyle=a}}class id{constructor(e){this.outline=new Ts({color:P.outline,renderOccluded:R.OccludeAndTransparentStencil,stippleOffColor:P.selected,stipplePattern:ws(5),width:1.5,innerWidth:0}),this.staged=new Ts({color:P.selected,renderOccluded:R.OccludeAndTransparentStencil,innerColor:P.staged,stippleOffColor:P.outline,stipplePattern:ws(5),width:1.5}),this.shadowStyle=new Ca({globalAlpha:ti,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),De(this,e)}}class ad{constructor(e){this.outline=new td({color:P.selected,outlineColor:P.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Ca({globalAlpha:ti,glowColor:P.main,glowFalloff:1.5,glowWidth:6,innerColor:P.selected,innerWidth:1,radius:2}),De(this,e)}}class sd extends Ts{constructor(e){super(),this.extensionType=Se.GROUND_RAY,De(this,e)}}class nd{constructor(e){this.lineGraphics=new id,this.pointGraphics=new ad,this.heightPlane=new Ca({globalAlpha:ti,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),this.heightBox=new Ca({globalAlpha:ti,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:0,heightFillColor:P.main}),this.zVerticalLine=new sd({color:Ii(P.main,5*ti/3),falloff:2,innerColor:Ii(P.selected,0),renderOccluded:R.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Se.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,De(this,e)}}class rd{constructor(e){this.visualElements=new nd,this.reshapeManipulators=new ed,this.zManipulator=new Jh,De(this,e)}colorToVec4(e){return St(e)}}function St(i){return Ht(Q.toUnitRGBA(i))}const v=new rd;class Nt extends ka{constructor(e){var t;super(e),this._attachmentOrigin=jt(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new at,this._geometry=null,this._width=1,this._color=Pi(1,0,1,1),this._innerWidth=0,this._innerColor=Pi(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=R.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Li({view:e.view}),this.applyProps(e),this.attached=(t=e.attached)!=null?t:!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,a)=>{t.geometries.length=0,this._recreateGeometry(a,t.material,t.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&h(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Fe(e,this._color)||(Ue(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Fe(e,this._innerColor)||(Ue(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=h(e)!==h(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Fe(e,this._stippleOffColor)||(this._stippleOffColor=e?Zr(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,h(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var a;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(a=xe(this.object3dResources.resources))==null?void 0:a.geometries;if(!e||e.length===0)return null;X(Wt,0,0,0);let t=0;for(const s of e)s.computeAttachmentOrigin(Wn)&&(Z(Wt,Wt,Wn),t++);return t===0?null:(_e(Wt,Wt,1/t),this.view.renderCoordsHelper.fromRenderCoords(Wt,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){h(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),h(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return h(this.geometry)&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===R.OccludeAndTransparentStencil?R.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,a){this._createRenderGeometries(t,a);for(const s of a)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_createObject3DResources(e){const t=new tt(this._materialParameters),a=new Array;return this._recreateGeometry(e,t,a),{material:t,geometries:a,forEach:s=>{s(t),a.forEach(s)}}}_createDrapedResources(){const e=new tt(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(m(t)||m(this.view.basemapTerrain.spatialReference))return[];const a=ic(t,this.view.basemapTerrain.spatialReference),s=[];for(const{position:n}of a.lines){const r={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this._isClosed},o=new Fa(wn(e,r)),l=Ir(od);_s(l,n),tl(o.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),s.push(o)}return s}calculateMapBounds(e){if(m(this.object3dResources.resources))return!1;const t=this.view.renderCoordsHelper;for(const a of this.object3dResources.resources.geometries){const s=a.vertexAttributes.get(A.POSITION),n=Ta(s.data.length);il(s.data,t.spatialReference,0,n,this.view.spatialReference,0,s.data.length/3),_s(e,n)}return!0}_createRenderGeometries(e,t){var r;const a=this.geometry;if(m(a))return;const s=ac(a,this.view.elevationProvider,this.view.renderCoordsHelper,ci.fromElevationInfo((r=this.elevationInfo)!=null?r:new Vr({mode:Tr(a,null)}))),n=new Array;for(const{position:o,mapPositions:l}of s.lines){const c={mapPositions:l,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};t.push(wn(e,c)),n.push(o)}this._laserline.pathVerticalPlane=n}}const od=Gr(),Wn=M(),Wt=M();class ld extends Xs{constructor(e){super(e.view),this._resources=null,this._transform=be()}get object(){return h(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Is(this._transform,e),h(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(m(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new Ns({pickable:!1,updatePolicy:za.SYNC});e.add(t);const a=new js({castShadow:!1});a.transformation=this._transform,this.createExternalResources(),this.createGeometries(a),e.addMany(a.geometries),this.forEachExternalMaterial(s=>e.add(s)),e.add(a),t.add(a),a.visible=this.visible,this._resources={layer:t,object:a}}destroyResources(){const e=this.view._stage;!m(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){m(this._resources)||(this._resources.object.visible=e)}}function cd(i,e,t,a,s){const n=Ta(3*i.length),r=Ta(n.length);i.forEach((c,p)=>{n[3*p+0]=c[0],n[3*p+1]=c[1],n[3*p+2]=c.length>2?c[2]:0});const o=sc(n,e,0,r,0,n,0,n.length/3,t,a,s),l=o!=null;return{numVertices:i.length,position:n,mapPositions:r,projectionSuccess:l,sampledElevation:o}}function hd(i,e){if(!e.screenSizeEnabled)return;const t=i.vertex;yc(t,e),t.uniforms.add(new de("perScreenPixelRatio",(a,s)=>s.camera.perScreenPixelRatio)),t.uniforms.add(new de("screenSizeScale",a=>a.screenSizeScale)),t.code.add(T`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function dd(i){const e=new Ui,t=i.hasMultipassTerrain&&(i.output===B.Color||i.output===B.Alpha);e.include(no,i),e.include(hd,i),e.include(ro,i);const{vertex:a,fragment:s}=e;return s.include(oo),ks(a,i),s.uniforms.add(new Mt("uColor",n=>n.color)),e.attributes.add(A.POSITION,"vec3"),e.varyings.add("vWorldPosition","vec3"),t&&e.varyings.add("depth","float"),i.screenSizeEnabled&&e.attributes.add(A.OFFSET,"vec3"),i.shadingEnabled&&(bc(a),e.attributes.add(A.NORMAL,"vec3"),e.varyings.add("vViewNormal","vec3")),a.code.add(T`
    void main(void) {
      vWorldPosition = ${i.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),i.shadingEnabled&&a.code.add(T`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),a.code.add(T`
    ${t?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),t&&e.include(lo,i),s.code.add(T`
    void main() {
      discardBySlice(vWorldPosition);
      ${t?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),i.shadingEnabled?(s.uniforms.add(new lt("shadingDirection",n=>n.shadingDirection)),s.uniforms.add(new Mt("shadedColor",n=>pd(n.shadingTint,n.color))),s.code.add(T`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):s.code.add(T`vec4 finalColor = uColor;`),s.code.add(T`
      ${i.output===B.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${T.float(Mc)}) {
        discard;
      }
      ${i.output===B.Alpha?T`gl_FragColor = vec4(finalColor.a);`:""}

      ${i.output===B.Color?T`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${i.transparencyPassType===it.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),e}function pd(i,e){const t=1-i[3],a=i[3]+e[3]*t;return a===0?(At[3]=a,At):(At[0]=(i[0]*i[3]+e[0]*e[3]*t)/a,At[1]=(i[1]*i[3]+e[1]*e[3]*t)/a,At[2]=(i[2]*i[3]+e[2]*e[3]*t)/a,At[3]=e[3],At)}const At=$r(),ud=Object.freeze(Object.defineProperty({__proto__:null,build:dd},Symbol.toStringTag,{value:"Module"}));class Xa extends ki{initializeProgram(e){return new Bi(e.rctx,Xa.shader.get().build(this.configuration),xo)}_setPipelineState(e){const t=this.configuration,a=e===it.NONE,s=e===it.FrontFace;return Yi({blending:t.output!==B.Color&&t.output!==B.Alpha||!t.transparent?null:a?Gc:uo(e),culling:_o(t.cullFace),depthTest:{func:s?ha.LESS:t.shadingEnabled?ha.LEQUAL:ha.LESS},depthWrite:a?t.writeDepth?go:null:mo(e),colorWrite:Xi,polygonOffset:a||s?null:Ic})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Xa.shader=new Wi(ud,()=>Ni(()=>import("./ShadedColorMaterial.glsl.62235df5.js"),["assets/ShadedColorMaterial.glsl.62235df5.js","assets/index.3255d2a5.js","assets/index.e51050de.css","assets/VertexColor.glsl.e3d82815.js","assets/requestImageUtils.828b299e.js","assets/OrderIndependentTransparency.43c6e481.js","assets/enums.3c1fa5b5.js","assets/basicInterfaces.f8f3b23b.js","assets/Texture.d66dc1cb.js","assets/VertexArrayObject.ad007c8f.js","assets/Util.3efb1a6b.js","assets/mat4f64.9070f685.js","assets/triangle.1c8f4155.js","assets/sphere.67ec4acb.js","assets/mat3f64.9180efcb.js","assets/quatf64.1dc83f1c.js","assets/lineSegment.1a0fd96e.js","assets/Indices.27b9c798.js","assets/VertexAttribute.34e3daf1.js","assets/doublePrecisionUtils.d6c628ce.js","assets/quat.eb7bbc3a.js","assets/vec3f32.4d8dc001.js","assets/BufferView.32a50625.js","assets/VertexElementDescriptor.5da9dfe9.js","assets/automaticLengthMeasurementUtils.06e82903.js","assets/spatialReferenceEllipsoidUtils.7f3e3256.js","assets/vec4f32.c3d64d30.js","assets/Octree.449e609a.js","assets/plane.a0a08b54.js","assets/NativeLineMaterial.6f545af4.js","assets/Attribute.98e6fe67.js","assets/triangulationUtils.2ec0b7a6.js","assets/earcut.a219bf29.js","assets/deduplicate.97d7ef01.js","assets/hydratedFeatures.b4cbc12d.js","assets/InterleavedLayout.a42ad5fa.js","assets/types.bf551170.js","assets/NestedMap.2ac03b78.js","assets/floatRGBA.7b501bd7.js","assets/boundedPlane.91a64206.js","assets/glUtil.9de5d1d0.js","assets/SnappingContext.023005d4.js","assets/PointSnappingHint.08747e02.js","assets/editPlaneUtils.dd1c9a66.js","assets/GraphicManipulator.5182c2a7.js","assets/TranslateTooltipInfos.33287c88.js","assets/axisAngleDegrees.fa497b47.js","assets/persistable.bfebf5ba.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.8c0303d1.js","assets/ExtentTooltipInfos.e2302c0a.js"]));class $e extends co{constructor(){super(...arguments),this.output=B.Color,this.cullFace=ae.None,this.transparencyPassType=it.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:B.COUNT})],$e.prototype,"output",void 0),d([H({count:ae.COUNT})],$e.prototype,"cullFace",void 0),d([H({count:it.COUNT})],$e.prototype,"transparencyPassType",void 0),d([H()],$e.prototype,"hasSlicePlane",void 0),d([H()],$e.prototype,"transparent",void 0),d([H()],$e.prototype,"writeDepth",void 0),d([H()],$e.prototype,"screenSizeEnabled",void 0),d([H()],$e.prototype,"shadingEnabled",void 0),d([H()],$e.prototype,"hasMultipassTerrain",void 0),d([H()],$e.prototype,"cullAboveGround",void 0);const xo=new Map([[A.POSITION,0],[A.NORMAL,1],[A.OFFSET,2]]);class Ds extends Sc{constructor(e){super(e,new gd),this.supportsEdges=!0,this._configuration=new $e,this._vertexAttributeLocations=xo}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,a,s,n,r){if(this.parameters.screenSizeEnabled){const o=e.vertexAttributes.get(A.OFFSET);On(e,a,s,n,{applyToVertex:(c,p,u,g)=>{const b=X(Yn,o.data[3*g+0],o.data[3*g+1],o.data[3*g+2]),y=X(fd,c,p,u);return _e(b,b,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(b)),Z(y,y,b),[y[0],y[1],y[2]]},applyToAabb:c=>{const p=al(c,Yn);return sl(c,this.parameters.screenSizeScale*a.camera.computeRenderPixelSizeAt(p))}},r)}else On(e,a,s,n,void 0,r)}requiresSlot(e,t){if(t===B.Highlight)return e===Ae.OPAQUE_MATERIAL;if(t===B.Color||t===B.Alpha||t===B.ObjectAndLayerIdColor){let a=Ae.OPAQUE_MATERIAL;return this.parameters.transparent&&(a=this.parameters.writeDepth?Ae.TRANSPARENT_MATERIAL:Ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===a||e===Ae.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new _d(e)}createBufferWriter(){return new md(this.parameters.screenSizeEnabled)}}class _d extends wc{beginSlot(e){return this.ensureTechnique(Xa,e)}}class gd extends ho{constructor(){super(...arguments),this.color=Te(1,1,1,1),this.shadingTint=Te(0,0,0,.25),this.shadingDirection=le(M(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ae.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class md{constructor(e){this.screenSizeEnabled=e;const t=po().vec3f(A.POSITION).vec3f(A.NORMAL);this.screenSizeEnabled&&t.vec3f(A.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(A.POSITION).length}write(e,t,a,s,n){if(xc(a,this.vertexBufferLayout,e,t,s,n),this.screenSizeEnabled){if(!a.vertexAttributes.has(A.OFFSET))throw new Error(`${A.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const r=a.vertexAttributes.get(A.OFFSET),o=a.indices.get(A.OFFSET);Xc(r.size===3);const l=s.getField(A.OFFSET,Yc);if(!l)throw new Error("unable to acquire view for "+A.OFFSET);Oc(o,r.data,t,l,n)}}}}const Yn=M(),fd=M();class Xn extends ld{constructor(e){super(e),this.view=null,this._renderOccluded=R.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=v.colorToVec4(v.reshapeManipulators.vertex.color),this._size=v.reshapeManipulators.vertex.size,this._outlineColor=v.colorToVec4(v.reshapeManipulators.vertex.outlineColor),this._outlineSize=v.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Fe(e,this._color)||(Ue(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Fe(e,this._outlineColor)||(Ue(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(m(e)||e.length===0)return[];const t=.5,a=.5,s=cd(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ci.fromElevationInfo(this.elevationInfo)),n=[],r=s.numVertices,o=s.position;for(let l=0;l<r;++l){const c=X(vd,o[3*l+0],o[3*l+1],o[3*l+2]),p=Zn(this._vertexMaterial,t,c),u=Zn(this._vertexOutlineMaterial,a,c);n.push({vertexGeometry:p,vertexOutlineGeometry:u})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:s}of t)e.addGeometry(a),e.addGeometry(s)}createExternalResources(){this._vertexMaterial=new Ds({...this._vertexMaterialParameters,writeDepth:!0,cullFace:ae.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ds({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:ae.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const vd=M();function Zn(i,e,t){return Mi(i,e,16,16,{offset:t})}let Pt=class extends Zc{constructor(i){super(i),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:i,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Vr({mode:i,offset:e})}normalizeCtorArgs(i){var e;if(!i.elevationInfo){const t=(e=i.hasZ)!=null?e:!0;return{...i,elevationInfo:nl(t)}}return i}initializeGraphic(i){const e=this._createGraphicState=new Ut({graphic:i});return ye([this.view.maskOccludee(i),this.view.trackGraphicState(e),I(()=>({element:this._outlineVisualElement,isDraped:e.isDraped}),({element:t,isDraped:a})=>{us(t,s=>s.isDraped=a)},Ze)])}makeDrawOperation(){const{geometryType:i}=this,e=i!=="circle"&&i!=="rectangle";return new qc({view:this.view,manipulators:this.manipulators,geometryType:Qc(i),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Jc(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Kc(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Gi,segmentLabels:e?new $a:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:h(this._createGraphicState)?this._createGraphicState.isDraped:ln(this.hasZ,this.elevationInfo)==="on-the-ground"})}onActiveVertexChanged(i){const{view:e}=this;return h(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[i],this._updateVerticalLineVisualElement(i),null):(this._activeVertexVisualElement=new Xn({view:e,spatialReference:e.spatialReference,vertices:[i],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:v.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=v.colorToVec4(v.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new Ya({view:e,extensionType:v.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent}),v.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),It(()=>{this._activeVertexVisualElement=Y(this._activeVertexVisualElement),this._verticalLineVisualElement=Y(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(i){const e=this._verticalLineVisualElement;if(m(e))return;const{renderCoordsHelper:t,elevationProvider:a}=this.view;X(Yt,i[0],i[1],i[2]),qn.setFromElevationInfo(this.elevationInfo),Yt[2]=Na(Yt,a,qn,t),t.toRenderCoords(Yt,this.view.spatialReference,Yt)?(e.setStartEndFromWorldDownAtLocation(Yt),e.attached=!0):e.attached=!1}onOutlineChanged(i){if(h(this._outlineVisualElement))return this._outlineVisualElement.geometry=i,null;const e=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Nt({view:this.view,geometry:i,elevationInfo:e,isDraped:h(this._createGraphicState)?this._createGraphicState.isDraped:ln(this.hasZ,e)==="on-the-ground",attached:!1}),v.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),v.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,It(()=>{this._outlineVisualElement=Y(this._outlineVisualElement)})}onRegularVerticesChanged(i){return h(this._verticesVisualElement)?(this._verticesVisualElement.vertices=i,null):(this._verticesVisualElement=new Xn({view:this.view,spatialReference:this.view.spatialReference,vertices:i,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:v.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,It(()=>{this._verticesVisualElement=Y(this._verticesVisualElement)}))}};d([_({constructOnly:!0})],Pt.prototype,"elevationInfo",void 0),d([_({constructOnly:!0})],Pt.prototype,"geometryType",void 0),d([_()],Pt.prototype,"type",void 0),d([_({constructOnly:!0})],Pt.prototype,"view",void 0),Pt=d([K("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Pt);const qn=new ci,Yt=M();function ii(i,e,t){return yd(i,i.screenToRender(e,ms(w.get())),t)}function yd(i,e,t){const a=ms(cn(w.get(),e));if(a[2]=0,!i.unprojectFromRenderScreen(a,t.origin))return null;const s=ms(cn(w.get(),e));s[2]=1;const n=i.unprojectFromRenderScreen(s,w.get());return m(n)?null:(N(t.direction,n,t.origin),t)}class ge{constructor(e){var a;this.metadata=void 0,this._camera=new nc,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=be(),this._worldFrame=null,this._renderLocation=M(),this._renderLocationDirty=!0,this._location=new ei({x:0,y:0,z:0}),this._elevationAlignedLocation=new ei,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=ie.None,this._focused=!1,this.events=new at.EventEmitter,this._screenLocation={screenPointArray:et(),renderScreenPointArray:fs(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference;for(const s in e)this[s]=e[s];const t=(a=this.view.state)==null?void 0:a.camera;t&&this._camera.copyFrom(t)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return(e=this.view)==null?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),{remove:rl(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){Qn(e)&&(this._screenLocationDirty=!0),Is(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=be()),bd(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){$n(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){$n(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=h(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=lh(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(Qn(this._modelTransform)){const t=this._calculateModelTransformOffset(wd);e=Z(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){var r;if(!this.available)return null;const a=ya(e,Md),s=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Rr(this.screenLocation.screenPointArray,a)<s*s)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const o=this.collisionType.paths,l=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(l,sa),p=s*this.screenLocation.pixelSize,u=ii(this._camera,a,os);if(m(u))return null;for(const g of o){if(g.length===0)continue;const b=ve(Oi,g[0],c);for(let y=1;y<g.length;y++){const f=ve(er,g[y],c),S=Yl(Ea(b,f,Jn),u);if(S!=null&&S<p*p){const x=Z(w.get(),b,f);_e(x,x,.5);const C=pn(w.get());return this._camera.projectToRenderScreen(x,C),C[2]+n}U(b,f)}}break}case"disc":{const o=this.collisionType.direction,l=(r=this.collisionType.offset)!=null?r:gs,c=this._getWorldToScreenObjectScale(),p=this._calculateObjectTransform(c,sa),u=s*this.screenLocation.pixelSize,g=ii(this._camera,a,os);if(m(g))return null;const b=hn(Kn,p),y=dn(ir,o,b),f=ve(ar,l,p);Ft(f,y,na);const S=tr;if(ri(na,g,S)&&zr(S,f)<u*u)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:o,direction:l}=this.collisionType,c=this._getWorldToScreenObjectScale(),p=this._calculateObjectTransform(c,sa),u=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),g=ii(this._camera,a,os);if(m(g))return null;const b=hn(Kn,p),y=dn(ir,l,b),f=this._calculateModelTransformPosition(ar);Ft(f,y,na);const S=tr;if(!ri(na,g,S))break;for(const x of o){if(x.length===0)continue;const C=ve(Oi,x[0],p);for(let F=1;F<x.length;F++){const ee=ve(er,x[F],p),W=Wl(Ea(C,ee,Jn),S);if(W!=null&&W<u*u){const V=Z(w.get(),C,ee);_e(V,V,.5);const pe=pn(w.get());return this._camera.projectToRenderScreen(V,pe),pe[2]+n}U(C,ee)}}break}default:ol(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const a=e.manipulator3D;if(m(a.engineLayerId)){const s=new Ns({pickable:!1,updatePolicy:za.SYNC});t.add(s),a.engineLayerId=s.id,this._engineLayer=s}else t!=null&&t.getObject&&(this._engineLayer=t.getObject(a.engineLayerId));a.engineLayerReferences=(a.engineLayerReferences||0)+1,this._materialIdReferences=a.materialIdReferences,m(this._materialIdReferences)&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),ll(this._location.spatialReference,this.view.spatialReference)||(this.location=new ei({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const a=t.engineLayerReferences===0;a&&(t.engineLayerId=null),this._removeResourcesFromStage(a),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){vs(this.location,sr,e.spatialReference)&&cl(e.extent,sr)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(m(this.elevationInfo))return;let e=null,t=0;const a=re(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":e=re(ss(this.view.elevationProvider,this.location,"ground"),0);break;case"relative-to-ground":t=re(ss(this.view.elevationProvider,this.location,"ground"),0)+a;break;case"relative-to-scene":t=re(ss(this.view.elevationProvider,this.location,"scene"),0)+a;break;case"absolute-height":t=a}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=sa;if(this.autoScaleRenderObjects===!0){const r=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(r,t)}else this._calculateObjectTransform(e,t);const{objectsByState:a}=this._ensureEngineResources(),s=(this.focused?O.Focused:O.Unfocused)|(this.selected?O.Selected:O.Unselected),n=this._noDisplayCount>0;for(const{stateMask:r,objects:o}of a){if(n){for(const g of o)g.visible=!1;continue}const l=(r&O.All)!==O.None,c=(r&ie.All)!==ie.None,p=!l||(s&r)==(r&O.All),u=!c||(this.state&r)==(r&ie.All);if(p&&u)for(const g of o)g.visible=!0,g.transformation=t;else for(const g of o)g.visible=!1}}_ensureEngineResources(){if(m(this._engineResources)){const e=L(this._engineLayer),t=[],a=new Set;this.renderObjects.forEach(({geometry:{material:r}})=>{a.has(r)||(t.push(r),a.add(r))});const s=new Map;this._renderObjects.forEach(r=>{const o=new js({castShadow:!1,geometries:[r.geometry]}),l=s.get(r.stateMask)||[];l.push(o),s.set(r.stateMask,l)});const n=[];s.forEach((r,o)=>n.push({stateMask:o,objects:r})),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||m(this._engineResources)||!e)return;const{objectsByState:t,layer:a,materials:s}=this._engineResources;s.forEach(n=>{const r=L(this._materialIdReferences),o=r.get(n.id)||0;o===0&&e.add(n),r.set(n.id,o+1)}),t.forEach(({objects:n})=>{a.addMany(n),e.addMany(n)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){const t=this._stage;if(!this._engineResourcesAddedToStage||m(this._engineResources)||!t)return;const{objectsByState:a,layer:s,materials:n}=this._engineResources;a.forEach(({objects:r})=>{s.removeMany(r),t.removeMany(r)}),n.forEach(r=>{const o=L(this._materialIdReferences),l=o.get(r.id);l===1?(t.remove(r),o.delete(r.id)):o.set(r.id,l-1)}),e&&t.remove(s),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(t,Sd);return X(e,a[12],a[13],a[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return N(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return hl(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Je(t,t,this._worldFrame),Je(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,h(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(h(this._engineResources))for(const t in this._engineResources.objectsByState){const a=this._engineResources.objectsByState[t];for(const s of a.objects)if(s.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function Qn(i){return i[12]!==0||i[13]!==0||i[14]!==0}function bd(i,e,t){switch(i.viewingMode){case"local":return ys(t),!0;case"global":{const a=dl(i.renderCoordsHelper.spatialReference);return pl(e,0,Oi,0,a.radius),ul(pt(Oi[0]),pt(Oi[1]),t),!0}}}const Md=et(),Jn=$i(),os=Hi(),Kn=hh(),Sd=be(),sa=be(),na=hi(),Oi=M(),er=M(),tr=M(),ir=M(),ar=M(),wd=M(),sr=new ei({x:0,y:0,z:0,spatialReference:null});class E{constructor(e,t=O.None){this.geometry=e,this.stateMask=t}}function xd(i){const e=new Ui,{vertex:t,fragment:a}=e;return ks(t,i),e.include(no,i),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.UV0,"vec2"),e.varyings.add("vpos","vec3"),i.hasMultipassTerrain&&e.varyings.add("depth","float"),t.uniforms.add(new Lt("textureCoordinateScaleFactor",s=>h(s.texture)&&h(s.texture.descriptor.textureCoordinateScaleFactor)?s.texture.descriptor.textureCoordinateScaleFactor:_l)),t.code.add(T`
    void main(void) {
      vpos = position;
      ${i.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(ro,i),e.include(lo,i),a.uniforms.add([new Os("tex",s=>s.texture),new de("opacity",s=>s.opacity)]),e.varyings.add("vTexCoord","vec2"),i.output===B.Alpha?a.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${T.float(En)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(a.include(oo),a.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${T.float(En)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${i.transparencyPassType===it.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),e}const Od=Object.freeze(Object.defineProperty({__proto__:null,build:xd},Symbol.toStringTag,{value:"Module"}));class Za extends ki{initializeProgram(e){return new Bi(e.rctx,Za.shader.get().build(this.configuration),Us)}_setPipelineState(e,t){const a=this.configuration,s=e===it.NONE,n=e===it.FrontFace;return Yi({blending:a.output!==B.Color&&a.output!==B.Alpha||!a.transparent?null:s?Ed:uo(e),culling:_o(a.cullFace),depthTest:{func:Vc(e)},depthWrite:s?a.writeDepth?go:null:mo(e),colorWrite:Xi,stencilWrite:a.hasOccludees?Ec:null,stencilTest:a.hasOccludees?t?Ac:Rc:null,polygonOffset:s||n?null:zc(a.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Za.shader=new Wi(Od,()=>Ni(()=>import("./ImageMaterial.glsl.16bd2631.js"),["assets/ImageMaterial.glsl.16bd2631.js","assets/index.3255d2a5.js","assets/index.e51050de.css","assets/VertexColor.glsl.e3d82815.js","assets/requestImageUtils.828b299e.js","assets/OrderIndependentTransparency.43c6e481.js","assets/enums.3c1fa5b5.js","assets/basicInterfaces.f8f3b23b.js","assets/Texture.d66dc1cb.js","assets/VertexArrayObject.ad007c8f.js","assets/Util.3efb1a6b.js","assets/mat4f64.9070f685.js","assets/triangle.1c8f4155.js","assets/sphere.67ec4acb.js","assets/mat3f64.9180efcb.js","assets/quatf64.1dc83f1c.js","assets/lineSegment.1a0fd96e.js","assets/Indices.27b9c798.js","assets/VertexAttribute.34e3daf1.js","assets/doublePrecisionUtils.d6c628ce.js","assets/quat.eb7bbc3a.js","assets/vec3f32.4d8dc001.js","assets/BufferView.32a50625.js","assets/VertexElementDescriptor.5da9dfe9.js","assets/automaticLengthMeasurementUtils.06e82903.js","assets/spatialReferenceEllipsoidUtils.7f3e3256.js","assets/vec4f32.c3d64d30.js","assets/Octree.449e609a.js","assets/plane.a0a08b54.js","assets/NativeLineMaterial.6f545af4.js","assets/Attribute.98e6fe67.js","assets/triangulationUtils.2ec0b7a6.js","assets/earcut.a219bf29.js","assets/deduplicate.97d7ef01.js","assets/hydratedFeatures.b4cbc12d.js","assets/InterleavedLayout.a42ad5fa.js","assets/types.bf551170.js","assets/NestedMap.2ac03b78.js","assets/floatRGBA.7b501bd7.js","assets/boundedPlane.91a64206.js","assets/glUtil.9de5d1d0.js","assets/SnappingContext.023005d4.js","assets/PointSnappingHint.08747e02.js","assets/editPlaneUtils.dd1c9a66.js","assets/GraphicManipulator.5182c2a7.js","assets/TranslateTooltipInfos.33287c88.js","assets/axisAngleDegrees.fa497b47.js","assets/persistable.bfebf5ba.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.8c0303d1.js","assets/ExtentTooltipInfos.e2302c0a.js"]));const Ed=Bs(qe.ONE,qe.ONE_MINUS_SRC_ALPHA);class Ce extends co{constructor(){super(...arguments),this.output=B.Color,this.cullFace=ae.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=it.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:B.COUNT})],Ce.prototype,"output",void 0),d([H({count:ae.COUNT})],Ce.prototype,"cullFace",void 0),d([H()],Ce.prototype,"hasSlicePlane",void 0),d([H()],Ce.prototype,"transparent",void 0),d([H()],Ce.prototype,"enableOffset",void 0),d([H()],Ce.prototype,"writeDepth",void 0),d([H()],Ce.prototype,"hasOccludees",void 0),d([H({count:it.COUNT})],Ce.prototype,"transparencyPassType",void 0),d([H()],Ce.prototype,"hasMultipassTerrain",void 0),d([H()],Ce.prototype,"cullAboveGround",void 0);class Ad extends rc{constructor(e){super(e,new Td),this.supportsEdges=!0,this._configuration=new Ce}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Fc,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return t===B.Color||t===B.Alpha||t===B.Highlight?e===Ae.DRAPED_MATERIAL?!0:t===B.Highlight?e===Ae.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ae.TRANSPARENT_MATERIAL:Ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ae.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Rd(e)}createBufferWriter(){return new Tc(oc)}}class Rd extends Dc{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Za,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==B.Color&&this._output!==B.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Td extends ho{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ae.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}function ht(i,e=R.OccludeAndTransparent,t=!0){const a=Te(i[0],i[1],i[2],i.length>3?i[3]:1),s=i[3]<1;return t?new Ds({color:a,transparent:s,writeDepth:!0,cullFace:ae.Back,renderOccluded:e}):new ze({color:a,transparent:s,writeDepth:!0,cullFace:ae.Back,renderOccluded:e})}function fi(i,e=R.OccludeAndTransparent){const t=Te(i[0],i[1],i[2],i.length===4?i[3]:1);return new ze({color:t,transparent:!0,writeDepth:!0,cullFace:ae.Front,renderOccluded:e})}const vi=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:j(1,.5,0)});function Dd(i,e){const t=new ge({view:i,autoScaleRenderObjects:!1,collisionPriority:1,metadata:e.metadata});return Pd(t,e),t}function Pd(i,e){var y,f,S,x,C,F,ee,W;const t=(f=e.material)!=null?f:new Ad({transparent:!0,writeDepth:!1,textureId:(y=e.texture)==null?void 0:y.id,renderOccluded:R.Opaque}),a=(S=e.focusMultiplier)!=null?S:vi.focusMultiplier,s=(x=e.calloutLength)!=null?x:vi.calloutLength,n=vi.discRadius*((C=e.discScale)!=null?C:1),r=n*a,o=(V,pe)=>{const $=[0,1,2,2,3,0];return new so(pe,[[A.POSITION,new Es([s-V,-V,0,s+V,-V,0,s+V,V,0,s-V,V,0],3,!0)],[A.UV0,new Es([0,0,1,0,1,1,0,1],2,!0)]],[[A.POSITION,$],[A.UV0,$]])},l=vi.calloutColor,c=(F=e.calloutWidth)!=null?F:vi.calloutWidth,p=new(c>1?tt:Hs)({width:c,color:Te(l[0],l[1],l[2],(ee=e.calloutOpacity)!=null?ee:1),renderOccluded:R.OccludeAndTransparent}),u=Ne(p,[[0,0,0],[s-n,0,0]]),g=Ne(p,[[0,0,0],[s-r,0,0]]),b=(W=e.customStateMask)!=null?W:ie.None;i.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},i.focusMultiplier=a,i.metadata=e.metadata,i.radius=n,i.renderObjects=[new E(o(n,t),O.Unfocused|b),new E(u,O.Unfocused|b),new E(o(r,t),O.Focused|b),new E(g,O.Focused|b)]}const $d=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Oo(i,e,t,a){const s=N(w.get(),i,t),n=Eo(s,He(w.get(),a,s),t,oe.get());gl(n,n);const r=ve(w.get(),e,n);return Math.atan2(r[1],r[0])}function Eo(i,e,t,a){const s=le(w.get(),i),n=le(w.get(),e),r=He(w.get(),s,n);return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=n[0],a[5]=n[1],a[6]=n[2],a[7]=0,a[8]=r[0],a[9]=r[1],a[10]=r[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function La(i,e){const t=i.getViewForGraphic(e);return h(t)&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,i.spatialReference):null}function Ao(i,e,t){const a=La(i,t);h(a)?e.elevationAlignedLocation=a:Cd(e,t.geometry)}function Cd(i,e){if(m(e))return;const t=e.type==="mesh"?e.anchor:lc(e);m(t)||(i.location=ch(t))}function Vt(i,e=J(i)){return e.mode!=="on-the-ground"&&!(m(i.geometry)||!i.geometry.hasZ)}var Ve;(function(i){i[i.NONE=0]="NONE",i[i.ANY=1]="ANY",i[i.Z=2]="Z",i[i.XY=4]="XY"})(Ve||(Ve={}));var z;(function(i){i[i.TRANSLATE_Z=0]="TRANSLATE_Z",i[i.TRANSLATE_XY=1]="TRANSLATE_XY",i[i.SCALE=2]="SCALE",i[i.ROTATE=3]="ROTATE",i[i.SCALE_ROTATE=4]="SCALE_ROTATE"})(z||(z={}));class Ro{constructor(){this.grabbingState=Ve.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Ve.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((t,a)=>{if(a===z.TRANSLATE_Z&&(this.zManipulator=t),t instanceof ge&&(t.selected&&(this.numSelected===0&&(this.firstSelected=t),this.numSelected++),m(this.firstGrabbedXY)&&t.grabbing&&a===z.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=Ve.ANY,a){case z.TRANSLATE_Z:this.grabbingState|=Ve.Z;break;case z.TRANSLATE_XY:this.grabbingState|=Ve.XY}})}}function Ld(i){const{view:e,graphic:t}=i,a=new Ut({graphic:t}),s=Gd(i,a),n=[s,Id(i,s.visualElement,a),e.maskOccludee(t),e.trackGraphicState(a)];return{visualElement:s.visualElement,remove:()=>ye(n).remove()}}function Gd(i,e){const{view:t,graphic:a}=i,s=new Nt({view:t,geometry:Ps(a)?a.geometry:null,elevationInfo:J(a),attached:!1});v.visualElements.lineGraphics.shadowStyle.apply(s);const n=()=>{s.attached=e.displaying};v.visualElements.lineGraphics.outline.apply(s);const r=[I(()=>e.displaying,n),I(()=>e.isDraped,o=>{s.isDraped=o}),e.on("changed",()=>s.geometry=Ps(a)?a.geometry:null),Oe(s)];return n(),{visualElement:s,remove:()=>ye(r).remove()}}function Id(i,e,t){const{graphic:a,view:s}=i,n=[],r=J(a),o=r.mode==="on-the-ground"||!r.offset&&r.mode!=="absolute-height",l=new Ro,c=new Ya({view:s,extensionType:v.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent});v.visualElements.pointGraphics.shadowStyle.apply(c);const p=pt(v.visualElements.heightPlaneAngleCutoff),u=new Li({view:s,attached:!1,angleCutoff:p});v.visualElements.heightPlane.apply(u);let g=1,b=1;const y=()=>{if(l.update(i),!t.displaying||o&&(t.isDraped||!Ps(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,c.attached=!1,void(u.attached=!1);e.laserlineEnabled=!0;const x=l.grabbingState&Ve.XY?v.visualElements.laserlineAlphaMultiplier:1;x!==g&&(g=x,v.visualElements.lineGraphics.shadowStyle.apply(e,x),v.visualElements.pointGraphics.shadowStyle.apply(c,x));const C=l.grabbingState&Ve.Z?v.visualElements.laserlineAlphaMultiplier:1;C!==b&&(b=C,v.visualElements.heightPlane.apply(u,C)),Vd(c,l),zd(i,e,u,l)};v.visualElements.zVerticalLine.apply(c),n.push(t.on("changed",y),I(()=>t.displaying,y),e.events.on("attachment-origin-changed",y),Oe(c),Oe(u));const f=[],S=()=>{ye(f).remove(),f.length=0,i.forEachManipulator(x=>f.push(x.events.on("grab-changed",y))),i.forEachManipulator(x=>f.push(x.events.on("select-changed",y))),y()};return S(),n.push(i.onManipulatorsChanged(S),Fr(()=>ye(f))),ye(n)}function Vd(i,e){const t=e.numSelected===1?e.firstSelected:e.numSelected>1&&h(e.firstGrabbedXY)?e.firstGrabbedXY:null;h(t)?(i.setStartEndFromWorldDownAtLocation(t.renderLocation),i.attached=!0):i.attached=!1}function zd(i,e,t,a){if(a.numSelected>0){X(Rt,0,0,0);let s=0;i.forEachManipulator((n,r)=>{r===z.TRANSLATE_XY&&n.selected&&n instanceof ge&&(Z(Rt,Rt,n.renderLocation),s++)}),s>0?(t.heightManifoldTarget=_e(Rt,Rt,1/s),t.attached=!0):t.attached=!1}else{const s=e.attachmentOrigin;h(s)&&i.view.renderCoordsHelper.toRenderCoords(s,Rt)?(t.heightManifoldTarget=Rt,t.attached=!0):t.attached=!1}}function Ps(i){return h(i.geometry)&&(i.geometry.type==="polygon"||i.geometry.type==="polyline")}const Rt=M();function Fd(i){const{view:e,graphic:t}=i,a=new Ut({graphic:t}),s=[],n=jd(i,a,s);return Nd(i,a,s,n),s.push(e.trackGraphicState(a)),{visualElement:n,remove(){ye(s).remove()}}}function Nd(i,e,t,a){const{view:s,graphic:n}=i,r=new Ya({view:s,extensionType:v.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.OccludeAndTransparent});v.visualElements.zVerticalLine.apply(r);const o=new Li({view:s,intersectsLineInfinite:!0,attached:!1});v.visualElements.pointGraphics.shadowStyle.apply(o);const l=pt(v.visualElements.heightPlaneAngleCutoff),c=new Li({view:s,attached:!1,angleCutoff:l});v.visualElements.heightPlane.apply(c);const p=J(i.graphic),u=ci.fromElevationInfo(p),g=p.mode==="on-the-ground"||!p.offset&&p.mode!=="absolute-height",b=new Ro;let y=1,f=1;const S=()=>{b.update(i);const x=qs(n),C=g&&(e.isDraped||m(x)||!x.hasZ);let F=!0;if(!C&&h(x)){const $=Na(x,s.elevationProvider,u,s.renderCoordsHelper);X(Ge,x.x,x.y,$),Ai(Ge,x.spatialReference,Ge,s.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(Ge),o.intersectsWorldUpAtLocation=Ge}else F=!1;const ee=b.grabbingState&Ve.Z?v.visualElements.laserlineAlphaMultiplier:1;ee!==y&&(y=ee,v.visualElements.heightPlane.apply(c,ee));const W=Ir(Bd);!C&&e.displaying&&a.calculateMapBounds(W)&&Ai(ml(W,Ge),s.spatialReference,Ge,s.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=Ge,c.attached=!0):c.attached=!1;const V=b.grabbingState&Ve.XY?v.visualElements.laserlineAlphaMultiplier:1;V!==f&&(f=V,v.visualElements.pointGraphics.shadowStyle.apply(o,V));const pe=F&&e.displaying&&!C;o.attached=pe,r.attached=pe};t.push(I(()=>[e.displaying,e.isDraped],S),e.on("changed",S)),i.forEachManipulator(x=>{t.push(x.events.on("grab-changed",S))}),t.push(Oe(o)),t.push(Oe(r)),t.push(Oe(c)),S()}function jd(i,e,t){const{view:a,graphic:s}=i,n=new Rs({view:a,geometry:qs(s),elevationInfo:J(s),attached:!1});return Hd(i,n,e,t),t.push(Oe(n)),n}function qs(i){const e=i.geometry;return m(e)?null:e.type==="point"?e:e.type==="mesh"?e.anchor.clone():null}function Hd(i,e,t,a){const s=()=>e.attached=t.displaying;Ud(i,e,t,a),v.visualElements.pointGraphics.outline.apply(e),a.push(I(()=>t.displaying,s,Ze))}function Ud(i,e,t,a){const{view:s,graphic:n}=i;let r=null;const o=c=>{h(r)&&(r.remove(),r=null),t.isDraped&&h(c)&&(r=kd(s,c,()=>{e.geometry=c}))},l=()=>{const c=qs(n);o(c),e.geometry=c};a.push(t.on("changed",l),Fr(()=>r)),l()}function kd(i,e,t){const a=i.elevationProvider.spatialReference;fl(e,Ge,a);const s=Ge[0],n=Ge[1];return i.elevationProvider.on("elevation-change",r=>{Nr(r.extent,s,n)&&t()})}const Ge=M(),Bd=Gr();function qa(i){switch(L(i.graphic.geometry).type){case"point":case"mesh":return Fd(i);case"polygon":case"polyline":return Ld(i);default:return null}}const Wd=[1,.5,0],To=128,Ke=70,Yd=80,Do=.02,Xd=54,Zd=100,Po=Math.ceil(Ke/3*2),Ct=160,ls=.5,cs=24,Xt=9,qd=Ct+30,nr=Ct+53,Qd=60,Jd=23,Kd=5*Math.PI/12,ep=1*Math.PI/3,rr=10,or=.2,lr=30,cr=53,hr=.2,dr=.3,tp=200,ip=3,ap=1e6;class qi{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||(e=t.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(a=>{!t&&e(a)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,a)=>{t instanceof ge&&e(t,a)})}}function Ga(i,e){return $o(i,()=>e)}function sp(i){return $o(i,e=>e.plane)}function $o(i,e){const t=M(),a=M();let s=!1;return n=>{const r=e(n);if(n.action==="start"){const c=ya(n.screenStart,ma(Ss.get())),p=ii(i.state.camera,c,ur);h(p)&&(s=ri(r,p,t))}if(!s)return null;const o=ya(n.screenEnd,ma(Ss.get())),l=ii(i.state.camera,o,ur);return m(l)?null:ri(r,l,a)?{...n,renderStart:t,renderEnd:a,plane:r,ray:l}:null}}function np(i,e,t=0,a=null,s=null){let n=null;return r=>{if(r.action==="start"&&(n=i.sceneIntersectionHelper.intersectElevationFromScreen(et(r.screenStart.x,r.screenStart.y),e,t,s),h(n)&&h(a)&&!vs(n,n,a))||m(n))return null;const o=i.sceneIntersectionHelper.intersectElevationFromScreen(et(r.screenEnd.x,r.screenEnd.y),e,t,s);return h(o)?h(a)&&!vs(o,o,a)?null:{...r,mapStart:n,mapEnd:o}:null}}function Qa(i,e,t,a=null,s=null){return np(i,t,jr(e,i,t),a,s)}function Co(i,e,t,a=null,s=null){return Qa(i,t,J(e),a,s)}function rp(i,e,t,a){const s=e.toMap(i.screenStart,{include:[t]});return h(s)?Co(e,t,s,a):null}function op(i,e){const t=cp,a=hp,s=hi();i.renderCoordsHelper.worldUpAtPosition(e,t);const n=He(s,t,N(a,e,i.state.camera.eye));return He(n,n,t),Ft(e,n,s)}function Lo(i,e,t){let a=null;const s=new Ws;return s.next(Ga(i,op(i,e))).next(lp(i,e)).next(Go(i,t)).next(n=>{n.mapEnd.x=n.mapStart.x,n.mapEnd.y=n.mapStart.y,a=n}),n=>(a=null,s.execute(n),a)}function lp(i,e){const t=M(),a=Re(e);i.renderCoordsHelper.worldUpAtPosition(e,t);const s=M(),n=M(),r=o=>(N(o,o,e),Zl(t,o,o),i.viewingMode==="global"&&Re(o)*Math.sign(ba(t,o))<.001-a&&N(o,_e(o,t,.001),e),Z(o,o,e),o);return o=>(o.renderStart=r(U(s,o.renderStart)),o.renderEnd=r(U(n,o.renderEnd)),o)}function Go(i,e){const t=i.renderCoordsHelper;return a=>{const s=t.fromRenderCoords(a.renderStart,e),n=t.fromRenderCoords(a.renderEnd,e);return h(s)&&h(n)?{...a,mapStart:s,mapEnd:n}:null}}var pr;(function(i){i[i.GROUND=0]="GROUND",i[i.OTHER=1]="OTHER"})(pr||(pr={}));const cp=M(),hp=M(),ur=Hi();function Ja(i,e,t,a){const s=i.graphic,n=(r,o)=>e({action:r,graphic:s,dxScreen:o.screenDeltaX,dyScreen:o.screenDeltaY});return t((r,o,l)=>(o.next(c=>(c.action==="start"&&n("start",c),c)).next(eh(s,a)).next(c=>{switch(c.action){case"start":case"update":(c.translationX||c.translationY||c.translationZ)&&n("update",c);break;case"end":n("end",c)}return c}),{steps:o,cancel:l=l.next(th(s)).next(c=>(n("end",{screenDeltaX:0,screenDeltaY:0}),c))}))}function Io(i){if(m(i)||i.type!=="polyline"&&i.type!=="polygon")return 0;const e=(i.type==="polyline"?i.paths:i.rings)[0];if(!e||e.length<2)return 0;const t=e[0],a=e[1];return Math.atan2(a[1]-t[1],a[0]-t[0])}function Ia(i){if(m(i)||m(i.axis))return 1;const{mapStart:e,mapEnd:t,axis:a}=i,s=[t.x-e.x,t.y-e.y];return s[0]*a[0]+s[1]*a[1]>0?1:-1}class dp extends qi{constructor(e){super(),this._handles=new li,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ke,this._updateAfterDrag=!1,this.events=new at,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this._handles=Y(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,z.TRANSLATE_XY)}createGraphicDragPipeline(e,t,a){const s=t.graphic,n=J(s),r=L(s.geometry).spatialReference;return Ja(t,a,o=>this.createDragPipeline((l,c,p,u,g)=>({steps:c,cancel:p}=e(l,c,p,u,g),o(l,c,p)),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,t,a,s){return ye(this._arrowManipulatorInfos.map(({manipulator:n},r)=>je(n,(o,l,c,p,u)=>{const g=l.next(b=>({...b,manipulatorType:z.TRANSLATE_XY})).next(xi(this._view,o.elevationAlignedLocation)).next(Qa(this._view,o.elevationAlignedLocation,t,a,s)).next(ih(o.location,this.angle+(r+1)*Math.PI*.5)).next(di());e(o,g,c,p,u)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},a){const s=this._radius/Ke,n=Xd*s,r=n*Math.sqrt(3)/2,o=Ra(this._opaqueMaterial,r,n/2,n/2,Do);to(o,va(oe.get(),X(w.get(),0,-r/3,0))),e.renderObjects=[new E(o,O.Focused),new E(o.instantiate({material:this._transparentMaterial}),O.Unfocused)],e.radius=r/3*2*1.2;const l=Vs(oe.get(),a*Math.PI/2),c=va(oe.get(),X(w.get(),0,Zd*s,0));Je(t,l,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Hr(oe.get(),e,j(0,0,1));if(m(t))return;const a=Ma(oe.get(),X(w.get(),this.displayScale,this.displayScale,this.displayScale)),s=Je(oe.get(),a,t);for(const n of this._arrowManipulatorInfos){const r=Je(oe.get(),s,n.transform);n.manipulator.modelTransform=r}}_createArrowManipulator(e){const t=new ge({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:j(0,0,1)}}),a={manipulator:t,transform:be()};return this._updateArrowManipulator(a,e),this._handles.add(t.events.on("drag",s=>{this._updateAfterDrag&&s.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(e=1){const t=Q.toUnitRGBA(P.main);return t[3]*=e,new ze({color:t,transparent:e!==1,cullFace:ae.Back,renderOccluded:R.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class pp{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&h(this._lastDragEvent)&&h(this._next)){const t=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(h(a)){const s={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:e===!0?a:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(s)}}this._enabled=e}_snap(e){const t=h(this._view)?this._view.toMap(e,{exclude:[]}):null;return h(t)&&h(this._view)&&(t.z=jr(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const a=new Ws;return this._next=a,[s=>{if(this._lastDragEvent=s.action!=="end"?{...s}:null,this._enabled){const n=this._snap(s.screenEnd);return h(n)?{action:s.action,mapStart:s.mapStart,mapEnd:n,screenStart:s.screenStart,screenEnd:s.screenEnd}:null}return{action:s.action,mapStart:s.mapStart,mapEnd:s.mapEnd,screenStart:s.screenStart,screenEnd:s.screenEnd}},a]}}class up extends qi{constructor(e){super(),this._snapToScene=new pp,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ke,this._view=e.view,this._tool=e.tool,e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,z.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,a){const s=t.graphic,n=J(s),r=L(s.geometry).spatialReference;return Ja(t,a,o=>this.createDragPipeline((l,c,p,u,g)=>({steps:c,cancel:p}=e(l,c,p,u,g),o(l,c,p)),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,t,a,s){const n=this._view;return je(this._manipulator,(r,o,l,c,p)=>{const u=o.next(xi(n,r.elevationAlignedLocation)).next(Qa(n,r.elevationAlignedLocation,t,a,s)).next(...this._snapToScene.createDragEventPipelineStep(n,t)).next(g=>({...g,manipulatorType:z.TRANSLATE_XY})).next(di());e(r,u,l,c,p)})}_updateManipulatorTransform(){const e=Ma(oe.get(),X(w.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new ge({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:j(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=cc(this._discMaterial,Do,1,To,j(0,0,1),j(0,0,0));e.transformation=Ma(be(),j(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new E(e,O.Focused),new E(e.instantiate({material:this._discMaterialTransparent}),O.Unfocused)],this._manipulator.radius=Yd*(this._radius/Ke)}_createMaterial(e=1){const t=Q.toUnitRGBA(P.main);return t[3]*=e,new ze({color:t,transparent:e!==1,cullFace:ae.Back,renderOccluded:R.Transparent})}get test(){return{discManipulator:this._manipulator}}}class _p extends qi{constructor(e){super(),this._radius=Ke,this.events=new at,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,z.TRANSLATE_Z)}createGraphicDragPipeline(e,t,a){const s=L(t.graphic.geometry).spatialReference;return Ja(t,a,n=>this.createDragPipeline((r,o,l,c,p)=>({steps:o,cancel:l}=e(r,o,l,c,p),n(r,o,l)),s),this._view.state.viewingMode)}createDragPipeline(e,t){const a=this._view;return je(this._manipulator,(s,n,r,o,l)=>{const c=n.next(p=>({...p,manipulatorType:z.TRANSLATE_Z})).next(Lo(a,s.renderLocation,t)).next(di());e(s,c,r,o,l)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/Ke,t=v.zManipulator.height*e,a=v.zManipulator.coneHeight*e,s=v.zManipulator.coneWidth*e,n=v.zManipulator.width*e,r=[j(0,0,0),j(0,0,t)],o=[j(0,0,0),j(0,0,t+a)],l=x=>{const C=be();if(ua(C,C,[0,0,t]),Ur(C,C,Math.PI/2),x){const F=1+2*x/s;si(C,C,[F,F,F])}return C},c=l(0),p=(x,C)=>{const F=yl(v.zManipulator.color,C);return[F.r/255,F.g/255,F.b/255,v.zManipulator.color.a*x]},u=ht(p(1,.25),R.Occlude),g=ht(p(1,0),R.Occlude),b=ht(p(.7,0),v.zManipulator.renderOccluded),y=ht(p(.85,0),v.zManipulator.renderOccluded),f=hc(u,r,n/2,16,!1),S=xs(u,a,s/2,16,!1);S.transformation=c,this._manipulator.renderObjects=[new E(S,O.Unfocused),new E(f,O.Unfocused),new E(S.instantiate({material:g}),O.Focused),new E(f.instantiate({material:g}),O.Focused),new E(S.instantiate({material:b}),O.Unfocused),new E(f.instantiate({material:b}),O.Unfocused),new E(S.instantiate({material:y}),O.Focused),new E(f.instantiate({material:y}),O.Focused)],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[o]}}_createManipulator(){const e=new ge({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=t=>{const a=this._view.state.camera,s=_r;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,s);const n=vl(a.eye,s),r=a.computeRenderPixelSizeAtDist(n),o=N(Zt,s,a.eye);le(o,o);const l=gp;this._view.renderCoordsHelper.worldUpAtPosition(_r,l);const c=Math.abs(ba(o,l)),p=He(Zt,o,l),u=He(Zt,p,l),g=fa(c,.01,1),b=1-Math.sqrt(1-g*g)/g/a.fullWidth,y=this._radius/Ke,f=v.zManipulator.width*y;_e(u,le(u,u),(1/b-1)*n+r*f),t[12]-=Zt[0],t[13]-=Zt[1],t[14]-=Zt[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const _r=M(),Zt=M(),gp=M();class zt extends qi{constructor(e){super(),this._handles=new li,this._interactive=!0;const{tool:t,view:a,snapToScene:s,radius:n}=e;this._view=a,this.xyManipulation=new up({tool:t,view:a,snapToScene:s,radius:n}),this.xyAxisManipulation=new dp({tool:t,view:a,radius:n}),this.zManipulation=new _p({tool:t,view:a,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(r=>this._handles.add(r.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,a){return ye([this.xyManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(D.XY,s,n,r,o,l),t,a),this.xyAxisManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(D.XY_AXIS,s,n,r,o,l),t,a),this.zManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(D.Z,s,n,r,o,l),t,a)])}createDragPipeline(e,t,a,s){return ye([this.xyManipulation.createDragPipeline((n,r,o,l,c)=>e(D.XY,n,r,o,l,c),t,a,s),this.xyAxisManipulation.createDragPipeline((n,r,o,l,c)=>e(D.XY_AXIS,n,r,o,l,c),t,a,s),this.zManipulation.createDragPipeline((n,r,o,l,c)=>e(D.Z,n,r,o,l,c),a)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,z.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(t=>e(t,z.TRANSLATE_XY)),this.zManipulation.forEachManipulator(t=>e(t,z.TRANSLATE_Z))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator(t=>t.focused)||this.xyAxisManipulation.someManipulator(t=>t.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(kr("esri-mobile"))return;const a=[];t.forEachManipulator(n=>a.push(n)),e.forEachManipulator(n=>a.push(n));const s=()=>{const n=[];this._xyAxisVisible||e.forEachManipulator(r=>n.push(r.disableDisplay())),this._handles.remove(gr),this._handles.add(n,gr)};for(const n of a)this._handles.add(n.events.on("focus-changed",s));this._view.inputManager&&this._handles.add(ni(()=>{var n;return(n=this._view.inputManager)==null?void 0:n.latestPointerType},s)),s()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=h(e)&&e.type==="point-3d"&&e.symbolLayers;return!!t&&t.length>0&&t.some(a=>a.type==="icon")?Po:Ke}}const gr="disable-xy-axis-display";var D;(function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z"})(D||(D={}));class Qs extends qi{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,z.TRANSLATE_XY)}createGraphicDragPipeline(e){return Ja(this._graphicState,e,t=>this.createDragPipeline(t),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,a=this._graphicState.graphic,s=h(a.geometry)?a.geometry.spatialReference:null;return je(this._manipulator,(n,r,o,l,c)=>{const p=r.next(rp(c,t,a,s)).next(Jt()).next(di());e(n,p,o,l,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new dh({graphic:t,view:e,selectable:!0,cursor:"move"})}}class mp{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class fp{constructor(e,t,a){this.dx=e,this.dy=t,this.allGraphics=a,this.type="graphic-move"}}class mr{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let Ye=class extends Br(at.EventedMixin(Ha)){constructor(i){super(i),this.graphics=new bl,this.enableZ=!0,this.tooltipOptions=new wt,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:i,view:e}=this;this.addHandles([i.on("change",()=>this._refreshManipulators()),I(()=>this.tooltipOptions.enabled,t=>{this._tooltip=t?new ji({view:e}):Y(this._tooltip)},zs)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=Y(this._tooltip),this._moveManipulation=Y(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){var e;this.handles.removeAll(),(e=this._moveManipulation)==null||e.destroy(),this.manipulators.removeAll();const i=this.graphics.toArray().filter(t=>Ml(t)===Wr.SUPPORTED).map(t=>new vp(t));i.length&&(this._createManipulators(i),this._createVisualElements(i),this.handles.add(i.map(t=>this.view.trackGraphicState(t.state))),this._updateMoveManipulation(i))}_createManipulators(i){for(const e of i){const t=e.state;e.manipulationXY=new Qs({tool:this,view:this.view,graphicState:t}),e.manipulationXY.forEachManipulator(a=>this.handles.add([a.events.on("immediate-click",s=>{this.emit("immediate-click",{...s,graphic:t.graphic}),s.stopPropagation()}),a.events.on("grab-changed",({action:s})=>{const{tooltipOptions:n,_tooltip:r}=this;m(r)||(s==="start"?r.info=new Ci({tooltipOptions:n}):r.clear())})])),this.handles.add(e.manipulationXY.createDragPipeline((a,s,n,r)=>this._buildDragEventPipeline(i,D.XY,a,s,n,r)))}this._createMoveManipulation(i)}_createMoveManipulation(i){const e=new zt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:i.length===1?zt.radiusForSymbol(i[0].graphic.symbol):Ke});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator(n=>{this.handles.add(n.events.on("immediate-click",r=>{e.zManipulation.hasManipulator(n)||this.graphics.length!==1||this.emit("immediate-click",{...r,graphic:this.graphics.getItemAt(0)}),r.stopPropagation()}))});const t=n=>r=>{this.handles.add(r.events.on("focus-changed",({action:o})=>{const l=this._tooltip;m(l)||(o==="focus"?this._updateMoveTooltip(i,n):l.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(t(D.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(t(D.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(t(D.Z));const a=()=>this._updateMoveManipulation(i);for(const n of i)this.handles.add([n.state.on("changed",a),I(()=>n.state.displaying,a)]);const s=i[i.length-1];this.handles.add(s.state.on("changed",()=>this._updateMoveManipulationAngle(s))),this.handles.add(e.createDragPipeline((n,r,o,l,c)=>this._buildDragEventPipeline(i,n,r,o,l,c),J(s.graphic),L(s.graphic.geometry).spatialReference,s.graphic)),this._updateMoveManipulationAngle(s)}_createVisualElements(i){for(const e of i){const t=e.graphic,a=qa({view:this.view,graphic:t,forEachManipulator:s=>{var n;(n=e.manipulationXY)==null||n.forEachManipulator(s),this._moveManipulation.forEachManipulator(s)},onManipulatorsChanged:()=>It()});m(a)||(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof Nt&&this.handles.add([e.geometryRepresentation.events.on("attachment-origin-changed",()=>{e.state.isDraped||this._updateMoveManipulation(i)}),I(()=>e.state.isDraped,()=>this._updateMoveManipulation(i))]),this.handles.add(a))}}_updateMoveManipulationAngle(i){this._moveManipulation.angle=Io(i.graphic.geometry)}_updateMoveManipulation(i){var n,r;const e=jt(0,0,0,this.view.spatialReference);let t=0,a=!1;const s=this._moveManipulation;for(const o of i){if(!o.state.displaying)continue;const l=o.state.graphic;this.enableZ&&Vt(l)&&(a=!0);const c=o.geometryRepresentation instanceof Nt&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:La(this.view,l);if(h(c)){const{x:p,y:u,z:g}=c;e.x+=p,e.y+=u,g&&((n=e.z)!=null||(e.z=0),e.z+=g),t++}}t>0?(e.x/=t,e.y/=t,(r=e.z)!=null||(e.z=0),e.z/=t,s.location=e,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=a):s.available=!1}_buildDragEventPipeline(i,e,t,a,s,n){const r=[],o=[];let l=null,c=null;const p=()=>{for(const u of r)u.dragging=!1;r.length=0,o.length=0,l=null,c=null,this._moveManipulation.interactive=!0};if(i.length===1&&e===D.XY){const u=i[0].graphic;({steps:a,cancel:s}=this._buildSnappingPipelineSteps(u,J(u),a,s,n))}return s=s.next(u=>c==null?void 0:c(u)).next(()=>(this.emit("graphic-move-stop",new mr(o)),this.destroyed||p(),null)),{steps:a=a.next(u=>{var g,b;if(u.action==="start"){r.length=0,o.length=0;for(const y of i)y.dragging||!((g=y.manipulationXY)!=null&&g.hasManipulator(t))&&((b=y.manipulationXY)==null?void 0:b.grabbing)||(r.push(y),o.push(y.graphic),y.dragging=!0);if(o.length!==0&&(this._moveManipulation.interactive=!1,l=ah(o,this.view.state.viewingMode),c=sh(o),this.emit("graphic-move-start",new mp(o)),this.destroyed))return null}return o.length!==0?u:null}).next(u=>l==null?void 0:l(u)).next(u=>(this._updateMoveTooltip(i,e,u),u)).next(u=>{switch(u.action){case"start":case"update":if(u.translationX||u.translationY||u.translationZ){const g=this.view.toScreen(u.mapStart),b=this.view.toScreen(u.mapEnd),y=b.x-g.x,f=b.y-g.y;if(this.emit("graphic-move",new fp(y,f,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new mr(o)),this.destroyed)return null;p()}return null}),cancel:s}}_updateMoveTooltip(i,e,t){const{tooltipOptions:a,_tooltip:s}=this;if(m(s))return;s.clear();const n=i.length===0?"absolute-height":i[0].state.isDraped?"on-the-ground":"absolute-height";switch(e){case D.XY:s.info=new Ci({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,t,(r,o)=>dt(r,o,n));break;case D.XY_AXIS:s.info=new Ys({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,t,(r,o)=>{const l=dt(r,o,n);return xa(l,Ia(t))});break;case D.Z:s.info=new Ua({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,t,wa)}}_updateMoveTooltipDistance(i,e,t){if(h(e)&&e.action!=="end"){const{mapStart:a,mapEnd:s}=e,n=t(a,s);i.distance=h(n)?n:Ti}}_buildSnappingPipelineSteps(i,e,t,a,s){const n=i.geometry;if(m(n)||n.type!=="point"&&n.type!=="mesh")return{steps:t,cancel:a};const r=(n.type==="point"?n:n.anchor).clone(),o=new Da({elevationInfo:e,pointer:s,editGeometryOperations:ja.fromGeometry(r,this.view.state.viewingMode),visualizer:new Gi,excludeFeature:i}),l=this.snappingManager,{snappingStep:c,cancelSnapping:p}=Pa({snappingContext:o,snappingManager:l,updatingHandles:this.updatingHandles});return a=a.next(p),{steps:t=t.next(u=>(r.z=Sl(this.view,r,J(i),{mode:"absolute-height",offset:0}),{...u,snapOrigin:o.coordinateHelper.pointToVector(r)})).next(...c),cancel:a}}get test(){return{tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],Ye.prototype,"view",void 0),d([_()],Ye.prototype,"graphics",void 0),d([_({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableZ",void 0),d([_({constructOnly:!0,type:wt})],Ye.prototype,"tooltipOptions",void 0),d([_({constructOnly:!0})],Ye.prototype,"snappingManager",void 0),d([_()],Ye.prototype,"type",void 0),d([_()],Ye.prototype,"updating",null),Ye=d([K("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Ye);class vp{constructor(e){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Ut({graphic:e})}get graphic(){return this.state.graphic}}function fr(i,e,t){const a=t.mode==="on-the-ground"?An.XY:An.XYZ;return new Bc(i,a,e,0)}function vr(i,e,t){const a=M();if(!i.renderCoordsHelper.toRenderCoords(e,a))return null;const s=yr(i,e,Zi(t.plane)),n=yr(i,e,t.edgeDirection);if(m(s)||m(n))return null;const r=He(M(),s,n);return Ft(a,r,hi())}function yr(i,e,t){const a=jt(e.x+t[0],e.y+t[1],e.z+t[2],e.spatialReference),s=M(),n=M();return i.renderCoordsHelper.toRenderCoords(e,s)&&i.renderCoordsHelper.toRenderCoords(a,n)?Yr(n,s,n):null}function yp(i,e,t){const a=Zi(i),s=Yr(M(),e,t),n=He(M(),s,a),r=He(M(),s,n);return $c(s[0],s[1],s[2],0,n[0],n[1],n[2],0,r[0],r[1],r[2],0,0,0,0,1)}function bp(i,e,t){const a=t.projectToRenderScreen(i,fs()),s=t.projectToRenderScreen(e,fs());return h(a)&&h(s)?wl(N(a,a,s)):0}let bt=class extends Va{constructor(i){super(i),this.type="reshape-edge-offset",this.distance=Ti,this.area=null,this.totalLength=null}};d([_()],bt.prototype,"type",void 0),d([_()],bt.prototype,"distance",void 0),d([_()],bt.prototype,"area",void 0),d([_()],bt.prototype,"totalLength",void 0),bt=d([K("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],bt);let q=class extends at.EventedMixin(Fs){constructor(i){super(i),this._vertexManipulatorMaterial=ht(v.colorToVec4(v.reshapeManipulators.vertex.color),v.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=fi(v.colorToVec4(v.reshapeManipulators.vertex.outlineColor),v.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=fi(v.colorToVec4(v.reshapeManipulators.vertex.hoverOutlineColor),v.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=ht(v.colorToVec4(v.reshapeManipulators.edge.color),v.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=fi(v.colorToVec4(v.reshapeManipulators.edge.outlineColor),v.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=ht(v.colorToVec4(v.reshapeManipulators.edgeOffset.color),v.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=ht(v.colorToVec4(v.reshapeManipulators.edgeOffset.hoverColor),v.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=ht(v.colorToVec4(v.reshapeManipulators.selected.color),v.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=fi(v.colorToVec4(v.reshapeManipulators.selected.outlineColor),v.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=fi(v.colorToVec4(v.reshapeManipulators.selected.hoverOutlineColor),v.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new li,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=k.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:i,view:e}=this,t=this._graphicState=new Ut({graphic:i});this._tooltip=new ji({view:e}),this.addHandles([I(()=>t.displaying,a=>{for(const s of this._manipulatorInfos)s.manipulator.available=a}),I(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:s,edgeOffsetEnabled:n})=>{h(a)&&(a.visible=s,a.edgeDistance=n?"far":"default")},Ze),ni(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),Ze),this.view.trackGraphicState(t)])}destroy(){this._segmentLabels=Y(this._segmentLabels),this._tooltip=Y(this._tooltip),this._removeManipulators()}get inputGeometry(){return h(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(i){this._recreateEditGeometryAndManipulators(i)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const i=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type==="vertex");this._removeVertices(i)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=Y(this._moveManipulation),this._graphicMoveManipulation=Y(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(i){if(m(this._editGeometryOperations))return;const e=J(this.graphic);for(const t of this._editGeometryOperations.data.components){const a=i==null?void 0:i.byComponentIndex.get(t.index);for(const s of t.vertices){const n=a==null?void 0:a.has(s.index);this._createVertexOrEdgeManipulator(s,e,n)}for(const s of t.edges)this._createVertexOrEdgeManipulator(s,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return h(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return h(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(m(this._editGeometryOperations))return null;const i=this._editGeometryOperations.redo();return h(i)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}undo(){if(m(this._editGeometryOperations))return null;this.emit("undo");const i=this._editGeometryOperations.undo();return h(i)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(i){const e={byComponentIndex:new Map};if(h(i)&&h(this.inputGeometry)&&xl(i,this.inputGeometry)){for(const t of this._manipulatorInfos)if(t.type==="vertex"&&t.manipulator.selected){const{index:a,component:{index:s}}=t.handle,{byComponentIndex:n}=e,r=n.get(s)||new Set;r.add(a),n.set(s,r)}}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=Y(this._editGeometryOperations),this._segmentLabels=Y(this._segmentLabels),m(i)||(this._editGeometryOperations=ja.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(e),this._segmentLabels=new $a({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:J(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(i,e){if(e.action==="end")return e;let t=0;const a=[],s=this._manipulatorInfos.some(r=>r.type==="vertex"&&r.manipulator.selected),n=i===Kt.SELECTED_OR_ALL&&s;for(const r of this._manipulatorInfos)r.type==="vertex"&&(r.manipulator.grabbing||n&&!r.manipulator.selected||a.push(r),t++);if(a.length===0)return e;if(this._moveVertices(a,e),a.length===t){if(this._updateEventState(k.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(k.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((i,e)=>e.type==="vertex"&&e.manipulator.selected?i+1:i,0)>1}_perVertexManipulatorDragAction(i){if(this._updateEventState(k.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:t,mapDeltaZ:a}=i;if(!e&&!t&&!a)return;const s=[];for(const n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected&&!n.manipulator.grabbing||n===i.info)&&s.push(n);this._moveVertices(s,i,ct.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(i){if(i===this._reshapeEventState)return!1;switch(i){case k.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case k.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case k.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case k.MOVING:switch(this._reshapeEventState){case k.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case k.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case k.RESHAPING:switch(this._reshapeEventState){case k.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case k.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==i;return this._reshapeEventState=i,e}_createGraphicMoveManipulation(){const{tool:i,view:e}=this,t=this._graphicState;if(this._graphicMoveManipulation=new Qs({tool:i,view:e,graphicState:t}),this.enableMoveGraphic){let a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((s,n,r)=>{n.next(o=>this._trackNumDragging(o)).next(o=>(o.action==="start"&&(a=L(this._editGeometryOperations).createUndoGroup()),o)).next(o=>this._perGraphicManipulatorDragAction(Kt.ALL,o)).next(o=>(this._updateTranslateGraphicTooltip(D.XY,o),o)).next(o=>{o.action==="end"&&(this._tooltip.clear(),a=gt(a))}),r.next(()=>this._onDragCancel(!0,()=>a=gt(a)))})),this._graphicMoveManipulation.forEachManipulator(s=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!1)))}else this._graphicMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(a.events.on("immediate-click",s=>{this._manipulatorInfos.some(n=>n.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...s,graphic:this.graphic}),s.stopPropagation()})))}_createMoveManipulation(i){const{graphic:e,handles:t,tool:a,view:s}=this,n=this._graphicState;this._moveManipulation=new zt({tool:a,view:s,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Vt(e),snapToScene:!1,radius:zt.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator(l=>t.add([l.events.on("immediate-click",c=>{this._moveManipulation.zManipulation.hasManipulator(l)||this._manipulatorInfos.some(p=>p.manipulator.selected)||this.emit("immediate-click",{...c,graphic:e}),c.stopPropagation()}),this._watchAndUpdateGrabState(l,!1)]));const r=l=>c=>{t.add(c.events.on("focus-changed",({action:p})=>{p==="focus"&&this._tooltipOptions.enabled?this._updateTranslateTooltip(l):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(r(D.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(D.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(D.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const o=L(e.geometry).spatialReference;t.add([this._moveManipulation.createDragPipeline((l,c,p,u,g)=>{const{snappingStep:b,cancelSnapping:y}=Pa({predicate:f=>!!f.info,snappingManager:a.snappingManager,snappingContext:new Da({editGeometryOperations:L(this._editGeometryOperations),elevationInfo:i,pointer:g,excludeFeature:e,visualizer:new Gi}),updatingHandles:this.updatingHandles,useZ:!1});return u=u.next(f=>(this._onDragCancel(),f)).next(y),{steps:p=p.next(f=>this._trackNumDragging(f)).next(f=>{const S=this._manipulatorInfos.filter(x=>x.type==="vertex"&&x.manipulator.selected);return f.manipulatorType===z.TRANSLATE_XY&&S.length===1?{...f,info:S[0],snapOrigin:S[0].handle.pos}:f}).next(Tn(this.view,i,e)).next(...b).next(Jt()).next(f=>this._perGraphicManipulatorDragAction(Kt.SELECTED_OR_ALL,f)).next(f=>(this._updateTranslateTooltip(l,f),f)),cancel:u}},i,o,e),I(()=>n.displaying,()=>this._updateMoveManipulationPosition(),Ze),n.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),I(()=>n.isDraped,l=>{this._updateMoveManipulationPosition();const c="align-move-manipulation";l?t.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),c):t.remove(c)},Ze)])}_createVisualElements(){const{graphic:i,view:e}=this,t=qa({view:e,graphic:i,forEachManipulator:a=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(a),this._moveManipulation.forEachManipulator(a);for(const s of this._manipulatorInfos)a(s.manipulator,z.TRANSLATE_XY)}},onManipulatorsChanged:a=>this.on("manipulators-changed",a)});h(t)&&(this._outlineVisualElement=t.visualElement instanceof Nt?t.visualElement:null),h(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(t)}_createEdgeOffsetManipulator(i,e=J(this.graphic)){var b,y;const t=v.reshapeManipulators.edgeOffset,a=t.size/2,s=a+t.collisionPadding,n=a/s,r=n*Math.sqrt(3)/2;m(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=Ra(this._edgeOffsetManipulatorMaterial,r,n/2,n/2,t.height,t.offset)),m(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=Ra(this._edgeOffsetManipulatorMaterial,-r,n/2,n/2,t.height,-t.offset));const o=[new E(this._edgeOffsetManipulatorGeometryInside.instantiate(),O.Unfocused),new E(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),O.Focused),new E(this._edgeOffsetManipulatorGeometryOutside.instantiate(),O.Unfocused),new E(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),O.Focused)],l=new ge({view:this.view,renderObjects:o,elevationInfo:e.mode!=="on-the-ground"||un(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!((b=this.graphic.layer)!=null&&b.visible)),collisionType:{type:"disc",direction:j(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),c=new ge({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!((y=this.graphic.layer)!=null&&y.visible)),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),p={manipulator:l,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:c,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(p,t.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(p);const u=[];for(const f of[p.handle.leftVertex,p.handle.rightVertex]){const S=this._getManipulatorInfoFromHandle(f);h(S)&&u.push(S.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(p)))}p.locationUpdateHandle=ye(u),this._manipulatorHandles.add(p.locationUpdateHandle,l),this._manipulatorHandles.add([this._watchAndUpdateGrabState(l,!0),this._watchAndUpdateGrabState(c,!0)],l),this._manipulatorHandles.add(je(l,this._createEdgeOffsetPipeline(p,e)),l),this._manipulatorHandles.add(je(c,(f,S,x,C)=>{if(C==="touch")this._createEdgeOffsetPipeline(p,e)(f,S,x);else if(this.enableMoveGraphic){const F=this.graphic,ee=h(F.geometry)?F.geometry.spatialReference:null;S.next(W=>this._trackNumDragging(W)).next(xi(this.view,f.elevationAlignedLocation)).next(Qa(this.view,f.elevationAlignedLocation,e,ee,F)).next(di()).next(Jt()).next(W=>this._perGraphicManipulatorDragAction(Kt.ALL,W)).next(W=>(this._updateTranslateGraphicTooltip(D.XY,W),W)).next(W=>{W.action==="end"&&this._tooltip.clear()}),x.next(()=>this._onDragCancel(!f.metadata.deleting))}}),l);const g=f=>{this._manipulatorInfos.some(S=>S.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...f,graphic:this.graphic}),f.stopPropagation()};return this._manipulatorHandles.add([l.events.on("immediate-click",g),c.events.on("immediate-click",g),l.events.on("focus-changed",({action:f})=>{const S=this._tooltipOptions;if(f==="focus"&&S.enabled){const x=this._tooltip.info=new bt({tooltipOptions:S});this._updateTooltipAreaOrTotalLength(x)}else this._tooltip.clear()})],l),this._manipulatorInfos.push(p),this.manipulators.add(l),this.manipulators.add(c),this.emit("manipulators-changed"),p}_autoHideEdgeOffsetManipulator(i,e){const t=i.manipulator,a=i.edgeManipulator,s=()=>{i.visibilityHandle=gt(i.visibilityHandle);const n=this._getManipulatorInfoFromHandle(i.handle.leftVertex),r=this._getManipulatorInfoFromHandle(i.handle.rightVertex),o=h(n)&&h(r)&&bp(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!t.focused&&!a.focused||o)&&(t.grabbable=!o,a.grabbable=!o,i.visibilityHandle=ye([t.disableDisplay(),{remove:()=>{t.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([t.events.on("focus-changed",s),a.events.on("focus-changed",s),{remove:()=>{gt(i.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],t),s()}_updateEdgeOffsetManipulator(i){this._updateManipulatorPosition(i);const{coordinateHelper:e}=L(this._editGeometryOperations).data,t=vr(this.view,i.manipulator.elevationAlignedLocation,fr(e,i.handle,L(i.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(i.handle.leftVertex),s=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(m(a)||m(s))return;const n=a.manipulator.renderLocation,r=s.manipulator.renderLocation,o=h(t)?yp(t,n,r):Cc;i.manipulator.modelTransform=o,i.edgeManipulator.elevationAlignedLocation=i.manipulator.elevationAlignedLocation,i.edgeManipulator.modelTransform=o;const l=Re(N(ra,n,r))/2;i.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(i,e){return(t,a,s)=>{this._clearSelection();const{step:n,cleanup:r}=this._initializeEdgeOffset(i,e);a.next(o=>this._trackNumDragging(o)).next(xi(this.view,t.elevationAlignedLocation)).next(n).next(sp(this.view)).next(Go(this.view,L(this._editGeometryOperations).data.spatialReference)).next(Jt()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(i)).next(this._showEdgeOffsetTooltip()).next(o=>{o.action==="end"&&r()}),s.next(()=>{t.metadata.deleting||(r(),this._onDragCancel())})}}_initializeEdgeOffset(i,e){const t=L(this._editGeometryOperations),a=fr(t.data.coordinateHelper,i.handle,e),s=t.createUndoGroup(),n=vr(this.view,i.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const u=this._getManipulatorInfoFromHandle(i.handle.leftVertex.leftEdge);h(u)&&this._splitEdgeManipulator(u,1)}if(a.requiresSplitEdgeRight){const u=this._getManipulatorInfoFromHandle(i.handle.rightVertex.rightEdge);h(u)&&this._splitEdgeManipulator(u,0)}const r=()=>new Al({paths:[[i.handle.leftVertex.pos,i.handle.rightVertex.pos]],spatialReference:t.data.spatialReference}),o=new Nt({view:this.view,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:i.elevationInfo,width:v.visualElements.lineGraphics.outline.width,color:v.colorToVec4(P.main),attached:!0});let l;const c=()=>{this._cleanEdgeOffsetCollapsedEdges(i),l=gt(l)},p=this.on("undo",c);return l=ye([Oe(o),I(()=>this._graphicState.isDraped,u=>o.isDraped=u),this._graphicState.on("changed",()=>o.geometry=r()),s,p]),{step:u=>m(a)||m(n)?(c(),null):{...u,operation:a,plane:n},cleanup:c}}_applyEdgeOffsetStep(i){return e=>{if(this.destroyed||m(e.operation))return e;this._updateEventState(k.RESHAPING);const{mapDeltaX:t,mapDeltaY:a,mapDeltaZ:s}=e;return(t||a||s)&&(this._offsetEdge(i,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return i=>{const{operation:e,mapEnd:t}=i;return m(e)||m(t)?i:(i.action==="start"&&e.selectArrowFromStartPoint(t),{...i,signedDistance:e.signedDistanceToPoint(t)})}}_showEdgeOffsetTooltip(){return i=>{const{mapEnd:e,signedDistance:t,operation:a}=i,s=this._tooltip,n=this._tooltipOptions;if(!n.enabled||m(t))return s.clear(),i;let r=s.info;(m(r)||r.type!=="reshape-edge-offset")&&(r=s.info=new bt({tooltipOptions:n}));const{coordinateHelper:o}=L(this._editGeometryOperations).data;return r.distance=i.action==="end"?Ti:Mp(this._graphicState.isDraped,t*a.selectedArrow,e,a.plane,o),this._updateTooltipAreaOrTotalLength(r),i}}_cleanEdgeOffsetCollapsedEdges(i){var o,l;const e=(o=i.handle.leftVertex.leftEdge)==null?void 0:o.leftVertex,t=i.handle.leftVertex,a=(l=i.handle.rightVertex.rightEdge)==null?void 0:l.rightVertex,s=i.handle.rightVertex,n=L(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&n.distance(e.pos,t.pos)<hs){const c=this._getManipulatorInfoFromHandle(t);h(c)&&r.push(c)}if(n.distance(t.pos,s.pos)<hs||a&&n.distance(a.pos,s.pos)<hs){const c=this._getManipulatorInfoFromHandle(s);h(c)&&r.push(c)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(i){const e=i.size/2,t=e+i.collisionPadding;return{size:e/t,outlineSize:(e+i.outlineSize)/t}}_createVertexOrEdgeManipulator(i,e=J(this.graphic),t=!1){var o;if(i.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(i,e);if(!this.enableMidpoints)return null}if(m(this._vertexManipulatorGeometry)||m(this._vertexManipulatorOutlineGeometry)){const{size:l,outlineSize:c}=this._computeVertexManipulatorSizeAndOutline(v.reshapeManipulators.vertex);this._vertexManipulatorGeometry=Mi(this._vertexManipulatorMaterial,l,16,16),this._vertexManipulatorOutlineGeometry=Mi(this._vertexManipulatorOutlineMaterial,c,16,16)}if(m(this._edgeManipulatorGeometry)||m(this._edgeManipulatorOutlineGeometry)){const{size:l,outlineSize:c}=this._computeVertexManipulatorSizeAndOutline(v.reshapeManipulators.edge);this._edgeManipulatorGeometry=Mi(this._edgeManipulatorMaterial,l,16,16),this._edgeManipulatorOutlineGeometry=Mi(this._edgeManipulatorOutlineMaterial,c,16,16)}const a=h(this.graphic.geometry)&&this.graphic.geometry.type==="point"?[]:[new E(this._vertexManipulatorGeometry.instantiate(),Le.Vertex|O.Unselected),new E(this._vertexManipulatorOutlineGeometry.instantiate(),Le.Vertex|O.Unfocused|O.Unselected),new E(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Le.Vertex|O.Focused|O.Unselected),new E(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),O.Selected),new E(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),O.Selected|O.Unfocused),new E(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),O.Selected|O.Focused)];this.enableMidpoints&&a.push(new E(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Le.Edge|O.Focused|O.Unselected),new E(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Le.Edge|O.Focused|O.Unselected),new E(this._edgeManipulatorGeometry.instantiate(),Le.Edge|O.Unfocused|O.Unselected),new E(this._edgeManipulatorOutlineGeometry.instantiate(),Le.Edge|O.Unfocused|O.Unselected));const s=new ge({view:this.view,renderObjects:a,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!((o=this.graphic.layer)!=null&&o.visible)),metadata:{deleting:!1}});s.selected=t,this._setTypeSpecificManipulatorSettings(s,i,e);const n=i.type==="edge"?{manipulator:s,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:s,handle:i,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(n),this.manipulators.add(s),this._updateManipulatorPosition(n),n.type==="edge"){const l=[];for(const c of[n.handle.leftVertex,n.handle.rightVertex]){const p=this._getManipulatorInfoFromHandle(c);h(p)&&l.push(p.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(n)))}n.locationUpdateHandle=ye(l),this._manipulatorHandles.add(n.locationUpdateHandle,s)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!0),s);const r=je(s,(l,c,p,u)=>{let g=null;const{snappingStep:b,cancelSnapping:y}=Pa({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Da({editGeometryOperations:L(this._editGeometryOperations),elevationInfo:e,pointer:u,excludeFeature:this.graphic,visualizer:new Gi}),updatingHandles:this.updatingHandles,useZ:!1});p=p.next(f=>(this._onDragCancel(!l.metadata.deleting,()=>g=gt(g)),f)).next(y),c.next(f=>this._trackNumDragging(f)).next(f=>{if(f.action==="start"&&(g=L(this._editGeometryOperations).createUndoGroup()),n.type==="edge"){const S=this._splitEdgeManipulator(n);return{...f,info:S,snapOrigin:S.handle.pos}}return{...f,info:n,snapOrigin:n.handle.pos}}).next(xi(this.view,l.elevationAlignedLocation)).next(Co(this.view,this.graphic,l.elevationAlignedLocation,l.location.spatialReference,this.graphic)).next(Tn(this.view,e,this.graphic)).next(...b).next(Jt()).next(f=>{this._perVertexManipulatorDragAction(f),f.action==="end"&&(g=gt(g)),this._updateTranslateVertexTooltip(l,D.XY,f)})});return this._manipulatorHandles.add([r,s.events.on("immediate-click",l=>this._manipulatorClickCallback(l,n)),s.events.on("select-changed",()=>{n.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),s.events.on("focus-changed",({action:l})=>{l==="focus"&&n.type!=="edge"?this._updateTranslateVertexTooltip(s,D.XY):this._tooltip.clear()})],s),this.emit("manipulators-changed"),n}_trackNumDragging(i){switch(i.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return i}_onDragCancel(i=!0,e){switch(this._numDragging--,i&&(this.undo(),this.outputGeometry=h(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),h(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case k.NONE:break;case k.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case k.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(k.NONE)}_setTypeSpecificManipulatorSettings(i,e,t){switch(e.type){case"vertex":i.state=Le.Vertex,i.selectable=!0,i.cursor="move",i.collisionPriority=2,i.radius=v.reshapeManipulators.vertex.size/2+v.reshapeManipulators.vertex.collisionPadding,i.elevationInfo=t,i.interactive=h(this.graphic.geometry)&&this.graphic.geometry.type!=="point";break;case"edge":i.state=Le.Edge,i.selectable=!1,i.cursor="copy",i.collisionPriority=-1,i.radius=v.reshapeManipulators.edge.size/2+v.reshapeManipulators.edge.collisionPadding,i.elevationInfo=t.mode!=="on-the-ground"||un(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t}}_watchAndUpdateGrabState(i,e){return i.events.on("grab-changed",t=>this._onGrabStateChanged(i,e,t.action,t.pointerType))}_onGrabStateChanged(i,e,t,a="mouse"){if(!this._recreatingManipulators){if(t==="start")e&&this._updateSelection(i),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(k.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(a!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(s=>{s.manipulator.interactive=s.manipulator.grabbing||!this._numGrabbing&&h(this.graphic.geometry)&&this.graphic.geometry.type!=="point","edgeManipulator"in s&&(s.edgeManipulator.interactive=s.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(s=>{s.interactive=s.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const i of this._manipulatorInfos)i.manipulator.grabbing||(i.manipulator.selected=!1)}_updateSelection(i){i.grabbing&&!i.selected&&i.selectable&&(this._clearSelection(),i.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(i){m(i)||(i.manipulator.metadata.deleting=!0,this.manipulators.remove(i.manipulator),this._manipulatorHandles.remove(i.manipulator),Ol(this._manipulatorInfos,i),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(i){if(i){for(const e of this._manipulatorInfos)if(i===e.handle)return e}return null}_updateManipulatorPosition(i){if(m(i))return;const e=L(this._editGeometryOperations);if(i.type==="vertex")i.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(i.handle.pos,yi),i.manipulator.grabbing&&h(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=i.manipulator.renderLocation);else if(i.type==="edge"){const t=this._getManipulatorInfoFromHandle(i.handle.leftVertex),a=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(m(t)||m(a))return;const s=t.manipulator,n=a.manipulator;if(h(i.manipulator.elevationInfo)&&i.manipulator.elevationInfo.mode==="on-the-ground"){const r=s.location,o=n.location,l=.5,c=r.x+l*(o.x-r.x),p=r.y+l*(o.y-r.y),u=r.hasZ&&o.hasZ?0:void 0;i.manipulator.location=jt(c,p,u,e.data.spatialReference)}else Lr(ra,s.renderLocation,n.renderLocation,.5),i.manipulator.renderLocation=ra}}_splitEdgeManipulator(i,e=.5){const t=L(this._editGeometryOperations),a=L(t.splitEdge(i.handle,e).createdVertex);i.locationUpdateHandle=gt(i.locationUpdateHandle);const s=J(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(i),n=this._createVertexOrEdgeManipulator(a)):(n=i,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(i.manipulator,i.handle,s)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(n),this.enableEdgeOffset||this._updateTranslateVertexTooltip(n.manipulator,D.XY),this._updateSelection(i.manipulator);const r=this._updateEventState(k.RESHAPING),o=t.data.coordinateHelper.vectorToArray(n.handle.pos),l=t.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:L(a.index)}],added:o}),r&&this._updateEventState(k.NONE),n}_updateMoveManipulationPosition(){const i=X(ra,0,0,0);let e=0,t=!1,a=null,s=null;for(const n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected?(e++,Z(i,i,n.manipulator.renderLocation),m(a)||n.selectedIndex>a.selectedIndex?(s=a,a=n):(m(s)||n.selectedIndex>s.selectedIndex)&&(s=n)):t=!0);if(e===0){const n=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n,this._moveManipulation.zManipulation.available=n&&this.enableZShape&&Vt(this.graphic),this._moveManipulation.angle=Io(L(this.graphic.geometry)),this._moveManipulation.radius=zt.radiusForSymbol(this.graphic.symbol)}else{const n=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.zManipulation.available=n&&this.enableZVertex&&Vt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n&&e!==1;let r=0;if(h(a)){const o=a.handle.pos,l=h(s)?s.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,c=m(s)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;l&&c?this._moveManipulation.xyAxisManipulation.available=!1:l?r=br(l,o):c&&(r=br(o,c))}this._moveManipulation.angle=r,this._moveManipulation.radius=Po}e!==0&&t?(_e(i,i,1/e),yi.spatialReference=L(this._editGeometryOperations).data.spatialReference,yi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,yi),this._moveManipulation.elevationAlignedLocation=yi):h(this._outlineVisualElement)&&!this._graphicState.isDraped&&h(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Ao(this.view,this._moveManipulation,this.graphic)}_removeVertices(i){var a;const e=new Array,t=L(this._editGeometryOperations);for(const s of i)if(s.type==="vertex"&&t.canRemoveVertex()){e.push(s.handle),this._removeManipulator(s),this._removeManipulator(this._getManipulatorInfoFromHandle(s.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(s.handle.rightEdge));const n=t.removeVertices([s.handle]),r=L((a=n.removedVertices)==null?void 0:a[0].createdEdge);r&&this._createVertexOrEdgeManipulator(r)}if(e.length>0){const s=e.map(r=>{const o=t.data.components.indexOf(r.component);return{coordinates:t.data.coordinateHelper.vectorToArray(r.pos),componentIndex:o,vertexIndex:L(r.index)}});this.outputGeometry=t.data.geometry;const n=this._updateEventState(k.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map(r=>r.coordinates),vertices:s}),this.destroyed)||n&&(this._updateEventState(k.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(i,e,t=e.action==="start"?ct.NEW_STEP:ct.ACCUMULATE_STEPS){const a=L(this._editGeometryOperations);a.moveVertices(i.map(s=>s.handle),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,t),this.outputGeometry=a.data.geometry;for(const s of i)this._updateManipulatorPosition(s)}_offsetEdge(i,e){if(m(e.operation)||m(e.signedDistance))return;const t=L(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,t.updateVertices([i.handle.leftVertex,i.handle.rightVertex],a),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.rightVertex))}_manipulatorClickCallback(i,e){i.shiftKey||this._clearSelection(),e.type==="vertex"&&(e.manipulator.selected=!e.manipulator.selected,i.button===_n.Right&&this._removeVertices([e])),e.type==="edge"&&i.button===_n.Left&&this._splitEdgeManipulator(e),i.stopPropagation()}_updateTranslateTooltip(i,e){const t=this._manipulatorInfos.filter(a=>a.type==="vertex"&&a.manipulator.selected);t.length===1?this._updateTranslateVertexTooltip(t[0].manipulator,i,e):this._updateTranslateGraphicTooltip(i,e)}_updateTranslateGraphicTooltip(i,e){const t=this._tooltipOptions;if(!t.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case D.XY:this._tooltip.info=new Ci({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(s,n)=>dt(s,n,a));break;case D.XY_AXIS:this._tooltip.info=new Ys({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(s,n)=>{const r=dt(s,n,a);return xa(r,Ia(e))});break;case D.Z:this._tooltip.info=new Ua({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,wa)}}_updateTranslateVertexTooltip(i,e,t){const a=this._tooltipOptions;if(!a.enabled)return;let s;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case D.XY:s=new _h({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,(o,l)=>dt(o,l,n)),this._updateTooltipAreaOrTotalLength(s);break;case D.XY_AXIS:s=new uh({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,(o,l)=>{const c=dt(o,l,n);return xa(c,Ia(t))}),this._updateTooltipAreaOrTotalLength(s);break;case D.Z:s=new ph({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,wa)}const r=jl(i.elevationAlignedLocation);h(r)&&(s.elevation={mode:"absolute-height",...r}),this._tooltip.info=s}_updateTranslateTooltipDistance(i,e,t){if(h(e)&&e.action!=="end"){const{mapStart:a,mapEnd:s}=e,n=t(a,s);i.distance=h(n)?n:Ti}}_updateTooltipAreaOrTotalLength(i){const{geometry:e}=this.graphic;if(m(e))return;const t=this._graphicState.isDraped?"on-the-ground":"absolute-height";i.area=e.type==="polygon"?Wc(e,t):null,i.totalLength=e.type==="polyline"?Hl(e,t):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function br(i,e){return Math.atan2(e[1]-i[1],e[0]-i[0])+Math.PI/2}function Mp(i,e,t,a,s){if(i){const n=s.toXYZ(s.pointToVector(t)),r=Uc(a,n,w.get()),o=Ul(r,n,s.spatialReference);if(h(o))return Di(o.value*Math.sign(e),o.unit)}return Di(e*bs(t.spatialReference),"meters")}d([_()],q.prototype,"_editGeometryOperations",void 0),d([_()],q.prototype,"_segmentLabels",void 0),d([_({constructOnly:!0})],q.prototype,"tool",void 0),d([_()],q.prototype,"_tooltip",void 0),d([_()],q.prototype,"inputGeometry",null),d([_()],q.prototype,"outputGeometry",void 0),d([_({readOnly:!0})],q.prototype,"updating",null),d([_()],q.prototype,"manipulators",null),d([_()],q.prototype,"view",null),d([_()],q.prototype,"graphic",null),d([_()],q.prototype,"enableZShape",null),d([_()],q.prototype,"enableZVertex",null),d([_()],q.prototype,"enableMoveGraphic",null),d([_()],q.prototype,"enableMidpoints",null),d([_()],q.prototype,"enableEdgeOffset",null),d([_()],q.prototype,"_labelOptions",null),d([_()],q.prototype,"_tooltipOptions",null),q=d([K("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],q);const yi=jt(0,0,void 0,El.WGS84),ra=M(),hs=1e-6;var Le,k,Kt;(function(i){i.Vertex=ie.Custom1,i.Edge=ie.Custom2})(Le||(Le={})),function(i){i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.RESHAPING=2]="RESHAPING"}(k||(k={})),function(i){i[i.ALL=0]="ALL",i[i.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Kt||(Kt={}));let ne=class extends at.EventedMixin(Ha){constructor(i){super(i),this._handles=new li,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Xr,this.tooltipOptions=new wt,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const i=this._reshapeOperation=new q({tool:this});this.addHandles([i.on("reshape",e=>{e.type==="reshape"&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),i.on("move",e=>{e.type==="move"&&this._onReshapeGeometryChanged(),this.emit("move",e)}),i.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),i.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),i.on("immediate-click",e=>this.emit("immediate-click",e)),this.view.on("pointer-down",["Shift"],e=>e.stopPropagation()),I(()=>this.graphic,()=>this._updateGraphic(),zs)]),this.finishToolCreation()}destroy(){this._handles=Y(this._handles),this._reshapeOperation=Y(this._reshapeOperation)}get updating(){var i,e;return(e=(i=this._reshapeOperation)==null?void 0:i.updating)!=null?e:!1}_updateGeometry(){const i=Rl(this.graphic);this._reshapeOperation.inputGeometry=h(i)?i.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Tl(this.graphic)!==Wr.SUPPORTED)return;const i=I(()=>{var e;return(e=this.graphic)==null?void 0:e.geometry},()=>{this._internalGeometryUpdate===!1&&this._updateGeometry()},Sa);this._handles.add(i,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(i){this._internalGeometryUpdate=!0,this.graphic.geometry=i,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:i}=this._reshapeOperation;!m(this.graphic)&&i&&this._updateGeometryInternally(i.clone())}get canUndo(){var i;return(i=this._reshapeOperation.canUndo)!=null?i:!1}undo(){h(this.snappingManager)&&this.snappingManager.doneSnapping();const i=this._reshapeOperation.undo(),{outputGeometry:e}=this._reshapeOperation;i&&e&&this._updateGeometryInternally(e.clone())}get canRedo(){var i;return(i=this._reshapeOperation.canRedo)!=null?i:!1}redo(){h(this.snappingManager)&&this.snappingManager.doneSnapping();const i=this._reshapeOperation.redo(),{outputGeometry:e}=this._reshapeOperation;i&&e&&this._updateGeometryInternally(e.clone())}onInputEvent(i){i.type!=="key-down"||i.key!=="Delete"&&i.key!=="Backspace"||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};d([_()],ne.prototype,"_reshapeOperation",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"view",void 0),d([_({constructOnly:!0})],ne.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"enableZShape",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"enableZVertex",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"enableMoveGraphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"enableMidpoints",void 0),d([_({constructOnly:!0,nonNullable:!0})],ne.prototype,"enableEdgeOffset",void 0),d([_()],ne.prototype,"type",void 0),d([_({constructOnly:!0,type:Xr})],ne.prototype,"labelOptions",void 0),d([_({constructOnly:!0,type:wt})],ne.prototype,"tooltipOptions",void 0),d([_({constructOnly:!0})],ne.prototype,"snappingManager",void 0),d([_()],ne.prototype,"updating",null),d([_()],ne.prototype,"automaticManipulatorSelection",void 0),ne=d([K("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],ne);let st=class extends Va{constructor(i){super(i),this.type="transform-rotate",this.rotationType="geographic"}};d([_()],st.prototype,"type",void 0),d([_()],st.prototype,"rotation",void 0),d([_()],st.prototype,"rotationPrecision",void 0),d([_()],st.prototype,"orientation",void 0),d([_()],st.prototype,"orientationPrecision",void 0),d([_()],st.prototype,"rotationType",void 0),st=d([K("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],st);let yt=class extends Va{constructor(i){super(i),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};d([_()],yt.prototype,"type",void 0),d([_()],yt.prototype,"scale",void 0),d([_()],yt.prototype,"size",void 0),d([_()],yt.prototype,"sizeUnit",void 0),d([_()],yt.prototype,"sizePrecision",void 0),yt=d([K("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],yt);let Ee=class extends Va{constructor(i){super(i),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};d([_()],Ee.prototype,"type",void 0),d([_()],Ee.prototype,"orientation",void 0),d([_()],Ee.prototype,"orientationEnabled",void 0),d([_()],Ee.prototype,"orientationPrecision",void 0),d([_()],Ee.prototype,"rotationType",void 0),d([_()],Ee.prototype,"size",void 0),d([_()],Ee.prototype,"sizeUnit",void 0),d([_()],Ee.prototype,"sizeEnabled",void 0),d([_()],Ee.prototype,"sizePrecision",void 0),Ee=d([K("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ee);var G,oi;(function(i){i.ScaleIn=ie.Custom2,i.ScaleOut=ie.Custom3,i.RotateLeft=ie.Custom4,i.RotateRight=ie.Custom5,i.Unlocked=ie.Custom7,i.DelayedFocused=ie.Custom8,i.TouchInput=ie.Custom12})(G||(G={}));class Sp{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}constructor({adapter:e,tooltipOptions:t,mode:a,tool:s}){this._mode=null,this._handles=new li,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=tp,this.events=new at,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>h(this._scaleRotateDragData)&&this._scaleRotateDragData.mode==="scale"?this._adapter.scale:1,this.tool=s,this._mode=a,this._adapter=e,this._tooltipOptions=t,this._tooltip=new ji({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(ni(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),Ze))}destroy(){h(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Y(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=Y(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Dl({update:({deltaTime:a})=>{e.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){h(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Y(this._activeAnimation))}forEachManipulator(e){e(this._ringManipulator,z.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,a=je(e,(s,n,r)=>{this._scaleRotateDragData=null;const o=this._adapter.startInteraction(),l={mode:"none",origin:ga(s.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=l,this._updateDragState();const c=w.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(s.renderLocation,c),n.next(Ga(this.tool.view,Ft(s.renderLocation,c,hi()))).next(p=>{const u=Zi(p.plane),g=Oo(p.renderStart,p.renderEnd,l.origin,u),b=Pl.shortestSignedDiff(l.angle,g);l.angleDir=fa(l.angleDir+b,-dr,dr),l.angle=g;const y=wp(l,p),f=y-this._adapter.scale;if(l.scaleDir=fa(l.scaleDir+f,-hr,hr),this._onScaleChanged(),l.mode==="none"){const S=this._mode||xp(p,p.plane,l.origin,this.tool.view.state.camera);if(h(S)){switch(S){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}l.mode=S}}switch(l.mode){case"rotate":o.state.angle=l.initialAngle+g;break;case"scale":o.state.scale=y,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),p.action){case"start":case"update":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Ri(l.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:y,yScale:y})}break;case"end":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Ri(l.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:y,yScale:y})}}return p.action==="end"&&(this.startAnimation(Mr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),o.done()),p}).next(this._updateTooltipPipelineStep(l)),r.next(()=>{if(o.cancel(),h(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Mr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([a,e.events.on("focus-changed",s=>{s.action==="focus"?this.startAnimation(Op(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),e.events.on("immediate-click",s=>{s.stopPropagation()}),I(()=>{var s;return(s=this.tool.graphicState)==null?void 0:s.displaying},s=>this._ringManipulator.available=s,Ze)])}_updateTooltipPipelineStep(e){return t=>{const a=this._tooltipOptions;if(!a.enabled)return t;if(t.action==="end")return this._updateFocusTooltip(),t;const s=this._tooltip,n=this._tooltipOptions.visualVariables,r=h(n)?n.size:null,o=h(n)?n.rotation:null;switch(e.mode){case"scale":s.info=new yt({tooltipOptions:a,scale:{value:this._adapter.scale},size:Di(re(this._adapter.size,-1),"meters"),sizeUnit:h(r)?r.unit:null,sizePrecision:h(r)?la(r.valueType):null});break;case"rotate":{const l=h(o)?la(o.valueType):null,c=h(o)?o.rotationType:"geographic";s.info=new st({tooltipOptions:a,rotation:is(re(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:l,orientation:is(-this._adapter.angle,"radians","geographic"),orientationPrecision:l,rotationType:c})}}return t}}_updateFocusTooltip(){if(!!this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=h(e)?e.rotation:null,a=h(e)?e.size:null;this._tooltip.info=new Ee({tooltipOptions:this._tooltipOptions,orientation:is(-this._adapter.angle,"radians","geographic"),orientationEnabled:this._mode==null||this._mode==="rotate",orientationPrecision:h(t)?la(t.valueType):null,rotationType:h(t)?t.rotationType:"geographic",size:Di(re(this._adapter.size,-1),"meters"),sizeUnit:h(a)?a.unit:null,sizeEnabled:this._mode==null||this._mode==="scale",sizePrecision:h(a)?la(a.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(G.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(G.Unlocked,!(h(this._scaleRotateDragData)&&this._scaleRotateDragData.mode!=="none")),h(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(G.ScaleIn|G.ScaleOut,!1),this._ringManipulator.updateStateEnabled(G.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(G.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(G.RotateLeft|G.RotateRight,!1),this._ringManipulator.updateStateEnabled(G.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(G.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(G.ScaleIn|G.ScaleOut|G.RotateLeft|G.RotateRight,!1)}_updateManipulatorTransform(){const e=Hr(oe.get(),this._adapter.angle,j(0,0,1));if(m(e))return;const t=this.getScale(),a=Ma(oe.get(),X(w.get(),t,t,t));this._ringManipulator.modelTransform=Je(oe.get(),a,e)}_createRingManipulator(){const e=($,ue,ke)=>{const ut=[],_t=Math.ceil(To*(ue-$)/(2*Math.PI));for(let ce=0;ce<_t+1;ce++){const pi=$+ce*(ue-$)/_t;ut.push(j(ke*Math.cos(pi),ke*Math.sin(pi),0))}return ut},t=$=>e(0,2*Math.PI,$),a=$=>[[-$/2,0],[$/2,0],[$/2,ls/2],[-$/2,ls/2]],s=this._createMaterial(1),n=($,ue,ke=s)=>io(ke,a(ue),$,[],[],!1),r=t(Ct),o=n(r,cs),l={left:new Array,right:new Array},c=[];for(let $=0;$<2;$++){const ue=$*Math.PI-Math.PI/4,ke=Math.PI/2-Kd,ut=ue+ke,_t=ue+Math.PI/2-ke,ce=e(ut,_t,qd),pi=n(ce,Xt);c.push(ce),c.push(e(ut,_t,nr-cs/2)),l.left.push(pi),l.right.push(pi.instantiate());for(let es=0;es<2;es++){const Ks=es===0,Me=be();if(Ks){si(Me,Me,[1,-1,1]),gn(Me,Me,-ut,[0,0,1]);const xt=Math.round(or*(ce.length-1));Me[12]=ce[xt][0],Me[13]=ce[xt][1],Me[14]=ce[xt][2]}else{gn(Me,Me,_t,[0,0,1]);const xt=Math.round((1-or)*(ce.length-1));Me[12]=ce[xt][0],Me[13]=ce[xt][1],Me[14]=ce[xt][2]}const en=Ra(s,Qd,0,Jd,ls);to(en,Me),(Ks?l.left:l.right).push(en)}}const p=[];for(let $=0;$<2;$++){const ue=$*Math.PI-Math.PI/4,ke=Math.PI/2-ep,ut=ue+ke,_t=ue+Math.PI/2-ke,ce=e(ut,_t,nr);p.push(n(ce,Xt))}const u=this._createMaterial(.66),g=this._createMaterial(.5),b=this._createMaterial(.33),y=t(Ct+lr),f=t(Ct+cr),S=n(y,Xt,u),x=n(f,Xt,b),C=t(Ct-lr),F=t(Ct-cr),ee=n(C,Xt,u),W=n(F,Xt,b);let V=[new E(o,G.DelayedFocused),new E(o.instantiate({material:g}),O.None)];this._mode&&this._mode!=="scale"||(V=V.concat([...p.map($=>new E($,G.DelayedFocused|G.Unlocked)),new E(S,G.DelayedFocused|G.ScaleIn),new E(x,G.DelayedFocused|G.ScaleIn),new E(ee,G.DelayedFocused|G.ScaleOut),new E(W,G.DelayedFocused|G.ScaleOut)])),this._mode&&this._mode!=="rotate"||(V=V.concat([...l.right.map($=>new E($.instantiate(),G.DelayedFocused|G.Unlocked)),...l.left.map($=>new E($,G.DelayedFocused|G.RotateLeft)),...l.right.map($=>new E($,G.DelayedFocused|G.RotateRight))]));const pe=[r,...c];return new ge({view:this.tool.view,renderObjects:V,autoScaleRenderObjects:!1,worldOriented:!0,radius:cs,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:J(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:pe,direction:j(0,0,1)}})}_createMaterial(e){const t=Ht([...Wd,e]);return new ze({color:t,transparent:e!==1,cullFace:ae.Back,renderOccluded:R.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:e=>this._ringIndicatorDelayMs=e,tooltip:this._tooltip}}}function wp(i,e){const t=N(w.get(),e.renderStart,i.origin),a=N(w.get(),e.renderEnd,i.origin),s=Re(t),n=Re(a);return s===0?0:n/s}function xp(i,e,t,a){const{renderStart:s,renderEnd:n}=i,r=oa(s,a,w.get()),o=oa(n,a,w.get());if(zr(r,o)<rr*rr)return null;const l=N(w.get(),s,t),c=He(w.get(),l,Zi(e)),p=s,u=Z(w.get(),p,c),g=oa(t,a,w.get()),b=r,y=oa(u,a,w.get()),f=N(w.get(),y,b),S=N(w.get(),r,g),x=Ms(b,f),C=Ms(g,S);return bn(x,o)<bn(C,o)?"rotate":"scale"}function oa(i,e,t){return e.projectToScreen(i,ds),X(t,ds[0],ds[1],0)}function Mr(i,e){let t=null,a=1;const s=()=>a;return{start:()=>{a=i.getScale(),t=i.getScale,i.getScale=s,e()},update:n=>(a+=((a+1)/2-a)*Math.min(n*ip,1),e(),Math.abs(a-1)<.01?oi.STOP:oi.CONTINUE),destroy:()=>{t&&(i.getScale=t),e()}}}function Op(i,e,t){let a=0,s=null;const n=()=>!1;return{start:()=>{s=i.getFocused,i.getFocused=n,a=0,e()},update:r=>(a+=r,!(s!=null&&s())||a>=t.delayMs?oi.STOP:oi.CONTINUE),destroy:()=>{s&&(i.getFocused=s),e()}}}function la(i){switch(i){case"integer":case"long":return 0;default:return null}}(function(i){i[i.CONTINUE=0]="CONTINUE",i[i.STOP=1]="STOP"})(oi||(oi={}));const ds=et();function Vo(i){return h(i.geometry)&&i.geometry.type==="mesh"?Ep(i.geometry):Ap(i)}function Ep(i){return h(i.transform)?Rp(i,i.transform):Tp(i)}function Ap(i){let e=i.geometry,t=$l;return{undo(a){t=a.geometry,a.geometry=e},redo(a){e=a.geometry,a.geometry=t}}}function Rp(i,e){let t=e.clone(),a=null;return{undo:s=>{a=h(i.transform)?i.transform.clone():null,i.transform=t,s.notifyGeometryChanged()},redo:s=>{t=h(i.transform)?i.transform.clone():null,i.transform=a,s.notifyGeometryChanged()}}}function Tp(i){let e,t=i.vertexAttributes.clonePositional();return{undo:a=>{e=i.vertexAttributes.clonePositional(),i.vertexAttributes=t,a.notifyGeometryChanged()},redo:a=>{t=i.vertexAttributes.clonePositional(),i.vertexAttributes=e,a.notifyGeometryChanged()}}}let nt=class extends Fs{constructor(i){super(i),this._interactionState=null}initialize(){this.addHandles([ni(()=>h(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null,({interactionState:i})=>{this._updateMeshRotation(i)},Sa),ni(()=>h(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null,({interactionState:i})=>{this._updateMeshSize(i)},Sa)])}get angle(){const i=this.geometry.transform;if(m(i))return 0;const e=gh(i.rotation)[2];return Math.abs(e)>.999999?pt(mh(i.rotation))*Math.sign(e):0}get scale(){return h(this._interactionState)?this._interactionState.scale:1}startInteraction(){const i=new rt({angle:this.angle});this._interactionState=i;const e=()=>{this._interactionState=null};return{state:i,done:e,cancel:()=>{i.cancel(),e()}}}createUndoRecord(){return Vo(this.graphic)}_updateMeshRotation(i){const e=this.geometry.anchor,t=this.viewingMode===Ei.Global,{angle:a,previousAngle:s}=i;this.geometry.rotate(0,0,Ri(a-s),{origin:e,geographic:t}),i.previousAngle=a,h(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(i){const e=this.geometry.anchor,t=this.viewingMode===Ei.Global,{scale:a,previousScale:s}=i;this.geometry.scale(a/s,{origin:e,geographic:t}),i.previousScale=a,h(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};d([_({constructOnly:!0})],nt.prototype,"graphic",void 0),d([_({constructOnly:!0})],nt.prototype,"geometry",void 0),d([_({constructOnly:!0})],nt.prototype,"viewingMode",void 0),d([_()],nt.prototype,"angle",null),d([_()],nt.prototype,"scale",null),d([_()],nt.prototype,"_interactionState",void 0),nt=d([K("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],nt);let rt=class extends Fi{get state(){const{angle:i,scale:e}=this;return{angle:i,scale:e}}constructor(i){super(i),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=i.angle,this.previousAngle=i.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};d([_()],rt.prototype,"angle",void 0),d([_()],rt.prototype,"initialAngle",void 0),d([_()],rt.prototype,"previousAngle",void 0),d([_()],rt.prototype,"previousScale",void 0),d([_()],rt.prototype,"scale",void 0),d([_()],rt.prototype,"state",null),rt=d([K("InteractionState")],rt);let he=class extends Fs{constructor(i){super(i),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(ni(()=>h(this._interactionState)?this._interactionState.state:null,i=>{this._updateSymbol(i)},Sa))}get angle(){var i;return h(this._interactionState)?this._interactionState.angle:h(this._orientationReferenceSymbolLayer)?Dp((i=this._orientationReferenceSymbolLayer.heading)!=null?i:0):0}get scale(){return h(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return h(this._interactionState)?this._interactionState.initialAngle:0}get size(){const i=this._sizeReferenceSymbolLayer;if(m(i))return null;const e=this.findLayerView(),t=this._graphicSymbol;if(m(e)||m(t)||t.type!=="point-3d")return null;const a=e.getSymbolLayerSize(t,i);if("size"in a&&h(a.size))return a.size;const s=this.sizeAxis;return"width"in a&&h(a.width)&&(m(s)||s==="width"||s==="all"||s==="width-and-depth")?a.width:"depth"in a&&h(i.depth)&&(m(s)||s==="depth"||s==="all"||s==="width-and-depth")?a.depth:"height"in a&&h(i.height)&&(m(s)||s==="height"||s==="all")?a.height:null}get _sizeReferenceSymbolLayer(){const i=this._graphicSymbol;return m(i)||i.symbolLayers.length===0?null:i.symbolLayers.find(e=>e.type==="object")}get _orientationReferenceSymbolLayer(){const i=this._graphicSymbol;return m(i)||i.symbolLayers.length===0?null:i.symbolLayers.find(e=>e.type==="object"&&h(e.heading))}get _graphicSymbol(){return h(this.graphic)&&h(this.graphic.symbol)&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(i){this.graphic.symbol=i}startInteraction(){const i=this._graphicSymbol,e=this.findLayerView();if(h(this._interactionState)||m(i)||m(e))return Pp;const t=i.symbolLayers.map(o=>o.type==="object"?e.getSymbolLayerSize(i,o):null).toArray(),a=i.clone(),s=this.angle,n=new ot({originalSymbol:a,angle:s,initialSizes:t});this._interactionState=n;const r=()=>{this._interactionState=null};return{state:n,done:r,cancel:()=>{this._graphicSymbol=a,r()}}}createUndoRecord(){let i=this.graphic.symbol,e=null;return{undo:t=>{e=t.symbol,t.symbol=i},redo:t=>{i=t.symbol,t.symbol=e}}}_updateSymbol({scale:i,angle:e,originalSymbol:t,initialSizes:a}){const s=this._graphicSymbol;if(m(s)||s.type!=="point-3d")return;const n=s.clone(),r=-Ri(e-this.initialAngle);let o=!1;this._forEachObjectSymbolLayerPair(t,n,(l,c,p)=>{const u=re(l.heading,0)+r;c.heading!==u&&(c.heading=u,o=!0);const g=a[p];if(h(g)&&"width"in g){g.width=this.sizeFilter(g.width),g.height=this.sizeFilter(g.height),g.depth=this.sizeFilter(g.depth);const b=g.width*i;c.width!==b&&(c.width=b,o=!0);const y=g.depth*i;c.depth!==y&&(c.depth=y,o=!0);const f=g.height*i;c.height!==f&&(c.height=f,o=!0)}}),o&&(this._graphicSymbol=n)}_forEachObjectSymbolLayerPair(i,e,t){i.symbolLayers.forEach((a,s)=>{const n=e.symbolLayers.getItemAt(s);a.type==="object"&&n.type==="object"&&t(a,n,s)})}};function Dp(i){return-pt(i)}d([_()],he.prototype,"angle",null),d([_()],he.prototype,"scale",null),d([_()],he.prototype,"relativeAngle",null),d([_()],he.prototype,"initialAngle",null),d([_()],he.prototype,"size",null),d([_()],he.prototype,"sizeAxis",void 0),d([_({constructOnly:!0})],he.prototype,"graphic",void 0),d([_()],he.prototype,"_interactionState",void 0),d([_({constructOnly:!0})],he.prototype,"findLayerView",void 0),d([_({constructOnly:!0})],he.prototype,"sizeFilter",void 0),d([_()],he.prototype,"_sizeReferenceSymbolLayer",null),d([_()],he.prototype,"_orientationReferenceSymbolLayer",null),d([_()],he.prototype,"_graphicSymbol",null),he=d([K("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],he);const Pp={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let ot=class extends Fi{get state(){const{originalSymbol:i,angle:e,initialAngle:t,scale:a,initialSizes:s}=this;return{originalSymbol:i,angle:e,initialAngle:t,scale:a,initialSizes:s}}constructor(i){super(i),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=i.angle}};d([_()],ot.prototype,"originalSymbol",void 0),d([_()],ot.prototype,"angle",void 0),d([_()],ot.prototype,"initialAngle",void 0),d([_()],ot.prototype,"initialSizes",void 0),d([_()],ot.prototype,"scale",void 0),d([_()],ot.prototype,"state",null),ot=d([K("InteractionState")],ot);let me=class extends Br(at.EventedMixin(Ha)){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new wt,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:i,view:e}=this;this.graphicState=new Ut({graphic:i}),this.addHandles(I(()=>this.tooltipOptions.enabled,n=>{this._tooltip=n?new ji({view:e}):Y(this._tooltip)},zs)),this._moveManipulation=new zt({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Vt(i),radius:zt.radiusForSymbol(i.symbol)}),this._moveManipulation.forEachManipulator(n=>this.handles.add(n.events.on("immediate-click",r=>{this.emit("immediate-click",{...r,graphic:i}),r.stopPropagation()})));const t=n=>r=>{this.handles.add(r.events.on("focus-changed",({action:o})=>{const l=this._tooltip;m(l)||(o==="focus"?this._updateMoveTooltip(n):l.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(t(D.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(t(D.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(t(D.Z));const a=J(i);this._moveManipulation.elevationInfo=a;const s=i.geometry;if(this._moveManipulation.createGraphicDragPipeline((n,r,o,l,c)=>{if(h(s)&&n===D.XY){const{snappingStep:p,cancelSnapping:u}=Pa({snappingContext:new Da({elevationInfo:a,pointer:c,editGeometryOperations:ja.fromGeometry(new ei({spatialReference:s.spatialReference}),e.state.viewingMode),visualizer:new Gi,excludeFeature:i}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});l=l.next(u),o=o.next(nh(this.view,a)).next(...p)}return{steps:o=o.next(p=>(this._updateMoveTooltip(n,p),p)),cancel:l}},this.graphicState,n=>{const{action:r,graphic:o,dxScreen:l,dyScreen:c}=n,p={graphic:o,dxScreen:l,dyScreen:c};switch(r){case"start":this.emit("graphic-translate-start",p),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",p);break;case"end":this.emit("graphic-translate-stop",p)}}),this._moveManipulation.angle=h(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(I(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const n=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Sp({tool:this,mode:n,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.handles.add([qa({view:this.view,graphic:this.graphic,forEachManipulator:n=>this._forEachManipulator(n),onManipulatorsChanged:()=>It()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),I(()=>e.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(n=>{n instanceof ge&&this.handles.add(n.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=Y(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=Y(this._scaleRotate),this._scaleRotateAdapter=Y(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){m(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return h(this.graphic.geometry)&&this.graphic.geometry.type==="mesh"?new nt({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new he({graphic:this.graphic,sizeFilter:i=>this._enforceNonZeroSize(i),findLayerView:()=>this.view.allLayerViews.find(i=>i.layer===this.graphic.layer),sizeAxis:h(this.tooltipOptions.visualVariables)&&h(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(i){this._moveManipulation.forEachManipulator(i),h(this._scaleRotate)&&this._scaleRotate.forEachManipulator(i)}_hideManipulatorsForGraphicState(){return I(()=>this.graphicState.displaying,i=>{this._forEachManipulator(e=>e.available=i),this._moveManipulation.zManipulation.available=i&&this.enableZ&&Vt(this.graphic)})}_createGeometryUndoRecord(){return Vo(this.graphic)}set snapToScene(i){this._moveManipulation&&(this._moveManipulation.snapToScene=i),this._set("snapToScene",i)}get updating(){return this.updatingHandles.updating}set location(i){this._moveManipulation.location=i,h(this._scaleRotate)&&(this._scaleRotate.location=i)}set elevationAlignedLocation(i){this._moveManipulation.elevationAlignedLocation=i,h(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=i)}reset(){}onHide(){h(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(m(this._scaleRotate))return;const i=this._scaleRotate.getScale();this._moveManipulation.displayScale=i}_updateMoveAngle(){this.view.state.viewingMode===Ei.Local||this.view.scale<ap?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){Ao(this.view,this,this.graphic)}_enforceNonZeroSize(i){return i||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(i,e){const{tooltipOptions:t,_tooltip:a}=this;if(m(a))return;a.clear();const s=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case D.XY:a.info=new Ci({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(n,r)=>dt(n,r,s));break;case D.XY_AXIS:a.info=new Ys({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(n,r)=>{const o=dt(n,r,s);return xa(o,Ia(e))});break;case D.Z:a.info=new Ua({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,wa)}}_updateMoveTooltipDistance(i,e,t){if(h(e)&&e.action!=="end"){const{mapStart:a,mapEnd:s}=e,n=t(a,s);i.distance=h(n)?n:Ti}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:h(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:i=>h(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(i):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],me.prototype,"view",void 0),d([_({constructOnly:!0,nonNullable:!0})],me.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],me.prototype,"enableZ",void 0),d([_()],me.prototype,"enableRotation",void 0),d([_()],me.prototype,"enableScaling",void 0),d([_({constructOnly:!0,type:wt})],me.prototype,"tooltipOptions",void 0),d([_()],me.prototype,"graphicState",void 0),d([_({value:!1})],me.prototype,"snapToScene",null),d([_({constructOnly:!0})],me.prototype,"snappingManager",void 0),d([_({readOnly:!0})],me.prototype,"type",void 0),d([_({readOnly:!0})],me.prototype,"updating",null),me=d([K("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],me);let vt=class extends Cl(Gl){constructor(i){super(i),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(i){return this.heading===i.heading&&this.tilt===i.tilt&&Ll(this.position,i.position)&&this.width===i.width&&this.height===i.height}};d([_({readOnly:!0,json:{read:!1,write:!0}})],vt.prototype,"type",void 0),d([_({type:ei}),_i()],vt.prototype,"position",void 0),d([_({type:Number,nonNullable:!0,range:{min:0,max:360}}),_i(),mn(i=>fn.normalize(vn(i),0,!0))],vt.prototype,"heading",void 0),d([_({type:Number,nonNullable:!0,range:{min:0,max:360}}),_i(),mn(i=>fn.normalize(vn(i),0,!0))],vt.prototype,"tilt",void 0),d([_({type:Number,nonNullable:!0}),_i()],vt.prototype,"width",void 0),d([_({type:Number,nonNullable:!0}),_i()],vt.prototype,"height",void 0),vt=d([K("esri.analysis.SlicePlane")],vt);kr("mac");const $p=2,Cp=1.15,Lp=1.15,Gp=.7,Qi=j(1,.5,0);Ht([...Qi,Gp]);Ht([...Qi,.5]);const Ip=Te(1,1,1,1),Vp=Te(1,.8,.6,1),zp=Te(1,.93,.86,1),Fp=Ht([...Qi,1]),Np=Ht([...Qi,1]),jp=3,zo=11,$s=22.5,ps=40,Sr=48,Hp=2.25,Up=Ht([...Qi,1]),kp=4,wr=1,Bp=.3,Wp=6,Yp=4;function Xp(i){const e=new Ui;e.extensions.add("GL_OES_standard_derivatives");const{vertex:t,fragment:a,attributes:s,varyings:n}=e;return ks(t,i),s.add(A.POSITION,"vec3"),s.add(A.UV0,"vec2"),n.add("vUV","vec2"),t.code.add(T`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add([new Mt("backgroundColor",r=>r.backgroundColor),new Mt("gridColor",r=>r.gridColor),new de("gridWidth",r=>r.gridWidth)]),a.code.add(T`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const Zp=Object.freeze(Object.defineProperty({__proto__:null,build:Xp},Symbol.toStringTag,{value:"Module"}));class Js extends ki{initializeProgram(e){return new Bi(e.rctx,Js.shader.get().build(this.configuration),Us)}initializePipeline(){return Yi({blending:Nc(qe.ONE,qe.ONE,qe.ONE_MINUS_SRC_ALPHA,qe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ha.LESS},colorWrite:Xi})}}Js.shader=new Wi(Zp,()=>Ni(()=>import("./SlicePlaneMaterial.glsl.43b93177.js"),["assets/SlicePlaneMaterial.glsl.43b93177.js","assets/VertexColor.glsl.e3d82815.js","assets/index.3255d2a5.js","assets/index.e51050de.css","assets/requestImageUtils.828b299e.js","assets/OrderIndependentTransparency.43c6e481.js","assets/enums.3c1fa5b5.js","assets/basicInterfaces.f8f3b23b.js","assets/Texture.d66dc1cb.js","assets/VertexArrayObject.ad007c8f.js","assets/Util.3efb1a6b.js","assets/mat4f64.9070f685.js","assets/triangle.1c8f4155.js","assets/sphere.67ec4acb.js","assets/mat3f64.9180efcb.js","assets/quatf64.1dc83f1c.js","assets/lineSegment.1a0fd96e.js","assets/Indices.27b9c798.js","assets/VertexAttribute.34e3daf1.js","assets/doublePrecisionUtils.d6c628ce.js","assets/quat.eb7bbc3a.js","assets/vec3f32.4d8dc001.js","assets/BufferView.32a50625.js","assets/VertexElementDescriptor.5da9dfe9.js","assets/automaticLengthMeasurementUtils.06e82903.js","assets/spatialReferenceEllipsoidUtils.7f3e3256.js","assets/vec4f32.c3d64d30.js","assets/Octree.449e609a.js","assets/plane.a0a08b54.js","assets/NativeLineMaterial.6f545af4.js","assets/Attribute.98e6fe67.js","assets/triangulationUtils.2ec0b7a6.js","assets/earcut.a219bf29.js","assets/deduplicate.97d7ef01.js","assets/hydratedFeatures.b4cbc12d.js","assets/InterleavedLayout.a42ad5fa.js","assets/types.bf551170.js","assets/NestedMap.2ac03b78.js","assets/floatRGBA.7b501bd7.js","assets/boundedPlane.91a64206.js","assets/glUtil.9de5d1d0.js","assets/SnappingContext.023005d4.js","assets/PointSnappingHint.08747e02.js","assets/editPlaneUtils.dd1c9a66.js","assets/GraphicManipulator.5182c2a7.js","assets/TranslateTooltipInfos.33287c88.js","assets/axisAngleDegrees.fa497b47.js","assets/persistable.bfebf5ba.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.8c0303d1.js","assets/ExtentTooltipInfos.e2302c0a.js"]));function qp(i,e){return Eo(i.basis1,i.basis2,i.origin,e)}function Qp(i,e,t,a){const s=e.worldUpAtPosition(i.origin,w.get()),n=w.get();switch(t){case Vi.HEADING:U(n,s);break;case Vi.TILT:U(n,i.basis1)}return Ft(i.origin,n,a)}function Jp(i,e,t,a){const s=Re(a.basis1),n=Re(a.basis2),r=Fo(a),o=Cs(a),l=X(w.get(),0,0,0);Z(l,_e(w.get(),a.basis1,e.direction[0]),_e(w.get(),a.basis2,e.direction[1])),Z(l,a.origin,l);let c=0,p=1;if(Ka(e))e.direction[0]===1&&e.direction[1]===-1?c=Gs:e.direction[0]===1&&e.direction[1]===1?c=Math.PI:e.direction[0]===-1&&e.direction[1]===1&&(c=3*Math.PI/2),p=o;else{const g=e.direction[0]!==0?1:2;c=g===1?Gs:0,p=(g===1?n:s)-r}const u=Vs(oe.get(),c);si(u,u,X(w.get(),p,p,p)),Je(u,t,u),u[12]=0,u[13]=0,u[14]=0,i.modelTransform=u,i.renderLocation=l}function Kp(i,e,t,a){const s=a.worldUpAtPosition(t.origin,w.get()),n=eu(t,Gt.POSITIVE_X),r=Vs(oe.get(),n.edge*Math.PI/2);Ur(r,r,-ru(t,s)),Je(r,e,r),r[12]=0,r[13]=0,r[14]=0,i.modelTransform=r,i.renderLocation=n.position}var Gt;function eu(i,e){switch(e){case Gt.POSITIVE_X:return{basis:i.basis1,direction:1,position:Z(w.get(),i.origin,i.basis1),edge:e};case Gt.POSITIVE_Y:return{basis:i.basis2,direction:1,position:Z(w.get(),i.origin,i.basis2),edge:e};case Gt.NEGATIVE_X:return{basis:i.basis1,direction:-1,position:N(w.get(),i.origin,i.basis1),edge:e};case Gt.NEGATIVE_Y:return{basis:i.basis2,direction:-1,position:N(w.get(),i.origin,i.basis2),edge:e}}}function Fo(i){const e=Re(i.basis1),t=Re(i.basis2);return Bp*Math.min(e,t)}function Cs(i){return Fo(i)}function Ka(i){return i.direction[0]!==0&&i.direction[1]!==0}function tu(i,e=zi.CENTER_ON_ARROW){const t=e===zi.CENTER_ON_CALLOUT?ps:0,a=[j(t,0,-Sr/2),j(t,0,Sr/2)],s=nu(a,!0),n=(u,g)=>au(a,u,g),r=n(0,!1),o=n(Hp,!0),l=new Hs({color:Fp,renderOccluded:R.OccludeAndTransparent}),c=Ne(l,[[t,0,0],[t-ps,0,0]]),p=Ne(l,[[t,0,0],[t-ps,0,0]]);return new ge({view:i,renderObjects:[...r.normal.map(u=>new E(u,O.Unfocused|Tt)),...o.normal.map(u=>new E(u,O.Unfocused|Tt)),new E(c,O.Unfocused|Tt|Ls),...r.focused.map(u=>new E(u,O.Focused|Tt)),...o.focused.map(u=>new E(u,O.Focused|Tt)),new E(p,O.Focused|Tt|Ls)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[s]},collisionPriority:1,radius:zo,state:Tt})}function iu(i,e){const t=Ka(e),a=t?[j(1,0,0),j(0,0,0),j(0,1,0)]:[j(1,0,0),j(-1,0,0)],s=Up,n=b=>new tt({color:s,width:b,renderOccluded:R.OccludeAndTransparent}),r=()=>new Hs({color:s,renderOccluded:R.OccludeAndTransparent}),o=t?kp:wr,l=o*$p,c=wr,p=b=>b>1?n(b):r(),u=[new E(Ne(p(o),a),O.Unfocused|da),new E(Ne(p(l),a),O.Focused|da),new E(Ne(p(c),a),No)],g=new ge({view:i,renderObjects:u,collisionType:{type:"line",paths:[a]},radius:t?Wp:Yp,...$d});return g.state=da,g}function au(i,e,t){const a=new ze({color:Ip,cullFace:ae.Back,renderOccluded:R.Opaque}),s=new ze({color:Vp,cullFace:ae.Back,renderOccluded:R.Opaque}),n=new ze({color:zp,cullFace:ae.Back,renderOccluded:R.Opaque}),r=new ze({color:Np,transparent:!0,writeDepth:!1,cullFace:ae.Front,renderOccluded:R.Transparent}),o=l=>{i=i.slice(0);const c=N(w.get(),i[0],i[1]);le(c,c);const p=N(w.get(),i[i.length-1],i[i.length-2]);if(le(p,p),e>0){const pe=_e(M(),p,-e);i[i.length-1]=Z(pe,pe,i[i.length-1]);const $=_e(M(),c,-e);i[0]=Z($,$,i[0])}const u=l?Lp:1,g=$s*u,b=zo*u,y=ys(oe.get());if(e>0){const pe=g/4,$=X(w.get(),0,pe,0),ue=1+e/pe;ua(y,y,$),si(y,y,X(w.get(),ue,ue,ue)),ua(y,y,_e($,$,-1/ue))}const f=ys(be()),S=j(0,1,0),x=yn(be(),Cn(Mn.get(),S,p));x[12]=i[i.length-1][0],x[13]=i[i.length-1][1],x[14]=i[i.length-1][2],Je(x,x,y);const C=su(jp*(l?Cp:1)+e,i,t?r:n);C.transformation=f;const F=[C],ee=xs(t?r:a,g,b,24,!1,!1,!0);ee.transformation=x,F.push(ee);const W=xs(t?r:s,g,b,24,!1,!0,!1);W.transformation=x,F.push(W);const V=yn(be(),Cn(Mn.get(),S,c));return V[12]=i[0][0],V[13]=i[0][1],V[14]=i[0][2],Je(V,V,y),F.push(ee.instantiate({transformation:V})),F.push(W.instantiate({transformation:V})),F};return{normal:o(!1),focused:o(!0)}}function su(i,e,t){const a=[];for(let n=0;n<12;n++){const r=n/12*2*Math.PI;a.push([Math.cos(r)*i,Math.sin(r)*i])}return io(t,a,e,[],[],!1)}function nu(i,e){const t=N(M(),i[i.length-1],i[i.length-2]);if(le(t,t),_e(t,t,$s),Z(t,t,i[i.length-1]),e){const a=N(M(),i[0],i[1]);return le(a,a),_e(a,a,$s),Z(a,a,i[0]),[a,...i,t]}return[...i,t]}function ru(i,e){return ql(e,i.basis2,i.basis1)+Gs}(function(i){i[i.POSITIVE_X=0]="POSITIVE_X",i[i.POSITIVE_Y=1]="POSITIVE_Y",i[i.NEGATIVE_X=2]="NEGATIVE_X",i[i.NEGATIVE_Y=3]="NEGATIVE_Y"})(Gt||(Gt={}));const Tt=ie.Custom1;var Vi,xr;(function(i){i[i.HEADING=1]="HEADING",i[i.TILT=2]="TILT"})(Vi||(Vi={})),function(i){i[i.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",i[i.HORIZONTAL=1]="HORIZONTAL",i[i.VERTICAL=2]="VERTICAL",i[i.TILTED=3]="TILTED"}(xr||(xr={}));const Ls=ie.Custom2;Hi();const Gs=Math.PI/2,da=ie.Custom1,No=ie.Custom2;var zi;(function(i){i[i.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",i[i.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(zi||(zi={}));const Or="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",ou={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function lu(i){return i.fromData(Or,()=>new ao(Or,ou))}class cu{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&h(this._lastDragEvent)&&h(this._next)){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Ws;return this._next=e,[t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),e]}_adjustScaleFactors(e){const t=Ka(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}let fe=class extends at.EventedMixin(Ha){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new wt,this._preserveAspectRatio=new cu,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new li,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=ea(),this._mapBoundsStart=ea(),this._zmax=0,this._sizeStart=null,this._displayBounds=ea(),this._displayBoundsStart=ea(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=Qe(),this._endScale=Qe()}initialize(){const{view:i,graphic:e,manipulators:t,_handles:a}=this,s=this._graphicState=new Ut({graphic:e}),n=e.geometry;this._editGeometryOperations=ja.fromGeometry(n,i.state.viewingMode),this._graphicMoveManipulation=new Qs({tool:this,view:i,graphicState:s}),this._moveZManipulator=tu(i,zi.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Ls,a.add([this._createMoveXYGraphicDragPipeline(),I(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,z.TRANSLATE_Z)),this._createMoveZDragPipeline()]),t.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(p=>{const u=iu(i,p);return a.add([I(()=>this.enableScaling,()=>this._updateManipulatorAvailability(u,z.SCALE)),u.events.on("grab-changed",g=>this._onResizeGrab(g)),this._createResizeDragPipeline(u,p)]),u}),t.addMany(this._resizeManipulators),this._rotateManipulatorTexture=lu(i.toolViewManager.textures),this._rotateManipulator=Dd(i,{texture:this._rotateManipulatorTexture.texture}),a.add([I(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,z.ROTATE)),this._rotateManipulator.events.on("grab-changed",p=>{this._onRotateGrab(p)}),this._createRotateDragPipeline(this._rotateManipulator)]),t.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const r=qa({view:i,graphic:e,forEachManipulator:p=>this._forEachManipulator(p),onManipulatorsChanged:()=>It()});h(r)&&(this._outlineVisualElement=r.visualElement instanceof Nt?r.visualElement:null),h(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),a.add(r),a.add([s.on("changed",()=>this._onGeometryChanged()),I(()=>s.displaying,()=>this._updateAllManipulatorAvailability()),I(()=>s.isDraped,()=>this._graphicDrapedChanged(),Ze),i.trackGraphicState(s)]);const o=i.pointsOfInterest;a.add(I(()=>o==null?void 0:o.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds()));const l=p=>{a.add(p.events.on("grab-changed",()=>{this.grabbing=p.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(l);const c=(p,u)=>{a.add(p.events.on("immediate-click",g=>{u===z.TRANSLATE_XY&&this.emit("immediate-click",{...g,graphic:e}),g.stopPropagation()}))};this._forEachManipulator(c),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:i,view:e}=this,t=this._tooltip=new ji({view:e}),a=()=>{t.info=this._getUpdatedTooltipInfo()};i.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",s=>{this._startAngle=s.angle,a()}),this.on("graphic-rotate",s=>{this._endAngle=s.angle,a()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,a()}),this.on("graphic-scale-start",s=>{Ie(this._startScale,s.xScale,s.yScale),Ie(this._endScale,s.xScale,s.yScale),a()}),this.on("graphic-scale",s=>{Ie(this._endScale,s.xScale,s.yScale),a()}),this.on("graphic-scale-stop",()=>{Ie(this._startScale,0,0),Ie(this._endScale,0,0),a()})]),this._forEachManipulator(s=>{i.add([s.events.on("focus-changed",a),s.events.on("grab-changed",a),s.events.on("drag",n=>{n.action==="cancel"?this._tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(i=>i.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=re(this._moveXYTooltipInfo,()=>new Ci({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const i=this._moveZTooltipInfo=re(this._moveZTooltipInfo,()=>new Ua({tooltipOptions:this.tooltipOptions})),e=this._moveUnit;if(this._moveZManipulator.dragging){const t=this._mapBoundsStart.origin,a=this._mapBounds.origin,s=kl(t,a,this.view.spatialReference);if(m(s))return null;i.distance=s}else i.distance=Di(0,e);return i}_computeRotateTooltipInfo(){const i=this._rotateTooltipInfo=re(this._rotateTooltipInfo,()=>new fh({tooltipOptions:this.tooltipOptions}));return i.angle=this._startAngle-this._endAngle,i}_computeScaleTooltipInfo(){const i=this.graphic.geometry;if(m(i))return null;const e=this._scaleTooltipInfo=re(this._scaleTooltipInfo,()=>new vh({tooltipOptions:this.tooltipOptions})),t=Dn(this._mapBounds,this._zmax,i.spatialReference,this._graphicState.isDraped);return m(t)?null:(e.xSize=t[0],e.ySize=t[1],h(this._sizeStart)&&this._resizeManipulators.some(a=>a.dragging)?(e.xScale=t[0].value/this._sizeStart[0].value,e.yScale=t[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(Er),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",i=>{h(this._attachmentOrigin)&&Nr(i.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),Er)}_updateAllManipulatorAvailability(){this._forEachManipulator((i,e)=>this._updateManipulatorAvailability(i,e))}_updateManipulatorAvailability(i,e){const t=this.grabbing&&!i.grabbing;if(i.interactive=!t,i instanceof ge){const a=this._graphicState.displaying,s=this.enableZ&&Vt(this.graphic);switch(e){case z.ROTATE:i.available=a&&this.enableRotation;break;case z.SCALE:i.available=a&&(this.enableScaling||this.enableRotation||s),i.interactive=!t&&this.enableScaling,i.state=this.enableScaling?da:No;break;case z.TRANSLATE_Z:i.available=a&&s;break;default:i.available=a}}}_forEachManipulator(i){this._graphicMoveManipulation.forEachManipulator(i),this._resizeManipulators.forEach(e=>i(e,z.SCALE)),i(this._rotateManipulator,z.ROTATE),i(this._moveZManipulator,z.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(i){this._preserveAspectRatio.enabled=i,this._set("preserveAspectRatio",i)}get _moveUnit(){return re(Il(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const i=this.graphic.geometry,e=this._editGeometryOperations.data,t=e.components[0].edges[0],a=Cr(Ss.get(),t.leftVertex.pos,t.rightVertex.pos);pa(a,a);const s=re(La(this.view,this.graphic),()=>{var l;return(l=i.extent)==null?void 0:l.center});let n=s?du*this.view.pixelSizeAt(s):0;const r=this.view.spatialReference,o=i.spatialReference;r.equals(o)||(n*=bs(r)/bs(o)),rh(a,e,n,this._mapBounds),this._updateZMax()}_updateZMax(){var a;const i=this._editGeometryOperations.data;if(!i.geometry.hasZ)return void(this._zmax=0);const e=i.coordinateHelper;let t=Number.NEGATIVE_INFINITY;for(const s of i.components)for(const n of s.vertices){const r=(a=e.getZ(n.pos))!=null?a:0;t=Math.max(r,t)}this._zmax=t}_updateDisplayBounds(){const{geometry:i}=this.graphic;if(m(i))return;const{extent:e}=i;if(!e)return;const t=h(this._outlineVisualElement)&&!this._graphicState.isDraped&&h(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:La(this.view,this.graphic);this._attachmentOrigin=re(t,e.center);const a=h(t)?t.z:Na(this._mapBounds.origin,this.view.elevationProvider,ci.fromElevationInfo(J(this.graphic)),this.view.renderCoordsHelper),s=ui(this._mapBounds);s.origin[2]=a!=null?a:0,oh(s,this.view.renderCoordsHelper,i.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){var t;const i=this.view.pointsOfInterest,e=i?i.centerOnSurfaceFrequent.location:(t=this._editGeometryOperations.data.geometry.extent)==null?void 0:t.center;return e?hu*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((i,e,t)=>this._applyGraphicMoveSteps(e,t,D.XY))}_createMoveZDragPipeline(){const i=this.view,e=this._editGeometryOperations.data.spatialReference;return je(this._moveZManipulator,(t,a,s)=>{const n=ga(t.renderLocation),r=a.next(Lo(i,n,e)).next(di());this._applyGraphicMoveSteps(r,s,D.Z)})}_applyGraphicMoveSteps(i,e,t){const a=i.next(s=>(s.action==="start"&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY})),s)).next(Jt()).next(this._moveDragUpdateGeometry()).next(s=>{var r,o;const n={graphic:this.graphic,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY};switch(s.action){case"start":case"update":(s.mapEnd.x-s.mapStart.x||s.mapEnd.y-s.mapStart.y||((r=s.mapEnd.z)!=null?r:0)-((o=s.mapStart.z)!=null?o:0))&&this.emit("graphic-translate",n);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",n)}return s}).next(s=>this._updateMoveTooltip(s,t));return e.next(()=>{h(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),a}_updateOperationStartProperties(){ui(this._displayBounds,this._displayBoundsStart),ui(this._mapBounds,this._mapBoundsStart),m(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=Dn(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return i=>{if(m(this.inputState)||this.inputState.type!=="move")return i;const e=[];for(const s of this._editGeometryOperations.data.components)e.push(...s.vertices);const t=i.action==="start"?ct.NEW_STEP:ct.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,i.mapDeltaX,i.mapDeltaY,i.mapDeltaZ,t);return Ki(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_updateMoveTooltip(i,e){if(e===D.XY||e===D.XY_AXIS){const t=dt(i.mapStart,i.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");h(t)&&h(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=t)}return i}_onResizeGrab({action:i,screenPoint:e}){if(i!=="start"||!e)return;const t=this._calculatePickRay(e);ri(this._displayBounds.plane,t,w.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(i,e){return je(i,(t,a,s)=>{m(this.inputState)||(a.next(n=>(n.action==="start"&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),n)).next(Ga(this.view,this._displayBoundsStart.plane)).next(n=>({...n,handle:e})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,xScale:n.factor1,yScale:n.factor2};switch(n.action){case"start":case"update":this.emit("graphic-scale",r);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",r)}return n}),s.next(()=>{h(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return i=>{const e=this._displayBoundsStart,t=i.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,n=U(w.get(),e.origin);Ji(n,n,e.basis1,-t[0]),Ji(n,n,e.basis2,-t[1]);const r=N(w.get(),i.renderEnd,n),o=N(w.get(),i.renderStart,n),l=Ka(i.handle),c=Cs(e),p=Cs(this._displayBounds)/c,u=(g,b)=>{if(g===0)return 1;let y=Re(b),f=.5*g*ba(b,r)/y;const S=f<0?-1:1;l&&(f+=(y-.5*g*ba(b,o)/y)*S*p);const x=y<1.5*s?1:Ar;return y=Math.max(y-s,Ar),S>0&&(f-=a),S*Math.max(S*(f/y),x)};return{...i,factor1:u(t[0],e.basis1),factor2:u(t[1],e.basis2)}}}_resizeDragUpdateGeometry(){return i=>{const e=U(M(),this._mapBoundsStart.origin);Ji(e,e,this._mapBoundsStart.basis1,-i.handle.direction[0]),Ji(e,e,this._mapBoundsStart.basis2,-i.handle.direction[1]);const t=Ie(Qe(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);pa(t,t);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s=i.action==="start"?ct.NEW_STEP:ct.ACCUMULATE_STEPS,n=this._editGeometryOperations.scaleVertices(a,e,t,i.factor1,i.factor2,s,Rn.REPLACE);return ui(this._mapBoundsStart,this._mapBounds),Ki(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_onRotateGrab({action:i,screenPoint:e}){if(i!=="start"||!e)return;const t=Qp(this._displayBounds,this.view.renderCoordsHelper,Vi.HEADING,hi()),a=this._calculatePickRay(e);ri(t,a,w.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(i){return je(i,(e,t,a)=>{const s=this.inputState;m(s)||(t.next(n=>(n.action==="start"&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),n)).next(Ga(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,angle:Ri(n.rotateAngle)};switch(n.action){case"start":case"update":this.emit("graphic-rotate",r);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",r)}return n}),a.next(()=>{h(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(i){return e=>{const t=Zi(i.rotatePlane),a=Oo(e.renderStart,e.renderEnd,this._displayBounds.origin,t);return{...e,rotateAxis:t,rotateAngle:a}}}_rotateDragUpdateGeometry(){return i=>{const e=U(M(),this._mapBoundsStart.origin),t=[];for(const n of this._editGeometryOperations.data.components)t.push(...n.vertices);const a=i.action==="start"?ct.NEW_STEP:ct.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(t,e,i.rotateAngle,a,Rn.REPLACE);return ui(this._mapBoundsStart,this._mapBounds),Ki(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_calculatePickRay(i){const e=Hi(),t=ya(i);return ii(this.view.state.camera,t,e),le(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const i=qp(this._displayBounds,oe.get());Kp(this._rotateManipulator,i,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,i),this._resizeManipulators.forEach((e,t)=>{Jp(e,this._resizeHandles[t],i,this._displayBounds)})}_updateZMoveHandle(i,e){const t=this._displayBounds,a={basis:t.basis1,direction:-1,position:N(w.get(),t.origin,t.basis1),edge:2},s=oe.get();Vl(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,i.modelTransform=s,i.renderLocation=a.position}_cancel(){const i=this._editGeometryOperations.lastOperation;m(i)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Pn(i,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(h(this.inputState))this.view.activeTool=null;else if(this.canUndo){const i=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Pn(L(i),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const i=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ki(L(i),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],fe.prototype,"view",void 0),d([_({constructOnly:!0,nonNullable:!0})],fe.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],fe.prototype,"enableZ",void 0),d([_()],fe.prototype,"enableRotation",void 0),d([_()],fe.prototype,"enableScaling",void 0),d([_({constructOnly:!0,type:wt})],fe.prototype,"tooltipOptions",void 0),d([_()],fe.prototype,"preserveAspectRatio",null),d([_()],fe.prototype,"grabbing",void 0),d([_()],fe.prototype,"inputState",void 0),d([_({readOnly:!0})],fe.prototype,"type",void 0),d([_()],fe.prototype,"_moveUnit",null),fe=d([K("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],fe);const Er="draped-elevation-changes",hu=10,du=80,Ar=1e-6;var Yu=Object.freeze(Object.defineProperty({__proto__:null,get DrawGraphicTool3D(){return Pt},get GraphicMoveTool(){return Ye},get GraphicReshapeTool(){return ne},get GraphicTransformTool(){return me},get ExtentTransformTool(){return fe}},Symbol.toStringTag,{value:"Module"}));export{Ch as A,So as C,xd as a,Yu as e,dd as f,Xp as t,Rh as v};
